/*! Copyright Elasticsearch B.V. and/or license to Elasticsearch B.V. under one or more contributor license agreements
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var executeModules=data[2];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}deferredModules.push.apply(deferredModules,executeModules||[]);return checkDeferredModules()}function checkDeferredModules(){var result;for(var i=0;i<deferredModules.length;i++){var deferredModule=deferredModules[i];var fulfilled=true;for(var j=1;j<deferredModule.length;j++){var depId=deferredModule[j];if(installedChunks[depId]!==0)fulfilled=false}if(fulfilled){deferredModules.splice(i--,1);result=__webpack_require__(__webpack_require__.s=deferredModule[0])}}return result}var installedModules={};var installedChunks={10:0};var deferredModules=[];function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="__REPLACE_WITH_PUBLIC_PATH__";var jsonpArray=window["webpackJsonp"]=window["webpackJsonp"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;deferredModules.push([3325,0]);return checkDeferredModules()})({10:function(module,exports){module.exports=vendors},1220:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TileStyle=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _abstract_style=__webpack_require__(757);var _i18n=__webpack_require__(5);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TileStyle=exports.TileStyle=function(_AbstractStyle){_inherits(TileStyle,_AbstractStyle);function TileStyle(){var styleDescriptor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,TileStyle);var _this=_possibleConstructorReturn(this,(TileStyle.__proto__||Object.getPrototypeOf(TileStyle)).call(this));_this._descriptor=TileStyle.createDescriptor(styleDescriptor.properties);return _this}_createClass(TileStyle,null,[{key:"canEdit",value:function canEdit(styleInstance){return styleInstance.constructor===TileStyle}},{key:"createDescriptor",value:function createDescriptor(){var properties=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{type:TileStyle.type,properties:_extends({},properties)}}},{key:"getDisplayName",value:function getDisplayName(){return _i18n.i18n.translate("xpack.maps.style.tile.displayNameLabel",{defaultMessage:"Tile style"})}}]);return TileStyle}(_abstract_style.AbstractStyle);TileStyle.type="TILE"},1221:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ColorGradient=undefined;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _colormaps=__webpack_require__(285);var _color_util=__webpack_require__(535);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var GRADIENT_INTERVALS=7;var COLOR_KEYS=Object.keys(_colormaps.vislibColorMaps);var ColorGradient=exports.ColorGradient=function ColorGradient(_ref){var color=_ref.color;if(!color||!COLOR_KEYS.includes(color)){return null}else{var rgbColorStrings=(0,_color_util.getLegendColors)(_colormaps.vislibColorMaps[color].value,GRADIENT_INTERVALS);var background=getLinearGradient(rgbColorStrings,GRADIENT_INTERVALS);return _react2.default.createElement("div",{className:"mapColorGradient",style:{background:background}})}};function getLinearGradient(colorStrings,intervals){var linearGradient="linear-gradient(to right, "+colorStrings[0]+" 0%,";for(var i=1;i<intervals-1;i++){linearGradient=linearGradient+" "+colorStrings[i]+"       "+Math.floor(100*i/(intervals-1))+"%,"}return linearGradient+" "+colorStrings.pop()+" 100%)"}},1222:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StaticDynamicStyleRow=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _vector_style=__webpack_require__(332);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _i18n=__webpack_require__(5);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var StaticDynamicStyleRow=exports.StaticDynamicStyleRow=function(_React$Component){_inherits(StaticDynamicStyleRow,_React$Component);function StaticDynamicStyleRow(){var _ref;var _temp,_this,_ret;_classCallCheck(this,StaticDynamicStyleRow);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=StaticDynamicStyleRow.__proto__||Object.getPrototypeOf(StaticDynamicStyleRow)).call.apply(_ref,[this].concat(args))),_this),_this.prevStaticStyleOptions=_this.props.defaultStaticStyleOptions,_this.prevDynamicStyleOptions=_this.props.defaultDynamicStyleOptions,_this._onStaticStyleChange=function(options){var styleDescriptor={type:_vector_style.VectorStyle.STYLE_TYPE.STATIC,options:options};_this.props.handlePropertyChange(_this.props.property,styleDescriptor)},_this._onDynamicStyleChange=function(options){var styleDescriptor={type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:options};_this.props.handlePropertyChange(_this.props.property,styleDescriptor)},_this._onTypeToggle=function(){if(_this._isDynamic()){_this.prevDynamicStyleOptions=_this._getStyleOptions();_this._onStaticStyleChange(_this.prevStaticStyleOptions);return}_this.prevStaticStyleOptions=_this._getStyleOptions();_this._onDynamicStyleChange(_this.prevDynamicStyleOptions)},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(StaticDynamicStyleRow,[{key:"_canBeDynamic",value:function _canBeDynamic(){return this.props.ordinalFields.length>0}},{key:"_isDynamic",value:function _isDynamic(){if(!this.props.styleDescriptor){return false}return this.props.styleDescriptor.type===_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC}},{key:"_getStyleOptions",value:function _getStyleOptions(){return _lodash2.default.get(this.props,"styleDescriptor.options")}},{key:"_renderStyleSelector",value:function _renderStyleSelector(){if(this._isDynamic()){var DynamicSelector=this.props.DynamicSelector;return _react2.default.createElement(DynamicSelector,{ordinalFields:this.props.ordinalFields,onChange:this._onDynamicStyleChange,styleOptions:this._getStyleOptions()})}var StaticSelector=this.props.StaticSelector;return _react2.default.createElement(StaticSelector,{onChange:this._onStaticStyleChange,styleOptions:this._getStyleOptions()})}},{key:"render",value:function render(){var isDynamic=this._isDynamic();var dynamicTooltipContent=isDynamic?_i18n.i18n.translate("xpack.maps.styles.staticDynamic.staticDescription",{defaultMessage:"Use static styling properties to symbolize features."}):_i18n.i18n.translate("xpack.maps.styles.staticDynamic.dynamicDescription",{defaultMessage:"Use property values to symbolize features."});return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,{className:isDynamic?"mapStaticDynamicSylingOption__dynamicSizeHack":undefined},_react2.default.createElement(_eui.EuiFormRow,{label:this.props.name&&this.props.name},this._renderStyleSelector())),this._canBeDynamic()&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react2.default.createElement(_eui.EuiToolTip,{content:dynamicTooltipContent,delay:"long"},_react2.default.createElement(_eui.EuiButtonToggle,{label:dynamicTooltipContent,iconType:"link",onChange:this._onTypeToggle,isEmpty:!isDynamic,fill:isDynamic,isIconOnly:true})))))}}]);return StaticDynamicStyleRow}(_react2.default.Component)},1223:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fieldShape=undefined;exports.FieldSelect=FieldSelect;var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _constants=__webpack_require__(193);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FieldSelect(_ref){var fields=_ref.fields,selectedField=_ref.selectedField,onChange=_ref.onChange;var onFieldChange=function onFieldChange(selectedFields){onChange({field:selectedFields.length>0?selectedFields[0].value:null})};var groupFieldsByOrigin=function groupFieldsByOrigin(){var fieldsByOriginMap=new Map;fields.forEach(function(field){if(fieldsByOriginMap.has(field.origin)){var fieldsList=fieldsByOriginMap.get(field.origin);fieldsList.push(field);fieldsByOriginMap.set(field.origin,fieldsList)}else{fieldsByOriginMap.set(field.origin,[field])}});var optionGroups=[];fieldsByOriginMap.forEach(function(fieldsList,fieldOrigin){optionGroups.push({label:fieldOrigin,options:fieldsList.map(function(field){return{value:field,label:field.label}}).sort(function(a,b){return a.label.toLowerCase().localeCompare(b.label.toLowerCase())})})});optionGroups.sort(function(a,b){return a.label.toLowerCase().localeCompare(b.label.toLowerCase())});return optionGroups};var selectedOptions=selectedField?[{label:selectedField.label,value:selectedField}]:[];return _react2.default.createElement(_eui.EuiComboBox,{selectedOptions:selectedOptions,options:groupFieldsByOrigin(),onChange:onFieldChange,singleSelection:{asPlainText:true},isClearable:false,fullWidth:true,placeholder:_i18n.i18n.translate("xpack.maps.styles.vector.selectFieldPlaceholder",{defaultMessage:"Select a field"})})}var fieldShape=exports.fieldShape=_propTypes2.default.shape({name:_propTypes2.default.string.isRequired,label:_propTypes2.default.string.isRequired,origin:_propTypes2.default.oneOf(["join",_constants.SOURCE_DATA_ID_ORIGIN]).isRequired});FieldSelect.propTypes={selectedField:fieldShape,fields:_propTypes2.default.arrayOf(fieldShape).isRequired,onChange:_propTypes2.default.func.isRequired}},1224:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.COLOR_GRADIENTS=undefined;exports.ColorRampSelect=ColorRampSelect;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _colormaps=__webpack_require__(285);var _color_gradient=__webpack_require__(1221);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var COLOR_GRADIENTS=exports.COLOR_GRADIENTS=Object.keys(_colormaps.vislibColorMaps).map(function(colorKey){return{value:colorKey,text:colorKey,inputDisplay:_react2.default.createElement(_color_gradient.ColorGradient,{color:colorKey})}});function ColorRampSelect(_ref){var color=_ref.color,onChange=_ref.onChange;var onColorRampChange=function onColorRampChange(selectedColorRampString){onChange({color:selectedColorRampString})};return _react2.default.createElement(_eui.EuiSuperSelect,{options:COLOR_GRADIENTS,onChange:onColorRampChange,valueOfSelected:color,hasDividers:true})}ColorRampSelect.propTypes={color:_propTypes2.default.string.isRequired,onChange:_propTypes2.default.func.isRequired}},1225:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var AbstractSource=exports.AbstractSource=function(){_createClass(AbstractSource,null,[{key:"renderEditor",value:function renderEditor(){throw new Error("Must implement Source.renderEditor")}},{key:"createDescriptor",value:function createDescriptor(){throw new Error("Must implement Source.createDescriptor")}},{key:"renderDropdownDisplayOption",value:function renderDropdownDisplayOption(){throw new Error("Must implement Source.renderDropdownDisplayOption")}}]);function AbstractSource(descriptor){_classCallCheck(this,AbstractSource);this._descriptor=descriptor}_createClass(AbstractSource,[{key:"destroy",value:function destroy(){}},{key:"supportsFitToBounds",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",true);case 1:case"end":return _context.stop()}}},_callee,this)}));function supportsFitToBounds(){return _ref.apply(this,arguments)}return supportsFitToBounds}()},{key:"getImmutableProperties",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",[]);case 1:case"end":return _context2.stop()}}},_callee2,this)}));function getImmutableProperties(){return _ref2.apply(this,arguments)}return getImmutableProperties}()},{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(){throw new Error("Source#createDefaultLayerDescriptor not implemented")}},{key:"createDefaultLayer",value:function createDefaultLayer(){throw new Error("Source#createDefaultLayer not implemented")}},{key:"getDisplayName",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.warn("Source should implement Source#getDisplayName");return _context3.abrupt("return","");case 2:case"end":return _context3.stop()}}},_callee3,this)}));function getDisplayName(){return _ref3.apply(this,arguments)}return getDisplayName}()},{key:"getAttributions",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",[]);case 1:case"end":return _context4.stop()}}},_callee4,this)}));function getAttributions(){return _ref4.apply(this,arguments)}return getAttributions}()},{key:"isFieldAware",value:function isFieldAware(){return false}},{key:"isRefreshTimerAware",value:function isRefreshTimerAware(){return false}},{key:"isGeoGridPrecisionAware",value:function isGeoGridPrecisionAware(){return false}},{key:"isQueryAware",value:function isQueryAware(){return false}},{key:"getFieldNames",value:function getFieldNames(){return[]}},{key:"hasCompleteConfig",value:function hasCompleteConfig(){throw new Error("Source#hasCompleteConfig not implemented")}},{key:"renderSourceSettingsEditor",value:function renderSourceSettingsEditor(){return null}},{key:"getIndexPatternIds",value:function getIndexPatternIds(){return[]}},{key:"getGeoGridPrecision",value:function getGeoGridPrecision(){return 0}},{key:"isJoinable",value:function isJoinable(){return false}}]);return AbstractSource}()},1226:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filterPropertiesForTooltip=filterPropertiesForTooltip;function filterPropertiesForTooltip(metricFields,properties){var tooltipProps={};metricFields.forEach(function(field){var value=void 0;for(var key in properties){if(properties.hasOwnProperty(key)){if(field.propertyKey===key){value=properties[key];break}}}if(!value){value="-"}tooltipProps[field.propertyLabel]=value});return tooltipProps}},1227:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getStore=undefined;var _redux=__webpack_require__(27);var _reduxThunk=__webpack_require__(252);var _reduxThunk2=_interopRequireDefault(_reduxThunk);var _ui=__webpack_require__(267);var _ui2=_interopRequireDefault(_ui);var _map=__webpack_require__(3347);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var store=void 0;var rootReducer=(0,_redux.combineReducers)({map:_map.map,ui:_ui2.default});var enhancers=[(0,_redux.applyMiddleware)(_reduxThunk2.default)];window.__REDUX_DEVTOOLS_EXTENSION&&enhancers.push(window.__REDUX_DEVTOOLS_EXTENSION__());var getStore=exports.getStore=function getStore(){if(store){return store}var storeConfig={};var composeEnhancers=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||_redux.compose;store=(0,_redux.createStore)(rootReducer,storeConfig,composeEnhancers.apply(undefined,enhancers));return store}},1228:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.HeatmapLayer=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _layer=__webpack_require__(755);var _eui=__webpack_require__(1);var _heatmap_style=__webpack_require__(1229);var _constants=__webpack_require__(193);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SCALED_PROPERTY_NAME="__kbn_heatmap_weight__";var HeatmapLayer=exports.HeatmapLayer=function(_AbstractLayer){_inherits(HeatmapLayer,_AbstractLayer);_createClass(HeatmapLayer,null,[{key:"createDescriptor",value:function createDescriptor(options){var heatmapLayerDescriptor=_get(HeatmapLayer.__proto__||Object.getPrototypeOf(HeatmapLayer),"createDescriptor",this).call(this,options);heatmapLayerDescriptor.type=HeatmapLayer.type;heatmapLayerDescriptor.style=_heatmap_style.HeatmapStyle.createDescriptor();return heatmapLayerDescriptor}}]);function HeatmapLayer(_ref){var layerDescriptor=_ref.layerDescriptor,source=_ref.source,style=_ref.style;_classCallCheck(this,HeatmapLayer);var _this=_possibleConstructorReturn(this,(HeatmapLayer.__proto__||Object.getPrototypeOf(HeatmapLayer)).call(this,{layerDescriptor:layerDescriptor,source:source,style:style}));if(!style){var defaultStyle=_heatmap_style.HeatmapStyle.createDescriptor();_this._style=new _heatmap_style.HeatmapStyle(defaultStyle)}return _this}_createClass(HeatmapLayer,[{key:"getSupportedStyles",value:function getSupportedStyles(){return[_heatmap_style.HeatmapStyle]}},{key:"getIndexPatternIds",value:function getIndexPatternIds(){return this._source.getIndexPatternIds()}},{key:"_getPropKeyOfSelectedMetric",value:function _getPropKeyOfSelectedMetric(){var metricfields=this._source.getMetricFields();return metricfields[0].propertyKey}},{key:"syncLayerWithMB",value:function syncLayerWithMB(mbMap){var mbSource=mbMap.getSource(this.getId());var mbLayerId=this.getId()+"_heatmap";if(!mbSource){mbMap.addSource(this.getId(),{type:"geojson",data:{type:"FeatureCollection",features:[]}});mbMap.addLayer({id:mbLayerId,type:"heatmap",source:this.getId(),paint:{}})}var mbSourceAfter=mbMap.getSource(this.getId());var sourceDataRequest=this.getSourceDataRequest();var featureCollection=sourceDataRequest?sourceDataRequest.getData():null;if(!featureCollection){mbSourceAfter.setData({type:"FeatureCollection",features:[]});return}var propertyKey=this._getPropKeyOfSelectedMetric();var dataBoundToMap=_layer.AbstractLayer.getBoundDataForSource(mbMap,this.getId());if(featureCollection!==dataBoundToMap){var max=0;for(var i=0;i<featureCollection.features.length;i++){max=Math.max(featureCollection.features[i].properties[propertyKey],max)}for(var _i=0;_i<featureCollection.features.length;_i++){featureCollection.features[_i].properties[SCALED_PROPERTY_NAME]=featureCollection.features[_i].properties[propertyKey]/max}mbSourceAfter.setData(featureCollection)}mbMap.setLayoutProperty(mbLayerId,"visibility",this.isVisible()?"visible":"none");this._style.setMBPaintProperties({mbMap:mbMap,layerId:mbLayerId,propertyName:SCALED_PROPERTY_NAME,resolution:this._source.getGridResolution()});mbMap.setPaintProperty(mbLayerId,"heatmap-opacity",this.getAlpha());mbMap.setLayerZoomRange(mbLayerId,this._descriptor.minZoom,this._descriptor.maxZoom)}},{key:"getBounds",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(filters){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this._source.getBoundsForFilters(filters);case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}},_callee,this)}));function getBounds(_x){return _ref2.apply(this,arguments)}return getBounds}()},{key:"syncData",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(_ref3){var startLoading=_ref3.startLoading,stopLoading=_ref3.stopLoading,onLoadError=_ref3.onLoadError,dataFilters=_ref3.dataFilters;var sourceDataRequest,dataMeta,geogridPrecision,isSamePrecision,isSameTime,updateDueToRefreshTimer,updateDueToExtent,updateDueToQuery,metricPropertyKey,updateDueToMetricChange,newDataMeta;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!this.isVisible()||!this.showAtZoomLevel(dataFilters.zoom))){_context2.next=2;break}return _context2.abrupt("return");case 2:if(dataFilters.buffer){_context2.next=4;break}return _context2.abrupt("return");case 4:sourceDataRequest=this.getSourceDataRequest();dataMeta=sourceDataRequest?sourceDataRequest.getMeta():{};geogridPrecision=this._source.getGeoGridPrecision(dataFilters.zoom);isSamePrecision=dataMeta.geogridPrecision===geogridPrecision;isSameTime=_lodash2.default.isEqual(dataMeta.timeFilters,dataFilters.timeFilters);updateDueToRefreshTimer=dataFilters.refreshTimerLastTriggeredAt&&!_lodash2.default.isEqual(dataMeta.refreshTimerLastTriggeredAt,dataFilters.refreshTimerLastTriggeredAt);updateDueToExtent=this.updateDueToExtent(this._source,dataMeta,dataFilters);updateDueToQuery=dataFilters.query&&!_lodash2.default.isEqual(dataMeta.query,dataFilters.query);metricPropertyKey=this._getPropKeyOfSelectedMetric();updateDueToMetricChange=!_lodash2.default.isEqual(dataMeta.metric,metricPropertyKey);if(!(isSamePrecision&&isSameTime&&!updateDueToExtent&&!updateDueToRefreshTimer&&!updateDueToQuery&&!updateDueToMetricChange)){_context2.next=16;break}return _context2.abrupt("return");case 16:newDataMeta=_extends({},dataFilters,{geogridPrecision:geogridPrecision,metric:metricPropertyKey});_context2.next=19;return this._fetchNewData({startLoading:startLoading,stopLoading:stopLoading,onLoadError:onLoadError,dataMeta:newDataMeta});case 19:case"end":return _context2.stop()}}},_callee2,this)}));function syncData(_x2){return _ref4.apply(this,arguments)}return syncData}()},{key:"_fetchNewData",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(_ref5){var startLoading=_ref5.startLoading,stopLoading=_ref5.stopLoading,onLoadError=_ref5.onLoadError,dataMeta=_ref5.dataMeta;var geogridPrecision,timeFilters,buffer,query,requestToken,layerName,data;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:geogridPrecision=dataMeta.geogridPrecision,timeFilters=dataMeta.timeFilters,buffer=dataMeta.buffer,query=dataMeta.query;requestToken=Symbol("layer-source-refresh: this.getId()");startLoading(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,dataMeta);_context3.prev=3;_context3.next=6;return this.getDisplayName();case 6:layerName=_context3.sent;_context3.next=9;return this._source.getGeoJsonPoints({layerName:layerName},{geogridPrecision:geogridPrecision,buffer:buffer,timeFilters:timeFilters,query:query});case 9:data=_context3.sent;stopLoading(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,data);_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3["catch"](3);onLoadError(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,_context3.t0.message);case 16:case"end":return _context3.stop()}}},_callee3,this,[[3,13]])}));function _fetchNewData(_x3){return _ref6.apply(this,arguments)}return _fetchNewData}()},{key:"getLayerTypeIconName",value:function getLayerTypeIconName(){return"heatmap"}},{key:"getIcon",value:function getIcon(){return _react2.default.createElement(_eui.EuiIcon,{type:this.getLayerTypeIconName()})}}]);return HeatmapLayer}(_layer.AbstractLayer);HeatmapLayer.type="HEATMAP"},1229:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.HeatmapStyle=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _grid_resolution=__webpack_require__(766);var _abstract_style=__webpack_require__(757);var _i18n=__webpack_require__(5);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var HeatmapStyle=exports.HeatmapStyle=function(_AbstractStyle){_inherits(HeatmapStyle,_AbstractStyle);function HeatmapStyle(){_classCallCheck(this,HeatmapStyle);var _this=_possibleConstructorReturn(this,(HeatmapStyle.__proto__||Object.getPrototypeOf(HeatmapStyle)).call(this));_this._descriptor=HeatmapStyle.createDescriptor();return _this}_createClass(HeatmapStyle,[{key:"setMBPaintProperties",value:function setMBPaintProperties(_ref){var mbMap=_ref.mbMap,layerId=_ref.layerId,propertyName=_ref.propertyName,resolution=_ref.resolution;var radius=void 0;if(resolution===_grid_resolution.GRID_RESOLUTION.COARSE){radius=64}else if(resolution===_grid_resolution.GRID_RESOLUTION.FINE){radius=32}else if(resolution===_grid_resolution.GRID_RESOLUTION.MOST_FINE){radius=16}else{var errorMessage=_i18n.i18n.translate("xpack.maps.style.heatmap.resolutionStyleErrorMessage",{defaultMessage:"Resolution param not recognized: {resolution}",values:{resolution:resolution}});throw new Error(errorMessage)}mbMap.setPaintProperty(layerId,"heatmap-radius",radius);mbMap.setPaintProperty(layerId,"heatmap-weight",{type:"identity",property:propertyName})}}],[{key:"canEdit",value:function canEdit(styleInstance){return styleInstance.constructor===HeatmapStyle}},{key:"createDescriptor",value:function createDescriptor(){return{type:HeatmapStyle.type}}},{key:"getDisplayName",value:function getDisplayName(){return _i18n.i18n.translate("xpack.maps.style.heatmap.displayNameLabel",{defaultMessage:"Heatmap style"})}},{key:"renderEditor",value:function renderEditor(){return null}}]);return HeatmapStyle}(_abstract_style.AbstractStyle);HeatmapStyle.type="HEATMAP"},1230:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ALL_SOURCES=undefined;var _ems_file_source=__webpack_require__(3348);var _kibana_regionmap_source=__webpack_require__(3351);var _xyz_tms_source=__webpack_require__(3354);var _ems_tms_source=__webpack_require__(1232);var _wms_source=__webpack_require__(3357);var _kibana_tilemap_source=__webpack_require__(1233);var _es_geo_grid_source=__webpack_require__(3360);var _es_search_source=__webpack_require__(3368);var ALL_SOURCES=exports.ALL_SOURCES=[_es_search_source.ESSearchSource,_es_geo_grid_source.ESGeoGridSource,_ems_file_source.EMSFileSource,_ems_tms_source.EMSTMSSource,_kibana_regionmap_source.KibanaRegionmapSource,_kibana_tilemap_source.KibanaTilemapSource,_xyz_tms_source.XYZTMSSource,_wms_source.WMSSource]},1231:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getEmsUnavailableMessage=getEmsUnavailableMessage;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getEmsUnavailableMessage(){var isEmsEnabled=_chrome2.default.getInjected("isEmsEnabled",true);if(isEmsEnabled){return _i18n.i18n.translate("xpack.maps.source.ems.noAccessDescription",{defaultMessage:"Kibana is unable to access Elastic Maps Service. Contact your system administrator"})}return _i18n.i18n.translate("xpack.maps.source.ems.disabledDescription",{defaultMessage:'Access to Elastic Maps Service has been disabled. Ask your system administrator to set "map.includeElasticMapsService" in kibana.yml.'})}},1232:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ems_tms_source=__webpack_require__(3355);Object.defineProperty(exports,"EMSTMSSource",{enumerable:true,get:function get(){return _ems_tms_source.EMSTMSSource}})},1233:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _kibana_tilemap_source=__webpack_require__(3358);Object.defineProperty(exports,"KibanaTilemapSource",{enumerable:true,get:function get(){return _kibana_tilemap_source.KibanaTilemapSource}})},1235:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NoIndexPatternCallout=NoIndexPatternCallout;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function NoIndexPatternCallout(){return _react2.default.createElement(_eui.EuiCallOut,{title:_i18n.i18n.translate("xpack.maps.noIndexPattern.messageTitle",{defaultMessage:"Couldn't find any index patterns with geospatial fields"}),color:"warning"},_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.noIndexPattern.doThisPrefixDescription",defaultMessage:"You'll need to "}),_react2.default.createElement(_eui.EuiLink,{href:_chrome2.default.addBasePath("/app/kibana#/management/kibana/index_pattern")},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.noIndexPattern.doThisLinkTextDescription",defaultMessage:"create an index pattern"})),_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.noIndexPattern.doThisSuffixDescription",defaultMessage:" with geospatial fields."})),_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.noIndexPattern.hintDescription",defaultMessage:"Don't have any geospatial data sets? "}),_react2.default.createElement(_eui.EuiLink,{href:_chrome2.default.addBasePath("/app/kibana#/home/tutorial_directory/sampleData")},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.noIndexPattern.getStartedLinkText",defaultMessage:"Get started with some sample data sets."}))))}},1236:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.MetricsEditor=MetricsEditor;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _i18n=__webpack_require__(5);var _eui=__webpack_require__(1);var _metric_select=__webpack_require__(3365);var _single_field_select=__webpack_require__(446);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function MetricsEditor(_ref){var fields=_ref.fields,metrics=_ref.metrics,onChange=_ref.onChange,allowMultipleMetrics=_ref.allowMultipleMetrics,metricsFilter=_ref.metricsFilter;function onMetricChange(metric,index){onChange([].concat(_toConsumableArray(metrics.slice(0,index)),[metric],_toConsumableArray(metrics.slice(index+1))))}function renderMetrics(){return metrics.map(function(metric,index){var onAggChange=function onAggChange(metricAggregationType){var updatedMetric=_extends({},metric,{type:metricAggregationType});onMetricChange(updatedMetric,index)};var onFieldChange=function onFieldChange(fieldName){var updatedMetric=_extends({},metric,{field:fieldName});onMetricChange(updatedMetric,index)};var onRemove=function onRemove(){onChange([].concat(_toConsumableArray(metrics.slice(0,index)),_toConsumableArray(metrics.slice(index+1))))};var fieldSelect=void 0;if(metric.type&&metric.type!=="count"){var filterNumberFields=function filterNumberFields(field){return field.type==="number"};fieldSelect=_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_single_field_select.SingleFieldSelect,{placeholder:_i18n.i18n.translate("xpack.maps.metricsEditor.selectFieldPlaceholder",{defaultMessage:"Select field"}),value:metric.field,onChange:onFieldChange,filterField:filterNumberFields,fields:fields,isClearable:false}))}var removeButton=void 0;if(index>0){removeButton=_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonIcon,{iconType:"trash",color:"danger","aria-label":_i18n.i18n.translate("xpack.maps.metricsEditor.deleteMetricAriaLabel",{defaultMessage:"Delete metric"}),title:_i18n.i18n.translate("xpack.maps.metricsEditor.deleteMetricButtonLabel",{defaultMessage:"Delete metric"}),onClick:onRemove}))}return _react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",key:index},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_metric_select.MetricSelect,{onChange:onAggChange,value:metric.type,metricsFilter:metricsFilter})),fieldSelect,removeButton)})}function addMetric(){onChange([].concat(_toConsumableArray(metrics),[{}]))}function renderAddMetricButton(){if(!allowMultipleMetrics){return null}return _react2.default.createElement(_eui.EuiButtonIcon,{iconType:"plusInCircle",onClick:addMetric,"aria-label":_i18n.i18n.translate("xpack.maps.metricsEditor.addMetricAriaLabel",{defaultMessage:"Add metric"}),title:_i18n.i18n.translate("xpack.maps.metricsEditor.addMetricButtonLabel",{defaultMessage:"Add metric"})})}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:true},_react2.default.createElement(_eui.EuiFormLabel,{style:{marginBottom:0}},"Metrics")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},renderAddMetricButton())),renderMetrics())}MetricsEditor.propTypes={metrics:_propTypes2.default.arrayOf(_propTypes2.default.shape({type:_propTypes2.default.oneOf(_metric_select.METRIC_AGGREGATION_VALUES),field:_propTypes2.default.string})),fields:_propTypes2.default.object,onChange:_propTypes2.default.func.isRequired,allowMultipleMetrics:_propTypes2.default.bool,metricsFilter:_propTypes2.default.func};MetricsEditor.defaultProps={metrics:[{type:"count"}],allowMultipleMetrics:true}},1239:function(module,exports,__webpack_require__){module.exports=__webpack_require__(10)(2670)},192:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.hasDirtyState=exports.getUniqueIndexPatternIds=exports.getSelectedLayerJoinDescriptors=exports.getSelectedLayer=exports.getLayerList=exports.getDataFilters=exports.getRefreshTimerLastTriggeredAt=exports.getRefreshConfig=exports.getQuery=exports.getTimeFilters=exports.getMapColors=exports.getMouseCoordinates=exports.getMapCenter=exports.getMapZoom=exports.getMapBuffer=exports.getMapExtent=exports.getWaitingForMapReadyLayerListRaw=exports.getLayerListRaw=exports.getTransientLayerId=exports.getSelectedLayerId=exports.getGoto=exports.getMapReady=undefined;var _reselect=__webpack_require__(26);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _tile_layer=__webpack_require__(445);var _vector_layer=__webpack_require__(758);var _heatmap_layer=__webpack_require__(1228);var _all_sources=__webpack_require__(1230);var _vector_style=__webpack_require__(332);var _heatmap_style=__webpack_require__(1229);var _tile_style=__webpack_require__(1220);var _timefilter=__webpack_require__(16);var _util=__webpack_require__(765);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function createLayerInstance(layerDescriptor){var source=createSourceInstance(layerDescriptor.sourceDescriptor);var style=createStyleInstance(layerDescriptor.style);switch(layerDescriptor.type){case _tile_layer.TileLayer.type:return new _tile_layer.TileLayer({layerDescriptor:layerDescriptor,source:source,style:style});case _vector_layer.VectorLayer.type:return new _vector_layer.VectorLayer({layerDescriptor:layerDescriptor,source:source,style:style});case _heatmap_layer.HeatmapLayer.type:return new _heatmap_layer.HeatmapLayer({layerDescriptor:layerDescriptor,source:source,style:style});default:throw new Error("Unrecognized layerType "+layerDescriptor.type)}}function createSourceInstance(sourceDescriptor){var Source=_all_sources.ALL_SOURCES.find(function(Source){return Source.type===sourceDescriptor.type});if(!Source){throw new Error("Unrecognized sourceType "+sourceDescriptor.type)}return new Source(sourceDescriptor)}function createStyleInstance(styleDescriptor){if(!styleDescriptor||!styleDescriptor.type){return null}switch(styleDescriptor.type){case _vector_style.VectorStyle.type:return new _vector_style.VectorStyle(styleDescriptor);case _tile_style.TileStyle.type:return new _tile_style.TileStyle(styleDescriptor);case _heatmap_style.HeatmapStyle.type:return new _heatmap_style.HeatmapStyle(styleDescriptor);default:throw new Error("Unrecognized styleType "+styleDescriptor.type)}}var getMapReady=exports.getMapReady=function getMapReady(_ref){var map=_ref.map;return map&&map.ready};var getGoto=exports.getGoto=function getGoto(_ref2){var map=_ref2.map;return map&&map.goto};var getSelectedLayerId=exports.getSelectedLayerId=function getSelectedLayerId(_ref3){var map=_ref3.map;return!map.selectedLayerId||!map.layerList?null:map.selectedLayerId};var getTransientLayerId=exports.getTransientLayerId=function getTransientLayerId(_ref4){var map=_ref4.map;return map.__transientLayerId};var getLayerListRaw=exports.getLayerListRaw=function getLayerListRaw(_ref5){var map=_ref5.map;return map.layerList?map.layerList:[]};var getWaitingForMapReadyLayerListRaw=exports.getWaitingForMapReadyLayerListRaw=function getWaitingForMapReadyLayerListRaw(_ref6){var map=_ref6.map;return map.waitingForMapReadyLayerList?map.waitingForMapReadyLayerList:[]};var getMapExtent=exports.getMapExtent=function getMapExtent(_ref7){var map=_ref7.map;return map.mapState.extent?map.mapState.extent:{}};var getMapBuffer=exports.getMapBuffer=function getMapBuffer(_ref8){var map=_ref8.map;return map.mapState.buffer?map.mapState.buffer:{}};var getMapZoom=exports.getMapZoom=function getMapZoom(_ref9){var map=_ref9.map;return map.mapState.zoom?map.mapState.zoom:0};var getMapCenter=exports.getMapCenter=function getMapCenter(_ref10){var map=_ref10.map;return map.mapState.center?map.mapState.center:{lat:0,lon:0}};var getMouseCoordinates=exports.getMouseCoordinates=function getMouseCoordinates(_ref11){var map=_ref11.map;return map.mapState.mouseCoordinates};var getMapColors=exports.getMapColors=function getMapColors(_ref12){var map=_ref12.map;return map.layerList.reduce(function(accu,layer){var color=_lodash2.default.get(layer,"style.properties.fillColor.options.color");if(color)accu.push(color);return accu},[])};var getTimeFilters=exports.getTimeFilters=function getTimeFilters(_ref13){var map=_ref13.map;return map.mapState.timeFilters?map.mapState.timeFilters:_timefilter.timefilter.getTime()};var getQuery=exports.getQuery=function getQuery(_ref14){var map=_ref14.map;return map.mapState.query};var getRefreshConfig=exports.getRefreshConfig=function getRefreshConfig(_ref15){var map=_ref15.map;return map.mapState.refreshConfig};var getRefreshTimerLastTriggeredAt=exports.getRefreshTimerLastTriggeredAt=function getRefreshTimerLastTriggeredAt(_ref16){var map=_ref16.map;return map.mapState.refreshTimerLastTriggeredAt};var getDataFilters=exports.getDataFilters=(0,_reselect.createSelector)(getMapExtent,getMapBuffer,getMapZoom,getTimeFilters,getRefreshTimerLastTriggeredAt,getQuery,function(mapExtent,mapBuffer,mapZoom,timeFilters,refreshTimerLastTriggeredAt,query){return{extent:mapExtent,buffer:mapBuffer,zoom:mapZoom,timeFilters:timeFilters,refreshTimerLastTriggeredAt:refreshTimerLastTriggeredAt,query:query}});var getLayerList=exports.getLayerList=(0,_reselect.createSelector)(getLayerListRaw,function(layerDescriptorList){return layerDescriptorList.map(function(layerDescriptor){return createLayerInstance(layerDescriptor)})});var getSelectedLayer=exports.getSelectedLayer=(0,_reselect.createSelector)(getSelectedLayerId,getLayerList,function(selectedLayerId,layerList){return layerList.find(function(layer){return layer.getId()===selectedLayerId})});var getSelectedLayerJoinDescriptors=exports.getSelectedLayerJoinDescriptors=(0,_reselect.createSelector)(getSelectedLayer,function(selectedLayer){return selectedLayer.getJoins().map(function(join){return join.toDescriptor()})});var getUniqueIndexPatternIds=exports.getUniqueIndexPatternIds=(0,_reselect.createSelector)(getLayerList,function(layerList){var indexPatternIds=[];layerList.forEach(function(layer){indexPatternIds.push.apply(indexPatternIds,_toConsumableArray(layer.getIndexPatternIds()))});return _lodash2.default.uniq(indexPatternIds)});var hasDirtyState=exports.hasDirtyState=(0,_reselect.createSelector)(getLayerListRaw,function(layerListRaw){return layerListRaw.some(function(layerDescriptor){var currentState=(0,_util.copyPersistentState)(layerDescriptor);var trackedState=layerDescriptor[_util.TRACKED_LAYER_DESCRIPTOR];return trackedState?!_lodash2.default.isEqual(currentState,trackedState):false})})},216:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.REMOVE_TRACKED_LAYER_STATE=exports.ROLLBACK_TO_TRACKED_LAYER_STATE=exports.TRACK_CURRENT_LAYER_STATE=exports.CLEAR_GOTO=exports.SET_GOTO=exports.CLEAR_MOUSE_COORDINATES=exports.SET_MOUSE_COORDINATES=exports.SET_REFRESH_CONFIG=exports.UPDATE_SOURCE_PROP=exports.TOUCH_LAYER=exports.UPDATE_LAYER_STYLE=exports.UPDATE_LAYER_PROP=exports.TRIGGER_REFRESH_TIMER=exports.SET_QUERY=exports.SET_JOINS=exports.UPDATE_SOURCE_DATA_REQUEST=exports.LAYER_DATA_LOAD_ERROR=exports.LAYER_DATA_LOAD_ENDED=exports.LAYER_DATA_LOAD_STARTED=exports.MAP_DESTROYED=exports.MAP_READY=exports.MAP_EXTENT_CHANGED=exports.TOGGLE_LAYER_VISIBLE=exports.REMOVE_LAYER=exports.CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST=exports.ADD_WAITING_FOR_MAP_READY_LAYER=exports.SET_LAYER_ERROR_STATUS=exports.ADD_LAYER=exports.UPDATE_LAYER_ORDER=exports.SET_TRANSIENT_LAYER=exports.SET_SELECTED_LAYER=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var syncDataForAllLayers=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(getState,dispatch,dataFilters){var state,layerList,syncs;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:state=getState();layerList=(0,_map_selectors.getLayerList)(state);syncs=layerList.map(function(layer){var loadingFunctions=getLayerLoadingCallbacks(dispatch,layer.getId());return layer.syncData(_extends({},loadingFunctions,{dataFilters:dataFilters}))});_context2.next=5;return Promise.all(syncs);case 5:case"end":return _context2.stop()}}},_callee2,this)}));return function syncDataForAllLayers(_x,_x2,_x3){return _ref2.apply(this,arguments)}}();exports.trackCurrentLayerState=trackCurrentLayerState;exports.rollbackToTrackedLayerStateForSelectedLayer=rollbackToTrackedLayerStateForSelectedLayer;exports.removeTrackedLayerStateForSelectedLayer=removeTrackedLayerStateForSelectedLayer;exports.replaceLayerList=replaceLayerList;exports.addLayer=addLayer;exports.toggleLayerVisible=toggleLayerVisible;exports.setSelectedLayer=setSelectedLayer;exports.removeTransientLayer=removeTransientLayer;exports.setTransientLayer=setTransientLayer;exports.clearTransientLayerStateAndCloseFlyout=clearTransientLayerStateAndCloseFlyout;exports.updateLayerOrder=updateLayerOrder;exports.mapReady=mapReady;exports.mapDestroyed=mapDestroyed;exports.mapExtentChanged=mapExtentChanged;exports.setMouseCoordinates=setMouseCoordinates;exports.clearMouseCoordinates=clearMouseCoordinates;exports.fitToLayerExtent=fitToLayerExtent;exports.setGotoWithBounds=setGotoWithBounds;exports.setGotoWithCenter=setGotoWithCenter;exports.clearGoto=clearGoto;exports.startDataLoad=startDataLoad;exports.updateSourceDataRequest=updateSourceDataRequest;exports.endDataLoad=endDataLoad;exports.onDataLoadError=onDataLoadError;exports.updateSourceProp=updateSourceProp;exports.syncDataForLayer=syncDataForLayer;exports.updateLayerLabel=updateLayerLabel;exports.updateLayerMinZoom=updateLayerMinZoom;exports.updateLayerMaxZoom=updateLayerMaxZoom;exports.updateLayerAlpha=updateLayerAlpha;exports.removeSelectedLayer=removeSelectedLayer;exports.removeLayer=removeLayer;exports.setQuery=setQuery;exports.setRefreshConfig=setRefreshConfig;exports.triggerRefreshTimer=triggerRefreshTimer;exports.clearMissingStyleProperties=clearMissingStyleProperties;exports.updateLayerStyle=updateLayerStyle;exports.updateLayerStyleForSelectedLayer=updateLayerStyleForSelectedLayer;exports.setJoinsForLayer=setJoinsForLayer;var _turf=__webpack_require__(759);var _turf2=_interopRequireDefault(_turf);var _booleanContains=__webpack_require__(1239);var _booleanContains2=_interopRequireDefault(_booleanContains);var _map_selectors=__webpack_require__(192);var _ui=__webpack_require__(267);var _constants=__webpack_require__(193);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}var SET_SELECTED_LAYER=exports.SET_SELECTED_LAYER="SET_SELECTED_LAYER";var SET_TRANSIENT_LAYER=exports.SET_TRANSIENT_LAYER="SET_TRANSIENT_LAYER";var UPDATE_LAYER_ORDER=exports.UPDATE_LAYER_ORDER="UPDATE_LAYER_ORDER";var ADD_LAYER=exports.ADD_LAYER="ADD_LAYER";var SET_LAYER_ERROR_STATUS=exports.SET_LAYER_ERROR_STATUS="SET_LAYER_ERROR_STATUS";var ADD_WAITING_FOR_MAP_READY_LAYER=exports.ADD_WAITING_FOR_MAP_READY_LAYER="ADD_WAITING_FOR_MAP_READY_LAYER";var CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST=exports.CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST="CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST";var REMOVE_LAYER=exports.REMOVE_LAYER="REMOVE_LAYER";var TOGGLE_LAYER_VISIBLE=exports.TOGGLE_LAYER_VISIBLE="TOGGLE_LAYER_VISIBLE";var MAP_EXTENT_CHANGED=exports.MAP_EXTENT_CHANGED="MAP_EXTENT_CHANGED";var MAP_READY=exports.MAP_READY="MAP_READY";var MAP_DESTROYED=exports.MAP_DESTROYED="MAP_DESTROYED";var LAYER_DATA_LOAD_STARTED=exports.LAYER_DATA_LOAD_STARTED="LAYER_DATA_LOAD_STARTED";var LAYER_DATA_LOAD_ENDED=exports.LAYER_DATA_LOAD_ENDED="LAYER_DATA_LOAD_ENDED";var LAYER_DATA_LOAD_ERROR=exports.LAYER_DATA_LOAD_ERROR="LAYER_DATA_LOAD_ERROR";var UPDATE_SOURCE_DATA_REQUEST=exports.UPDATE_SOURCE_DATA_REQUEST="UPDATE_SOURCE_DATA_REQUEST";var SET_JOINS=exports.SET_JOINS="SET_JOINS";var SET_QUERY=exports.SET_QUERY="SET_QUERY";var TRIGGER_REFRESH_TIMER=exports.TRIGGER_REFRESH_TIMER="TRIGGER_REFRESH_TIMER";var UPDATE_LAYER_PROP=exports.UPDATE_LAYER_PROP="UPDATE_LAYER_PROP";var UPDATE_LAYER_STYLE=exports.UPDATE_LAYER_STYLE="UPDATE_LAYER_STYLE";var TOUCH_LAYER=exports.TOUCH_LAYER="TOUCH_LAYER";var UPDATE_SOURCE_PROP=exports.UPDATE_SOURCE_PROP="UPDATE_SOURCE_PROP";var SET_REFRESH_CONFIG=exports.SET_REFRESH_CONFIG="SET_REFRESH_CONFIG";var SET_MOUSE_COORDINATES=exports.SET_MOUSE_COORDINATES="SET_MOUSE_COORDINATES";var CLEAR_MOUSE_COORDINATES=exports.CLEAR_MOUSE_COORDINATES="CLEAR_MOUSE_COORDINATES";var SET_GOTO=exports.SET_GOTO="SET_GOTO";var CLEAR_GOTO=exports.CLEAR_GOTO="CLEAR_GOTO";var TRACK_CURRENT_LAYER_STATE=exports.TRACK_CURRENT_LAYER_STATE="TRACK_CURRENT_LAYER_STATE";var ROLLBACK_TO_TRACKED_LAYER_STATE=exports.ROLLBACK_TO_TRACKED_LAYER_STATE="ROLLBACK_TO_TRACKED_LAYER_STATE";var REMOVE_TRACKED_LAYER_STATE=exports.REMOVE_TRACKED_LAYER_STATE="REMOVE_TRACKED_LAYER_STATE";function getLayerLoadingCallbacks(dispatch,layerId){var _this=this;return{startLoading:function startLoading(dataId,requestToken,meta){return dispatch(startDataLoad(layerId,dataId,requestToken,meta))},stopLoading:function stopLoading(dataId,requestToken,data,meta){return dispatch(endDataLoad(layerId,dataId,requestToken,data,meta))},onLoadError:function onLoadError(dataId,requestToken,errorMessage){return dispatch(onDataLoadError(layerId,dataId,requestToken,errorMessage))},onRefreshStyle:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dispatch({type:TOUCH_LAYER,layerId:layerId});case 2:case"end":return _context.stop()}}},_callee,_this)}));function onRefreshStyle(){return _ref.apply(this,arguments)}return onRefreshStyle}(),updateSourceData:function updateSourceData(newData){dispatch(updateSourceDataRequest(layerId,newData))}}}function trackCurrentLayerState(layerId){return{type:TRACK_CURRENT_LAYER_STATE,layerId:layerId}}function rollbackToTrackedLayerStateForSelectedLayer(){var _this2=this;return function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(dispatch,getState){var layerId;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:layerId=(0,_map_selectors.getSelectedLayerId)(getState());_context3.next=3;return dispatch({type:ROLLBACK_TO_TRACKED_LAYER_STATE,layerId:layerId});case 3:dispatch(syncDataForLayer(layerId));case 4:case"end":return _context3.stop()}}},_callee3,_this2)}));return function(_x4,_x5){return _ref3.apply(this,arguments)}}()}function removeTrackedLayerStateForSelectedLayer(){return function(dispatch,getState){var layerId=(0,_map_selectors.getSelectedLayerId)(getState());dispatch({type:REMOVE_TRACKED_LAYER_STATE,layerId:layerId})}}function replaceLayerList(newLayerList){return function(dispatch,getState){(0,_map_selectors.getLayerListRaw)(getState()).forEach(function(_ref4){var id=_ref4.id;dispatch(removeLayer(id))});newLayerList.forEach(function(layerDescriptor){dispatch(addLayer(layerDescriptor))})}}function addLayer(layerDescriptor){return function(dispatch,getState){var isMapReady=(0,_map_selectors.getMapReady)(getState());if(!isMapReady){dispatch({type:ADD_WAITING_FOR_MAP_READY_LAYER,layer:layerDescriptor});return}dispatch({type:ADD_LAYER,layer:layerDescriptor});dispatch(syncDataForLayer(layerDescriptor.id))}}function setLayerDataLoadErrorStatus(layerId,errorMessage){return function(dispatch){dispatch({type:SET_LAYER_ERROR_STATUS,isInErrorState:errorMessage!==null,layerId:layerId,errorMessage:errorMessage})}}function toggleLayerVisible(layerId){var _this3=this;return function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(dispatch,getState){var layer,makeVisible;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:layer=(0,_map_selectors.getLayerList)(getState()).find(function(layer){return layerId===layer.getId()});if(layer){_context4.next=3;break}return _context4.abrupt("return");case 3:makeVisible=!layer.isVisible();_context4.next=6;return dispatch({type:TOGGLE_LAYER_VISIBLE,layerId:layerId});case 6:if(makeVisible){dispatch(syncDataForLayer(layerId))}case 7:case"end":return _context4.stop()}}},_callee4,_this3)}));return function(_x6,_x7){return _ref5.apply(this,arguments)}}()}function setSelectedLayer(layerId){var _this4=this;return function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(dispatch,getState){var oldSelectedLayer;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:oldSelectedLayer=(0,_map_selectors.getSelectedLayerId)(getState());if(!oldSelectedLayer){_context5.next=4;break}_context5.next=4;return dispatch(rollbackToTrackedLayerStateForSelectedLayer());case 4:if(layerId){dispatch(trackCurrentLayerState(layerId))}dispatch({type:SET_SELECTED_LAYER,selectedLayerId:layerId});case 6:case"end":return _context5.stop()}}},_callee5,_this4)}));return function(_x8,_x9){return _ref6.apply(this,arguments)}}()}function removeTransientLayer(){var _this5=this;return function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(dispatch,getState){var transientLayerId;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:transientLayerId=(0,_map_selectors.getTransientLayerId)(getState());if(!transientLayerId){_context6.next=6;break}_context6.next=4;return dispatch(removeLayer(transientLayerId));case 4:_context6.next=6;return dispatch(setTransientLayer(null));case 6:case"end":return _context6.stop()}}},_callee6,_this5)}));return function(_x10,_x11){return _ref7.apply(this,arguments)}}()}function setTransientLayer(layerId){return{type:SET_TRANSIENT_LAYER,transientLayerId:layerId}}function clearTransientLayerStateAndCloseFlyout(){var _this6=this;return function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(dispatch){return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.NONE));case 2:_context7.next=4;return dispatch(setSelectedLayer(null));case 4:_context7.next=6;return dispatch(removeTransientLayer());case 6:case"end":return _context7.stop()}}},_callee7,_this6)}));return function(_x12){return _ref8.apply(this,arguments)}}()}function updateLayerOrder(newLayerOrder){return{type:UPDATE_LAYER_ORDER,newLayerOrder:newLayerOrder}}function mapReady(){return function(dispatch,getState){dispatch({type:MAP_READY});(0,_map_selectors.getWaitingForMapReadyLayerListRaw)(getState()).forEach(function(layerDescriptor){dispatch(addLayer(layerDescriptor))});dispatch({type:CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST})}}function mapDestroyed(){return{type:MAP_DESTROYED}}function mapExtentChanged(newMapConstants){var _this7=this;return function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(dispatch,getState){var state,dataFilters,extent,newZoom,buffer,currentZoom,doesBufferContainExtent,bufferGeometry,extentGeometry,scaleFactor,width,height,newDataFilters;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:state=getState();dataFilters=(0,_map_selectors.getDataFilters)(state);extent=newMapConstants.extent,newZoom=newMapConstants.zoom;buffer=dataFilters.buffer,currentZoom=dataFilters.zoom;if(extent){doesBufferContainExtent=false;if(buffer){bufferGeometry=_turf2.default.bboxPolygon([buffer.minLon,buffer.minLat,buffer.maxLon,buffer.maxLat]);extentGeometry=_turf2.default.bboxPolygon([extent.minLon,extent.minLat,extent.maxLon,extent.maxLat]);doesBufferContainExtent=(0,_booleanContains2.default)(bufferGeometry,extentGeometry)}if(!doesBufferContainExtent||currentZoom!==newZoom){scaleFactor=.5;width=extent.maxLon-extent.minLon;height=extent.maxLat-extent.minLat;dataFilters.buffer={minLon:extent.minLon-width*scaleFactor,minLat:extent.minLat-height*scaleFactor,maxLon:extent.maxLon+width*scaleFactor,maxLat:extent.maxLat+height*scaleFactor}}}dispatch({type:MAP_EXTENT_CHANGED,mapState:_extends({},dataFilters,newMapConstants)});newDataFilters=_extends({},dataFilters,newMapConstants);_context8.next=9;return syncDataForAllLayers(getState,dispatch,newDataFilters);case 9:case"end":return _context8.stop()}}},_callee8,_this7)}));return function(_x13,_x14){return _ref9.apply(this,arguments)}}()}function setMouseCoordinates(_ref10){var lat=_ref10.lat,lon=_ref10.lon;var safeLon=lon;if(lon>180){var overlapWestOfDateLine=lon-180;safeLon=-180+overlapWestOfDateLine}else if(lon<-180){var overlapEastOfDateLine=Math.abs(lon)-180;safeLon=180-overlapEastOfDateLine}return{type:SET_MOUSE_COORDINATES,lat:lat,lon:safeLon}}function clearMouseCoordinates(){return{type:CLEAR_MOUSE_COORDINATES}}function fitToLayerExtent(layerId){return function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(dispatch,getState){var targetLayer,dataFilters,bounds;return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:targetLayer=(0,_map_selectors.getLayerList)(getState()).find(function(layer){return layer.getId()===layerId});if(!targetLayer){_context9.next=9;break}dataFilters=(0,_map_selectors.getDataFilters)(getState());_context9.next=5;return targetLayer.getBounds(dataFilters);case 5:bounds=_context9.sent;if(!bounds){_context9.next=9;break}_context9.next=9;return dispatch(setGotoWithBounds(bounds));case 9:case"end":return _context9.stop()}}},_callee9,this)}));return function(_x15,_x16){return _ref11.apply(this,arguments)}}()}function setGotoWithBounds(bounds){return{type:SET_GOTO,bounds:bounds}}function setGotoWithCenter(_ref12){var lat=_ref12.lat,lon=_ref12.lon,zoom=_ref12.zoom;return{type:SET_GOTO,center:{lat:lat,lon:lon,zoom:zoom}}}function clearGoto(){return{type:CLEAR_GOTO}}function startDataLoad(layerId,dataId,requestToken){var meta=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return{meta:meta,type:LAYER_DATA_LOAD_STARTED,layerId:layerId,dataId:dataId,requestToken:requestToken}}function updateSourceDataRequest(layerId,newData){return{type:UPDATE_SOURCE_DATA_REQUEST,dataId:_constants.SOURCE_DATA_ID_ORIGIN,layerId:layerId,newData:newData}}function endDataLoad(layerId,dataId,requestToken,data,meta){var _this8=this;return function(){var _ref13=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(dispatch){return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:dispatch({type:LAYER_DATA_LOAD_ENDED,layerId:layerId,dataId:dataId,data:data,meta:meta,requestToken:requestToken});dispatch(setLayerDataLoadErrorStatus(layerId,null));case 2:case"end":return _context10.stop()}}},_callee10,_this8)}));return function(_x18){return _ref13.apply(this,arguments)}}()}function onDataLoadError(layerId,dataId,requestToken,errorMessage){var _this9=this;return function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(dispatch){return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:dispatch({type:LAYER_DATA_LOAD_ERROR,layerId:layerId,dataId:dataId,requestToken:requestToken});dispatch(setLayerDataLoadErrorStatus(layerId,errorMessage));case 2:case"end":return _context11.stop()}}},_callee11,_this9)}));return function(_x19){return _ref14.apply(this,arguments)}}()}function updateSourceProp(layerId,propName,value){var _this10=this;return function(){var _ref15=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(dispatch){return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:dispatch({type:UPDATE_SOURCE_PROP,layerId:layerId,propName:propName,value:value});_context12.next=3;return dispatch(clearMissingStyleProperties(layerId));case 3:dispatch(syncDataForLayer(layerId));case 4:case"end":return _context12.stop()}}},_callee12,_this10)}));return function(_x20){return _ref15.apply(this,arguments)}}()}function syncDataForLayer(layerId){var _this11=this;return function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(dispatch,getState){var targetLayer,dataFilters,loadingFunctions;return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:targetLayer=(0,_map_selectors.getLayerList)(getState()).find(function(layer){return layer.getId()===layerId});if(!targetLayer){_context13.next=6;break}dataFilters=(0,_map_selectors.getDataFilters)(getState());loadingFunctions=getLayerLoadingCallbacks(dispatch,layerId);_context13.next=6;return targetLayer.syncData(_extends({},loadingFunctions,{dataFilters:dataFilters}));case 6:case"end":return _context13.stop()}}},_callee13,_this11)}));return function(_x21,_x22){return _ref16.apply(this,arguments)}}()}function updateLayerLabel(id,newLabel){return{type:UPDATE_LAYER_PROP,id:id,propName:"label",newValue:newLabel}}function updateLayerMinZoom(id,minZoom){return{type:UPDATE_LAYER_PROP,id:id,propName:"minZoom",newValue:minZoom}}function updateLayerMaxZoom(id,maxZoom){return{type:UPDATE_LAYER_PROP,id:id,propName:"maxZoom",newValue:maxZoom}}function updateLayerAlpha(id,alpha){return{type:UPDATE_LAYER_PROP,id:id,propName:"alpha",newValue:alpha}}function removeSelectedLayer(){return function(dispatch,getState){var state=getState();var layerId=(0,_map_selectors.getSelectedLayerId)(state);dispatch(removeLayer(layerId));dispatch(setSelectedLayer(null))}}function removeLayer(id){return function(dispatch,getState){var layerGettingRemoved=(0,_map_selectors.getLayerList)(getState()).find(function(layer){return id===layer.getId()});if(layerGettingRemoved){layerGettingRemoved.destroy()}dispatch({type:REMOVE_LAYER,id:id})}}function setQuery(_ref17){var _this12=this;var query=_ref17.query,timeFilters=_ref17.timeFilters;return function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee14(dispatch,getState){var dataFilters;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:dispatch({type:SET_QUERY,timeFilters:timeFilters,query:_extends({},query,{queryLastTriggeredAt:(new Date).toISOString()})});dataFilters=(0,_map_selectors.getDataFilters)(getState());_context14.next=4;return syncDataForAllLayers(getState,dispatch,dataFilters);case 4:case"end":return _context14.stop()}}},_callee14,_this12)}));return function(_x23,_x24){return _ref18.apply(this,arguments)}}()}function setRefreshConfig(_ref19){var isPaused=_ref19.isPaused,interval=_ref19.interval;return{type:SET_REFRESH_CONFIG,isPaused:isPaused,interval:interval}}function triggerRefreshTimer(){var _this13=this;return function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee15(dispatch,getState){var dataFilters;return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:dispatch({type:TRIGGER_REFRESH_TIMER});dataFilters=(0,_map_selectors.getDataFilters)(getState());_context15.next=4;return syncDataForAllLayers(getState,dispatch,dataFilters);case 4:case"end":return _context15.stop()}}},_callee15,_this13)}));return function(_x25,_x26){return _ref20.apply(this,arguments)}}()}function clearMissingStyleProperties(layerId){var _this14=this;return function(){var _ref21=_asyncToGenerator(regeneratorRuntime.mark(function _callee16(dispatch,getState){var targetLayer,style,ordinalFields,_style$getDescriptorW,hasChanges,nextStyleDescriptor;return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:targetLayer=(0,_map_selectors.getLayerList)(getState()).find(function(layer){return layer.getId()===layerId});if(targetLayer){_context16.next=3;break}return _context16.abrupt("return");case 3:style=targetLayer.getCurrentStyle();if(style){_context16.next=6;break}return _context16.abrupt("return");case 6:_context16.next=8;return targetLayer.getOrdinalFields();case 8:ordinalFields=_context16.sent;_style$getDescriptorW=style.getDescriptorWithMissingStylePropsRemoved(ordinalFields),hasChanges=_style$getDescriptorW.hasChanges,nextStyleDescriptor=_style$getDescriptorW.nextStyleDescriptor;if(hasChanges){dispatch(updateLayerStyle(layerId,nextStyleDescriptor))}case 11:case"end":return _context16.stop()}}},_callee16,_this14)}));return function(_x27,_x28){return _ref21.apply(this,arguments)}}()}function updateLayerStyle(layerId,styleDescriptor){return function(dispatch){dispatch({type:UPDATE_LAYER_STYLE,layerId:layerId,style:_extends({},styleDescriptor)});dispatch(syncDataForLayer(layerId))}}function updateLayerStyleForSelectedLayer(styleDescriptor){return function(dispatch,getState){var selectedLayerId=(0,_map_selectors.getSelectedLayerId)(getState());if(!selectedLayerId){return}dispatch(updateLayerStyle(selectedLayerId,styleDescriptor))}}function setJoinsForLayer(layer,joins){var _this15=this;return function(){var _ref22=_asyncToGenerator(regeneratorRuntime.mark(function _callee17(dispatch){return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:_context17.next=2;return dispatch({type:SET_JOINS,layer:layer,joins:joins});case 2:_context17.next=4;return dispatch(clearMissingStyleProperties(layer.getId()));case 4:dispatch(syncDataForLayer(layer.getId()));case 5:case"end":return _context17.stop()}}},_callee17,_this15)}));return function(_x29){return _ref22.apply(this,arguments)}}()}},227:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchSearchSourceAndRecordWithInspector=exports.inspectorAdapters=exports.emsServiceSettings=exports.SearchSource=exports.indexPatternService=exports.timeService=undefined;var fetchSearchSourceAndRecordWithInspector=exports.fetchSearchSourceAndRecordWithInspector=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(_ref){var searchSource=_ref.searchSource,requestId=_ref.requestId,requestName=_ref.requestName,requestDesc=_ref.requestDesc;var inspectorRequest,resp;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:inspectorRequest=inspectorAdapters.requests.start(requestName,{id:requestId,description:requestDesc});resp=void 0;_context.prev=2;inspectorRequest.stats((0,_courier_inspector_utils.getRequestInspectorStats)(searchSource));searchSource.getSearchRequestBody().then(function(body){inspectorRequest.json(body)});_context.next=7;return searchSource.fetch();case 7:resp=_context.sent;inspectorRequest.stats((0,_courier_inspector_utils.getResponseInspectorStats)(searchSource,resp)).ok({json:resp});_context.next=15;break;case 11:_context.prev=11;_context.t0=_context["catch"](2);inspectorRequest.error({error:_context.t0});throw _context.t0;case 15:return _context.abrupt("return",resp);case 16:case"end":return _context.stop()}}},_callee,this,[[2,11]])}));return function fetchSearchSourceAndRecordWithInspector(_x){return _ref2.apply(this,arguments)}}();var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _modules=__webpack_require__(7);var _courier=__webpack_require__(175);var _adapters=__webpack_require__(371);var _map_adapter=__webpack_require__(3327);var _timefilter=__webpack_require__(490);var _courier_inspector_utils=__webpack_require__(421);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}var timeService=exports.timeService=_timefilter.timefilter;var indexPatternService=exports.indexPatternService=void 0;var SearchSource=exports.SearchSource=void 0;var emsServiceSettings=exports.emsServiceSettings=void 0;var inspectorAdapters=exports.inspectorAdapters={requests:new _adapters.RequestAdapter};if(_chrome2.default.getInjected("showMapsInspectorAdapter",false)){inspectorAdapters.map=new _map_adapter.MapAdapter}_modules.uiModules.get("app/maps").run(function($injector){exports.indexPatternService=indexPatternService=$injector.get("indexPatterns");var Private=$injector.get("Private");exports.SearchSource=SearchSource=Private(_courier.SearchSourceProvider);exports.emsServiceSettings=emsServiceSettings=$injector.get("serviceSettings")})},267:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getIsFullScreen=exports.getIsSetViewOpen=exports.getFlyoutDisplay=exports.FLYOUT_STATE=exports.SET_FULL_SCREEN=exports.OPEN_SET_VIEW=exports.CLOSE_SET_VIEW=exports.UPDATE_FLYOUT=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.updateFlyout=updateFlyout;exports.closeSetView=closeSetView;exports.openSetView=openSetView;exports.exitFullScreen=exitFullScreen;exports.enableFullScreen=enableFullScreen;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var UPDATE_FLYOUT=exports.UPDATE_FLYOUT="UPDATE_FLYOUT";var CLOSE_SET_VIEW=exports.CLOSE_SET_VIEW="CLOSE_SET_VIEW";var OPEN_SET_VIEW=exports.OPEN_SET_VIEW="OPEN_SET_VIEW";var SET_FULL_SCREEN=exports.SET_FULL_SCREEN="SET_FULL_SCREEN";var FLYOUT_STATE=exports.FLYOUT_STATE={NONE:"NONE",LAYER_PANEL:"LAYER_PANEL",ADD_LAYER_WIZARD:"ADD_LAYER_WIZARD"};var INITIAL_STATE={flyoutDisplay:FLYOUT_STATE.NONE,isFullScreen:false};function ui(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:INITIAL_STATE;var action=arguments[1];switch(action.type){case UPDATE_FLYOUT:return _extends({},state,{flyoutDisplay:action.display});case CLOSE_SET_VIEW:return _extends({},state,{isSetViewOpen:false});case OPEN_SET_VIEW:return _extends({},state,{isSetViewOpen:true});case SET_FULL_SCREEN:return _extends({},state,{isFullScreen:action.isFullScreen});default:return state}}function updateFlyout(display){return{type:UPDATE_FLYOUT,display:display}}function closeSetView(){return{type:CLOSE_SET_VIEW}}function openSetView(){return{type:OPEN_SET_VIEW}}function exitFullScreen(){return{type:SET_FULL_SCREEN,isFullScreen:false}}function enableFullScreen(){return{type:SET_FULL_SCREEN,isFullScreen:true}}var getFlyoutDisplay=exports.getFlyoutDisplay=function getFlyoutDisplay(_ref){var ui=_ref.ui;return ui&&ui.flyoutDisplay||INITIAL_STATE.flyoutDisplay};var getIsSetViewOpen=exports.getIsSetViewOpen=function getIsSetViewOpen(_ref2){var ui=_ref2.ui;return _lodash2.default.get(ui,"isSetViewOpen",false)};var getIsFullScreen=exports.getIsFullScreen=function getIsFullScreen(_ref3){var ui=_ref3.ui;return _lodash2.default.get(ui,"isFullScreen",false)};exports.default=ui},290:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getKibanaTileMap=exports.getKibanaRegionList=exports.getEmsTMSServices=exports.getEmsVectorFilesMeta=exports.getDataSources=undefined;var getDataSources=exports.getDataSources=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this=this;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!meta){_context2.next=2;break}return _context2.abrupt("return",meta);case 2:if(!loadingMetaPromise){_context2.next=4;break}return _context2.abrupt("return",loadingMetaPromise);case 4:loadingMetaPromise=new Promise(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(resolve,reject){var response,metaJson;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(GIS_API_RELATIVE+"/meta");case 3:response=_context.sent;_context.next=6;return response.json();case 6:metaJson=_context.sent;isLoaded=true;meta=metaJson.data_sources;resolve(meta);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context["catch"](0);reject(_context.t0);case 15:case"end":return _context.stop()}}},_callee,_this,[[0,12]])}));return function(_x,_x2){return _ref2.apply(this,arguments)}}());return _context2.abrupt("return",loadingMetaPromise);case 6:case"end":return _context2.stop()}}},_callee2,this)}));return function getDataSources(){return _ref.apply(this,arguments)}}();var getEmsVectorFilesMeta=exports.getEmsVectorFilesMeta=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var dataSource;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getDataSources();case 2:dataSource=_context3.sent;return _context3.abrupt("return",_lodash2.default.get(dataSource,"ems.file",[]));case 4:case"end":return _context3.stop()}}},_callee3,this)}));return function getEmsVectorFilesMeta(){return _ref3.apply(this,arguments)}}();var getEmsTMSServices=exports.getEmsTMSServices=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var dataSource;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return getDataSources();case 2:dataSource=_context4.sent;return _context4.abrupt("return",_lodash2.default.get(dataSource,"ems.tms",[]));case 4:case"end":return _context4.stop()}}},_callee4,this)}));return function getEmsTMSServices(){return _ref4.apply(this,arguments)}}();var getKibanaRegionList=exports.getKibanaRegionList=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var dataSource;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return getDataSources();case 2:dataSource=_context5.sent;return _context5.abrupt("return",_lodash2.default.get(dataSource,"kibana.regionmap",[]));case 4:case"end":return _context5.stop()}}},_callee5,this)}));return function getKibanaRegionList(){return _ref5.apply(this,arguments)}}();var getKibanaTileMap=exports.getKibanaTileMap=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var dataSource;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return getDataSources();case 2:dataSource=_context6.sent;return _context6.abrupt("return",_lodash2.default.get(dataSource,"kibana.tilemap",{}));case 4:case"end":return _context6.stop()}}},_callee6,this)}));return function getKibanaTileMap(){return _ref6.apply(this,arguments)}}();exports.getDataSourcesSync=getDataSourcesSync;exports.isMetaDataLoaded=isMetaDataLoaded;var _constants=__webpack_require__(193);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}var GIS_API_RELATIVE="../"+_constants.GIS_API_PATH;var meta=null;var loadingMetaPromise=null;var isLoaded=false;function getDataSourcesSync(){return meta}function isMetaDataLoaded(){return isLoaded}},332:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStyle=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _i18n=__webpack_require__(5);var _additional_layer_icons=__webpack_require__(3334);var _color_gradient=__webpack_require__(1221);var _color_utils=__webpack_require__(3335);var _vector_style_editor=__webpack_require__(3336);var _vector_style_defaults=__webpack_require__(762);var _abstract_style=__webpack_require__(757);var _constants=__webpack_require__(193);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VectorStyle=exports.VectorStyle=function(_AbstractStyle){_inherits(VectorStyle,_AbstractStyle);_createClass(VectorStyle,null,[{key:"getComputedFieldName",value:function getComputedFieldName(fieldName){return"__kbn__scaled("+fieldName+")"}}]);function VectorStyle(){var descriptor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,VectorStyle);var _this=_possibleConstructorReturn(this,(VectorStyle.__proto__||Object.getPrototypeOf(VectorStyle)).call(this));_this.getIcon=function(){var defaultStyle={stroke:"grey",strokeWidth:"1px",fill:"none"};return function(){var isPointsOnly=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var style=_extends({},defaultStyle);var isDynamic=_this._isPropertyDynamic("fillColor");if(!isDynamic){var _this$_descriptor$pro=_this._descriptor.properties,fillColor=_this$_descriptor$pro.fillColor,lineColor=_this$_descriptor$pro.lineColor;var stroke=_lodash2.default.get(lineColor,"options.color");var fill=_lodash2.default.get(fillColor,"options.color");style=_extends({},style,stroke&&{stroke:stroke},fill&&{fill:fill})}return isPointsOnly?_react2.default.createElement(_additional_layer_icons.FillableCircle,{style:style}):_react2.default.createElement(_additional_layer_icons.FillableVector,{style:style})}}();_this._descriptor=VectorStyle.createDescriptor(descriptor.properties);return _this}_createClass(VectorStyle,[{key:"getDescriptorWithMissingStylePropsRemoved",value:function getDescriptorWithMissingStylePropsRemoved(nextOrdinalFields){var _this2=this;var originalProperties=this.getProperties();var updatedProperties={};Object.keys(originalProperties).forEach(function(propertyName){if(!_this2._isPropertyDynamic(propertyName)){return}var fieldName=_lodash2.default.get(originalProperties[propertyName],"options.field.name");if(!fieldName){return}var matchingOrdinalField=nextOrdinalFields.find(function(oridinalField){return fieldName===oridinalField.name});if(matchingOrdinalField){return}updatedProperties[propertyName]={type:VectorStyle.STYLE_TYPE.DYNAMIC,options:_extends({},originalProperties[propertyName].options)};delete updatedProperties[propertyName].options.field});if(Object.keys(updatedProperties).length===0){return{hasChanges:false,nextStyleDescriptor:_extends({},this._descriptor)}}return{hasChanges:true,nextStyleDescriptor:VectorStyle.createDescriptor(_extends({},originalProperties,updatedProperties))}}},{key:"getSourceFieldNames",value:function getSourceFieldNames(){var _this3=this;var properties=this.getProperties();var fieldNames=[];Object.keys(properties).forEach(function(propertyName){if(!_this3._isPropertyDynamic(propertyName)){return}var field=_lodash2.default.get(properties[propertyName],"options.field",{});if(field.origin===_constants.SOURCE_DATA_ID_ORIGIN&&field.name){fieldNames.push(field.name)}});return fieldNames}},{key:"getProperties",value:function getProperties(){return this._descriptor.properties||{}}},{key:"_isPropertyDynamic",value:function _isPropertyDynamic(property){if(!this._descriptor.properties[property]){return false}return this._descriptor.properties[property].type===VectorStyle.STYLE_TYPE.DYNAMIC}},{key:"getColorRamp",value:function getColorRamp(){var color=_lodash2.default.get(this._descriptor,"properties.fillColor.options.color");return color&&this._isPropertyDynamic("fillColor")?_react2.default.createElement(_color_gradient.ColorGradient,{color:color}):null}},{key:"getTOCDetails",value:function getTOCDetails(){var isDynamic=this._isPropertyDynamic("fillColor");if(isDynamic){return _react2.default.createElement(_react2.default.Fragment,null,this.getColorRamp())}return null}},{key:"addScaledPropertiesBasedOnStyle",value:function addScaledPropertiesBasedOnStyle(featureCollection){if(!this._isPropertyDynamic("fillColor")&&!this._isPropertyDynamic("lineColor")&&!this._isPropertyDynamic("iconSize")&&!this._isPropertyDynamic("lineWidth")){return false}if(!featureCollection){return false}if(!featureCollection.computed){featureCollection.computed=[]}var dynamicFields=[];if(this._descriptor.properties.fillColor&&this._descriptor.properties.fillColor.options&&this._descriptor.properties.fillColor.options.field){dynamicFields.push(this._descriptor.properties.fillColor.options.field)}if(this._descriptor.properties.lineColor&&this._descriptor.properties.lineColor.options&&this._descriptor.properties.lineColor.options.field){dynamicFields.push(this._descriptor.properties.lineColor.options.field)}if(this._descriptor.properties.iconSize&&this._descriptor.properties.iconSize.options&&this._descriptor.properties.iconSize.options.field){dynamicFields.push(this._descriptor.properties.iconSize.options.field)}if(this._descriptor.properties.lineWidth&&this._descriptor.properties.lineWidth.options&&this._descriptor.properties.lineWidth.options.field){dynamicFields.push(this._descriptor.properties.lineWidth.options.field)}var updateStatuses=dynamicFields.map(function(field){return VectorStyle.computeScaledValues(featureCollection,field)});return updateStatuses.some(function(r){return r===true})}},{key:"_getMBDataDrivenColor",value:function _getMBDataDrivenColor(_ref){var fieldName=_ref.fieldName,color=_ref.color;var colorRange=(0,_color_utils.getHexColorRangeStrings)(color,8).reduce(function(accu,curColor,idx,srcArr){accu=[].concat(_toConsumableArray(accu),[idx/srcArr.length,curColor]);return accu},[]);var targetName=VectorStyle.getComputedFieldName(fieldName);return["interpolate",["linear"],["coalesce",["get",targetName],-1],-1,"rgba(0,0,0,0)"].concat(_toConsumableArray(colorRange))}},{key:"_getMbDataDrivenSize",value:function _getMbDataDrivenSize(_ref2){var fieldName=_ref2.fieldName,minSize=_ref2.minSize,maxSize=_ref2.maxSize;var targetName=VectorStyle.getComputedFieldName(fieldName);return["interpolate",["linear"],["get",targetName],0,minSize,1,maxSize]}},{key:"_getMBColor",value:function _getMBColor(styleDescriptor){var isStatic=styleDescriptor.type===VectorStyle.STYLE_TYPE.STATIC;if(isStatic){return _lodash2.default.get(styleDescriptor,"options.color",null)}var isDynamicConfigComplete=_lodash2.default.has(styleDescriptor,"options.field.name")&&_lodash2.default.has(styleDescriptor,"options.color");if(isDynamicConfigComplete){return this._getMBDataDrivenColor({fieldName:styleDescriptor.options.field.name,color:styleDescriptor.options.color})}return null}},{key:"_getMbSize",value:function _getMbSize(styleDescriptor){if(styleDescriptor.type===VectorStyle.STYLE_TYPE.STATIC){return styleDescriptor.options.size}var isDynamicConfigComplete=_lodash2.default.has(styleDescriptor,"options.field.name")&&_lodash2.default.has(styleDescriptor,"options.minSize")&&_lodash2.default.has(styleDescriptor,"options.maxSize");if(isDynamicConfigComplete){return this._getMbDataDrivenSize({fieldName:styleDescriptor.options.field.name,minSize:styleDescriptor.options.minSize,maxSize:styleDescriptor.options.maxSize})}return null}},{key:"setMBPaintProperties",value:function setMBPaintProperties(_ref3){var alpha=_ref3.alpha,mbMap=_ref3.mbMap,fillLayerId=_ref3.fillLayerId,lineLayerId=_ref3.lineLayerId;if(this._descriptor.properties.fillColor){var color=this._getMBColor(this._descriptor.properties.fillColor);mbMap.setPaintProperty(fillLayerId,"fill-color",color);mbMap.setPaintProperty(fillLayerId,"fill-opacity",alpha)}else{mbMap.setPaintProperty(fillLayerId,"fill-color",null);mbMap.setPaintProperty(fillLayerId,"fill-opacity",0)}if(this._descriptor.properties.lineColor){var _color=this._getMBColor(this._descriptor.properties.lineColor);mbMap.setPaintProperty(lineLayerId,"line-color",_color);mbMap.setPaintProperty(lineLayerId,"line-opacity",alpha)}else{mbMap.setPaintProperty(lineLayerId,"line-color",null);mbMap.setPaintProperty(lineLayerId,"line-opacity",0)}if(this._descriptor.properties.lineWidth){var lineWidth=this._getMbSize(this._descriptor.properties.lineWidth);mbMap.setPaintProperty(lineLayerId,"line-width",lineWidth)}else{mbMap.setPaintProperty(lineLayerId,"line-width",0)}}},{key:"setMBPaintPropertiesForPoints",value:function setMBPaintPropertiesForPoints(_ref4){var alpha=_ref4.alpha,mbMap=_ref4.mbMap,pointLayerId=_ref4.pointLayerId;if(this._descriptor.properties.fillColor){var color=this._getMBColor(this._descriptor.properties.fillColor);mbMap.setPaintProperty(pointLayerId,"circle-color",color);mbMap.setPaintProperty(pointLayerId,"circle-opacity",alpha)}else{mbMap.setPaintProperty(pointLayerId,"circle-color",null);mbMap.setPaintProperty(pointLayerId,"circle-opacity",0)}if(this._descriptor.properties.lineColor){var _color2=this._getMBColor(this._descriptor.properties.lineColor);mbMap.setPaintProperty(pointLayerId,"circle-stroke-color",_color2);mbMap.setPaintProperty(pointLayerId,"circle-stroke-opacity",alpha)}else{mbMap.setPaintProperty(pointLayerId,"circle-stroke-color",null);mbMap.setPaintProperty(pointLayerId,"circle-stroke-opacity",0)}if(this._descriptor.properties.lineWidth){var lineWidth=this._getMbSize(this._descriptor.properties.lineWidth);mbMap.setPaintProperty(pointLayerId,"circle-stroke-width",lineWidth)}else{mbMap.setPaintProperty(pointLayerId,"circle-stroke-width",0)}if(this._descriptor.properties.iconSize){var iconSize=this._getMbSize(this._descriptor.properties.iconSize);mbMap.setPaintProperty(pointLayerId,"circle-radius",iconSize)}else{mbMap.setPaintProperty(pointLayerId,"circle-radius",0)}}}],[{key:"canEdit",value:function canEdit(styleInstance){return styleInstance.constructor===VectorStyle}},{key:"createDescriptor",value:function createDescriptor(){var properties=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{type:VectorStyle.type,properties:_extends({},(0,_vector_style_defaults.getDefaultStaticProperties)(),properties)}}},{key:"createDefaultStyleProperties",value:function createDefaultStyleProperties(mapColors){return(0,_vector_style_defaults.getDefaultStaticProperties)(mapColors)}},{key:"getDisplayName",value:function getDisplayName(){return _i18n.i18n.translate("xpack.maps.style.vector.displayNameLabel",{defaultMessage:"Vector style"})}},{key:"renderEditor",value:function renderEditor(_ref5){var handleStyleChange=_ref5.handleStyleChange,style=_ref5.style,layer=_ref5.layer;var styleProperties=_extends({},style.getProperties());var handlePropertyChange=function handlePropertyChange(propertyName,settings){styleProperties[propertyName]=settings;var vectorStyleDescriptor=VectorStyle.createDescriptor(styleProperties);handleStyleChange(vectorStyleDescriptor)};return _react2.default.createElement(_vector_style_editor.VectorStyleEditor,{handlePropertyChange:handlePropertyChange,styleProperties:styleProperties,layer:layer})}},{key:"computeScaledValues",value:function computeScaledValues(featureCollection,field){var fieldName=field.name;var features=featureCollection.features;if(!features.length){return false}var min=Infinity;var max=-Infinity;for(var i=0;i<features.length;i++){var newValue=parseFloat(features[i].properties[fieldName]);if(!isNaN(newValue)){min=Math.min(min,newValue);max=Math.max(max,newValue)}}var diff=max-min;var propName=VectorStyle.getComputedFieldName(fieldName);for(var _i=0;_i<features.length;_i++){var unscaledValue=parseFloat(features[_i].properties[fieldName]);var scaledValue=void 0;if(isNaN(unscaledValue)){scaledValue=-1}else if(diff===0){scaledValue=1}else{scaledValue=(features[_i].properties[fieldName]-min)/diff}features[_i].properties[propName]=scaledValue}featureCollection.computed.push(fieldName);return true}}]);return VectorStyle}(_abstract_style.AbstractStyle);VectorStyle.type="VECTOR";VectorStyle.STYLE_TYPE={DYNAMIC:"DYNAMIC",STATIC:"STATIC"};VectorStyle.description=""},3325:function(module,exports,__webpack_require__){"use strict";__webpack_require__(70);__webpack_require__(71);__webpack_require__(72);__webpack_require__(73);__webpack_require__(74);__webpack_require__(75);__webpack_require__(76);__webpack_require__(77);__webpack_require__(78);__webpack_require__(79);__webpack_require__(80);__webpack_require__(81);__webpack_require__(82);__webpack_require__(83);__webpack_require__(84);__webpack_require__(85);__webpack_require__(86);__webpack_require__(87);__webpack_require__(88);__webpack_require__(89);__webpack_require__(90);__webpack_require__(91);__webpack_require__(92);__webpack_require__(93);__webpack_require__(94);__webpack_require__(95);__webpack_require__(96);__webpack_require__(97);__webpack_require__(98);__webpack_require__(99);__webpack_require__(100);__webpack_require__(101);__webpack_require__(102);__webpack_require__(103);__webpack_require__(104);__webpack_require__(105);__webpack_require__(106);__webpack_require__(107);__webpack_require__(108);__webpack_require__(109);__webpack_require__(110);__webpack_require__(111);__webpack_require__(112);__webpack_require__(113);__webpack_require__(114);__webpack_require__(115);__webpack_require__(116);__webpack_require__(117);__webpack_require__(118);__webpack_require__(119);__webpack_require__(120);__webpack_require__(121);__webpack_require__(122);__webpack_require__(123);__webpack_require__(124);__webpack_require__(125);__webpack_require__(126);__webpack_require__(127);__webpack_require__(128);__webpack_require__(129);__webpack_require__(130);__webpack_require__(131);__webpack_require__(132);__webpack_require__(133);__webpack_require__(134);__webpack_require__(135);__webpack_require__(136);__webpack_require__(137);__webpack_require__(138);__webpack_require__(139);__webpack_require__(140);__webpack_require__(141);__webpack_require__(142);__webpack_require__(143);__webpack_require__(144);__webpack_require__(145);__webpack_require__(146);__webpack_require__(147);__webpack_require__(148);__webpack_require__(149);__webpack_require__(150);__webpack_require__(151);__webpack_require__(152);__webpack_require__(153);__webpack_require__(154);__webpack_require__(155);__webpack_require__(156);__webpack_require__(157);__webpack_require__(158);__webpack_require__(159);__webpack_require__(160);__webpack_require__(161);__webpack_require__(162);__webpack_require__(163);__webpack_require__(164);__webpack_require__(165);__webpack_require__(166);__webpack_require__(167);__webpack_require__(168);__webpack_require__(172);var _i18n=__webpack_require__(5);var _kibanaCore__=__webpack_require__(169);var injectedMetadata=JSON.parse(document.querySelector("kbn-injected-metadata").getAttribute("data"));_i18n.i18n.load(injectedMetadata.i18n.translationsUrl).catch(function(e){return e}).then(function(i18nError){var coreSystem=new _kibanaCore__.CoreSystem({injectedMetadata:injectedMetadata,rootDomElement:document.body,requireLegacyFiles:function requireLegacyFiles(){__webpack_require__(3326)}});var coreStartContract=coreSystem.start();if(i18nError){coreStartContract.fatalErrors.add(i18nError)}})},3326:function(module,exports,__webpack_require__){"use strict";__webpack_require__(227);__webpack_require__(3328);__webpack_require__(3329);__webpack_require__(374);__webpack_require__(320);__webpack_require__(730);__webpack_require__(733);__webpack_require__(301);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _routes=__webpack_require__(13);var _routes2=_interopRequireDefault(_routes);var _modules=__webpack_require__(7);var _doc_title=__webpack_require__(280);__webpack_require__(239);__webpack_require__(202);__webpack_require__(740);__webpack_require__(3330);__webpack_require__(534);__webpack_require__(3331);__webpack_require__(3373);var _listing_ng_wrapper=__webpack_require__(3413);var _listing_ng_wrapper2=_interopRequireDefault(_listing_ng_wrapper);var _map=__webpack_require__(3414);var _map2=_interopRequireDefault(_map);var _map_listing=__webpack_require__(3415);var _persisted_log=__webpack_require__(186);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var app=_modules.uiModules.get("app/maps",["ngRoute","react"]);app.directive("mapListing",function(reactDirective){return reactDirective(_map_listing.MapListing)});_routes2.default.enable();_routes2.default.when("/",{template:_listing_ng_wrapper2.default,controller:function controller($scope,gisMapSavedObjectLoader,config){$scope.listingLimit=config.get("savedObjects:listingLimit");$scope.find=function(search){return gisMapSavedObjectLoader.find(search,$scope.listingLimit)};$scope.delete=function(ids){return gisMapSavedObjectLoader.delete(ids)}},resolve:{hasMaps:function hasMaps(kbnUrl){_chrome2.default.getSavedObjectsClient().find({type:"map",perPage:1}).then(function(resp){if(resp.savedObjects.length===0){kbnUrl.redirect("/map")}return true})}}}).when("/map",{template:_map2.default,controller:"GisMapController",resolve:{map:function map(gisMapSavedObjectLoader,redirectWhenMissing){return gisMapSavedObjectLoader.get().catch(redirectWhenMissing({map:"/"}))}}}).when("/map/:id",{template:_map2.default,controller:"GisMapController",resolve:{map:function map(gisMapSavedObjectLoader,redirectWhenMissing,$route,Private){var id=$route.current.params.id;var docTitle=Private(_doc_title.DocTitleProvider);return gisMapSavedObjectLoader.get(id).then(function(savedMap){_persisted_log.recentlyAccessed.add(savedMap.getFullPath(),savedMap.title,id);docTitle.change(savedMap.title);return savedMap}).catch(redirectWhenMissing({map:"/"}))}}}).otherwise({redirectTo:"/"})},3327:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MapAdapter=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _events=__webpack_require__(210);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MapAdapter=function(_EventEmitter){_inherits(MapAdapter,_EventEmitter);function MapAdapter(){_classCallCheck(this,MapAdapter);return _possibleConstructorReturn(this,(MapAdapter.__proto__||Object.getPrototypeOf(MapAdapter)).apply(this,arguments))}_createClass(MapAdapter,[{key:"setMapState",value:function setMapState(_ref){var stats=_ref.stats,style=_ref.style;this.stats=stats;this.style=style;this._onChange()}},{key:"getMapState",value:function getMapState(){return{stats:this.stats,style:this.style}}},{key:"_onChange",value:function _onChange(){this.emit("change")}}]);return MapAdapter}(_events.EventEmitter);exports.MapAdapter=MapAdapter},3328:function(module,exports,__webpack_require__){"use strict";var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*! jQuery UI - v1.12.1 - 2018-06-01
* http://jqueryui.com
* Includes: widget.js, data.js, scroll-parent.js, widgets/sortable.js, widgets/mouse.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
/*! jQuery UI - v1.12.1 - 2018-06-01
* http://jqueryui.com
* Includes: widget.js, data.js, scroll-parent.js, widgets/sortable.js, widgets/mouse.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
(function(factory){if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(17)],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})(function($){$.ui=$.ui||{};var version=$.ui.version="1.12.1";
/*!
  * jQuery UI Widget 1.12.1
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
  * Released under the MIT license.
  * http://jquery.org/license
  */var widgetUuid=0;var widgetSlice=Array.prototype.slice;$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove")}}catch(e){}}orig(elems)}}($.cleanData);$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype;var proxiedPrototype={};var namespace=name.split(".")[0];name=name.split(".")[1];var fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}if($.isArray(prototype)){prototype=$.extend.apply(null,[{}].concat(prototype))}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element)}if(arguments.length){this._createWidget(options,element)}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return}proxiedPrototype[prop]=function(){function _super(){return base.prototype[prop].apply(this,arguments)}function _superApply(args){return base.prototype[prop].apply(this,args)}return function(){var __super=this._super;var __superApply=this._superApply;var returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}()});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else{base._childConstructors.push(constructor)}$.widget.bridge(name,constructor);return constructor};$.widget.extend=function(target){var input=widgetSlice.call(arguments,1);var inputIndex=0;var inputLength=input.length;var key;var value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value)}else{target[key]=value}}}}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string";var args=widgetSlice.call(arguments,1);var returnValue=this;if(isMethodCall){if(!this.length&&options==="instance"){returnValue=undefined}else{this.each(function(){var methodValue;var instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false}if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance")}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false}})}}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args))}this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init()}}else{$.data(this,fullName,new object(options,this))}})}return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:false,create:null},_createWidget:function _createWidget(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widgetUuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.classesElementLookup={};if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function remove(event){if(event.target===element){this.destroy()}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();if(this.options.disabled){this._setOptionDisabled(this.options.disabled)}this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:function _getCreateOptions(){return{}},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function destroy(){var that=this;this._destroy();$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key)});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace)},_destroy:$.noop,widget:function widget(){return this.element},option:function option(key,value){var options=key;var parts;var curOption;var i;if(arguments.length===0){return $.widget.extend({},this.options)}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key]}curOption[key]=value}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key]}options[key]=value}}this._setOptions(options);return this},_setOptions:function _setOptions(options){var key;for(key in options){this._setOption(key,options[key])}return this},_setOption:function _setOption(key,value){if(key==="classes"){this._setOptionClasses(value)}this.options[key]=value;if(key==="disabled"){this._setOptionDisabled(value)}return this},_setOptionClasses:function _setOptionClasses(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length){continue}elements=$(currentElements.get());this._removeClass(currentElements,classKey);elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:true}))}},_setOptionDisabled:function _setOptionDisabled(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value);if(value){this._removeClass(this.hoverable,null,"ui-state-hover");this._removeClass(this.focusable,null,"ui-state-focus")}},enable:function enable(){return this._setOptions({disabled:false})},disable:function disable(){return this._setOptions({disabled:true})},_classes:function _classes(options){var full=[];var that=this;options=$.extend({element:this.element,classes:this.options.classes||{}},options);function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||$();if(options.add){current=$($.unique(current.get().concat(options.element.get())))}else{current=$(current.not(options.element).get())}that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]]){full.push(options.classes[classes[i]])}}}this._on(options.element,{remove:"_untrackClassesElement"});if(options.keys){processClassString(options.keys.match(/\S+/g)||[],true)}if(options.extra){processClassString(options.extra.match(/\S+/g)||[])}return full.join(" ")},_untrackClassesElement:function _untrackClassesElement(event){var that=this;$.each(that.classesElementLookup,function(key,value){if($.inArray(event.target,value)!==-1){that.classesElementLookup[key]=$(value.not(event.target).get())}})},_removeClass:function _removeClass(element,keys,extra){return this._toggleClass(element,keys,extra,false)},_addClass:function _addClass(element,keys,extra){return this._toggleClass(element,keys,extra,true)},_toggleClass:function _toggleClass(element,keys,extra,add){add=typeof add==="boolean"?add:extra;var shift=typeof element==="string"||element===null,options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};options.element.toggleClass(this._classes(options),add);return this},_on:function _on(suppressDisabledCheck,element,handlers){var delegateElement;var instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget()}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element)}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++}var match=event.match(/^([\w:-]*)\s*(.*)$/);var eventName=match[1]+instance.eventNamespace;var selector=match[2];if(selector){delegateElement.on(eventName,selector,handlerProxy)}else{element.on(eventName,handlerProxy)}})},_off:function _off(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.off(eventName).off(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get())},_delay:function _delay(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function _hoverable(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function mouseenter(event){this._addClass($(event.currentTarget),null,"ui-state-hover")},mouseleave:function mouseleave(event){this._removeClass($(event.currentTarget),null,"ui-state-hover")}})},_focusable:function _focusable(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function focusin(event){this._addClass($(event.currentTarget),null,"ui-state-focus")},focusout:function focusout(event){this._removeClass($(event.currentTarget),null,"ui-state-focus")}})},_trigger:function _trigger(type,event,data){var prop,orig;var callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop]}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options}}var hasOptions;var effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options}}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay)}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options)}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback)}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0])}next()})}}});var widget=$.widget;
/*!
  * jQuery UI :data 1.12.1
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
  * Released under the MIT license.
  * http://jquery.org/license
  */var data=$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])}});
/*!
  * jQuery UI Scroll Parent 1.12.1
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
  * Released under the MIT license.
  * http://jquery.org/license
  */var scrollParent=$.fn.scrollParent=function(includeHidden){var position=this.css("position"),excludeStaticParent=position==="absolute",overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css("position")==="static"){return false}return overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"))}).eq(0);return position==="fixed"||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent};var ie=$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
/*!
  * jQuery UI Mouse 1.12.1
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
  * Released under the MIT license.
  * http://jquery.org/license
  */var mouseHandled=false;$(document).on("mouseup",function(){mouseHandled=false});var widgetsMouse=$.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function _mouseInit(){var that=this;this.element.on("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).on("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function _mouseDestroy(){this.element.off("."+this.widgetName);if(this._mouseMoveDelegate){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function _mouseDown(event){if(mouseHandled){return}this._mouseMoved=false;this._mouseStarted&&this._mouseUp(event);this._mouseDownEvent=event;var that=this,btnIsLeft=event.which===1,elIsCancel=typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false;if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(event)!==false;if(!this._mouseStarted){event.preventDefault();return true}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(event){return that._mouseMove(event)};this._mouseUpDelegate=function(event){return that._mouseUp(event)};this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true},_mouseMove:function _mouseMove(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event)}else if(!event.which){if(event.originalEvent.altKey||event.originalEvent.ctrlKey||event.originalEvent.metaKey||event.originalEvent.shiftKey){this.ignoreMissingWhich=true}else if(!this.ignoreMissingWhich){return this._mouseUp(event)}}}if(event.which||event.button){this._mouseMoved=true}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault()}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==false;this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)}return!this._mouseStarted},_mouseUp:function _mouseUp(event){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(event)}if(this._mouseDelayTimer){clearTimeout(this._mouseDelayTimer);delete this._mouseDelayTimer}this.ignoreMissingWhich=false;mouseHandled=false;event.preventDefault()},_mouseDistanceMet:function _mouseDistanceMet(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function _mouseDelayMet(){return this.mouseDelayMet},_mouseStart:function _mouseStart(){},_mouseDrag:function _mouseDrag(){},_mouseStop:function _mouseStop(){},_mouseCapture:function _mouseCapture(){return true}});
/*!
  * jQuery UI Sortable 1.12.1
  * http://jqueryui.com
  *
  * Copyright jQuery Foundation and other contributors
  * Released under the MIT license.
  * http://jquery.org/license
  */var widgetsSortable=$.widget("ui.sortable",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function _isOverAxis(x,reference,size){return x>=reference&&x<reference+size},_isFloating:function _isFloating(item){return/left|right/.test(item.css("float"))||/inline|table-cell/.test(item.css("display"))},_create:function _create(){this.containerCache={};this._addClass("ui-sortable");this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true},_setOption:function _setOption(key,value){this._super(key,value);if(key==="handle"){this._setHandleClassName()}},_setHandleClassName:function _setHandleClassName(){var that=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle");$.each(this.items,function(){that._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function _destroy(){this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function _mouseCapture(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return false}});if($.data(event.target,that.widgetName+"-item")===that){currentItem=$(event.target)}if(!currentItem){return false}if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){if(this===event.target){validHandle=true}});if(!validHandle){return false}}this.currentItem=currentItem;this._removeCurrentsFromItems();return true},_mouseStart:function _mouseStart(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt);this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(o.containment){this._setContainment()}if(o.cursor&&o.cursor!=="auto"){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body)}if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",o.opacity)}if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",o.zIndex)}if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this))}}if($.ui.ddmanager){$.ui.ddmanager.current=this}if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}this.dragging=true;this._addClass(this.helper,"ui-sortable-helper");this._mouseDrag(event);return true},_mouseDrag:function _mouseDrag(event){var i,item,itemElement,intersection,o=this.options,scrolled=false;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){if(this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed}if(this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed}}else{if(event.pageY-this.document.scrollTop()<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed)}else if(this.window.height()-(event.pageY-this.document.scrollTop())<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)}if(event.pageX-this.document.scrollLeft()<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed)}else if(this.window.width()-(event.pageX-this.document.scrollLeft())<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed)}}if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue}if(item.instance!==this.currentContainer){continue}if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item)}else{break}this._trigger("change",event,this._uiHash());break}}this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event)}this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function _mouseStop(event,noPropagation){if(!event){return}if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event)}if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==="x"){animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)}if(!axis||axis==="y"){animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)}this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else{this._clear(event,noPropagation)}return false},cancel:function cancel(){if(this.dragging){this._mouseUp(new $.Event("mouseup",{target:null}));if(this.options.helper==="original"){this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else{this.currentItem.show()}for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem)}else{$(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function serialize(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||/(.+)[\-=_](.+)/);if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))}});if(!str.length&&o.key){str.push(o.key+"=")}return str.join("&")},toArray:function toArray(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")});return ret},_intersectsWith:function _intersectsWith(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=this.options.axis==="x"||y1+dyClick>t&&y1+dyClick<b,isOverElementWidth=this.options.axis==="y"||x1+dxClick>l&&x1+dxClick<r,isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"]){return isOverElement}else{return l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b}},_intersectsWithPointer:function _intersectsWithPointer(item){var verticalDirection,horizontalDirection,isOverElementHeight=this.options.axis==="x"||this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=this.options.axis==="y"||this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth;if(!isOverElement){return false}verticalDirection=this._getDragVerticalDirection();horizontalDirection=this._getDragHorizontalDirection();return this.floating?horizontalDirection==="right"||verticalDirection==="down"?2:1:verticalDirection&&(verticalDirection==="down"?2:1)},_intersectsWithSides:function _intersectsWithSides(item){var isOverBottomHalf=this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return horizontalDirection==="right"&&isOverRightHalf||horizontalDirection==="left"&&!isOverRightHalf}else{return verticalDirection&&(verticalDirection==="down"&&isOverBottomHalf||verticalDirection==="up"&&!isOverBottomHalf)}},_getDragVerticalDirection:function _getDragVerticalDirection(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?"down":"up")},_getDragHorizontalDirection:function _getDragHorizontalDirection(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?"right":"left")},refresh:function refresh(event){this._refreshItems(event);this._setHandleClassName();this.refreshPositions();return this},_connectWith:function _connectWith(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function _getItemsAsjQuery(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst])}}}}queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function addItems(){items.push(this)}for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems)}return $(items)},_removeCurrentsFromItems:function _removeCurrentsFromItems(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false}}return true})},_refreshItems:function _refreshItems(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst)}}}}for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})}}},refreshPositions:function refreshPositions(fast){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):false;if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]){continue}t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight()}p=t.offset();item.left=p.left;item.top=p.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}}return this},_createPlaceholder:function _createPlaceholder(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function element(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]);that._addClass(element,"ui-sortable-placeholder",className||that.currentItem[0].className)._removeClass(element,"ui-sortable-helper");if(nodeName==="tbody"){that._createTrPlaceholder(that.currentItem.find("tr").eq(0),$("<tr>",that.document[0]).appendTo(element))}else if(nodeName==="tr"){that._createTrPlaceholder(that.currentItem,element)}else if(nodeName==="img"){element.attr("src",that.currentItem.attr("src"))}if(!className){element.css("visibility","hidden")}return element},update:function update(container,p){if(className&&!o.forcePlaceholderSize){return}if(!p.height()){p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10))}if(!p.width()){p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10))}}}}that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder)},_createTrPlaceholder:function _createTrPlaceholder(sourceTr,targetTr){var that=this;sourceTr.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(targetTr)})},_contactContainers:function _contactContainers(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,cur,nearBottom,floating,axis,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue}if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue}innermostContainer=this.containers[i];innermostIndex=i}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0}}}if(!innermostContainer){return}if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}}else{dist=1e4;itemWithLeastDistance=null;floating=innermostContainer.floating||this._isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";axis=floating?"pageX":"pageY";for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue}if(this.items[j].item[0]===this.currentItem[0]){continue}cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(event[axis]-cur>this.items[j][sizeProperty]/2){nearBottom=true}if(Math.abs(event[axis]-cur)<dist){dist=Math.abs(event[axis]-cur);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down"}}if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[innermostIndex]){if(!this.currentContainer.containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash());this.currentContainer.containerCache.over=1}return}itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1}},_createHelper:function _createHelper(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):o.helper==="clone"?this.currentItem.clone():this.currentItem;if(!helper.parents("body").length){$(o.appendTo!=="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0])}if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width())}if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height())}return helper},_adjustOffsetFromHelper:function _adjustOffsetFromHelper(obj){if(typeof obj==="string"){obj=obj.split(" ")}if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0}}if("left"in obj){this.offset.click.left=obj.left+this.margins.left}if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left}if("top"in obj){this.offset.click.top=obj.top+this.margins.top}if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top}},_getParentOffset:function _getParentOffset(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie){po={top:0,left:0}}return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function _getRelativeOffset(){if(this.cssPosition==="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function _cacheMargins(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function _cacheHelperProportions(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function _setContainment(){var ce,co,over,o=this.options;if(o.containment==="parent"){o.containment=this.helper[0].parentNode}if(o.containment==="document"||o.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,o.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(o.containment==="document"?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=$(ce).css("overflow")!=="hidden";this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function _convertPositionTo(d,pos){if(!pos){pos=this.position}var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function _generatePosition(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left}if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top}if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left}if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top}}if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3]?top:top-this.offset.click.top>=this.containment[1]?top-o.grid[1]:top+o.grid[1]:top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2]?left:left-this.offset.click.left>=this.containment[0]?left-o.grid[0]:left+o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function _rearrange(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?i.item[0]:i.item[0].nextSibling);this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh)}})},_clear:function _clear(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]=""}}this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())})}if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())});delayedTriggers.push(function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}.call(this,this.currentContainer));delayedTriggers.push(function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}.call(this,this.currentContainer))}}function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance))}}for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent("deactivate",this,this.containers[i]))}if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent("out",this,this.containers[i]));this.containers[i].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(!noPropagation){this._trigger("beforeStop",event,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval){if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null}if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event)}this._trigger("stop",event,this._uiHash())}this.fromOutside=false;return!this.cancelHelperRemoval},_trigger:function _trigger(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function _uiHash(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}})})},3329:function(module,exports,__webpack_require__){},3330:function(module,exports,__webpack_require__){},3331:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3332);var _modules=__webpack_require__(7);var _saved_object_loader=__webpack_require__(418);var _saved_object_registry=__webpack_require__(257);var _saved_objects=__webpack_require__(49);var _module=_modules.uiModules.get("app/maps");_saved_object_registry.SavedObjectRegistryProvider.register({service:"gisMapSavedObjectLoader",title:"gisMaps"});_module.service("gisMapSavedObjectLoader",function(Private,SavedGisMap,kbnIndex,kbnUrl,$http,chrome){var savedObjectClient=Private(_saved_objects.SavedObjectsClientProvider);return new _saved_object_loader.SavedObjectLoader(SavedGisMap,kbnIndex,kbnUrl,$http,chrome,savedObjectClient)})},3332:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _modules=__webpack_require__(7);var _legacy_class=__webpack_require__(59);var _courier=__webpack_require__(175);var _map_selectors=__webpack_require__(192);var _elasticsearch_geo_utils=__webpack_require__(547);var _util=__webpack_require__(765);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("app/maps");_module.factory("SavedGisMap",function(Private){var SavedObject=Private(_courier.SavedObjectProvider);(0,_legacy_class.createLegacyClass)(SavedGisMap).inherits(SavedObject);function SavedGisMap(id){SavedGisMap.Super.call(this,{type:SavedGisMap.type,mapping:SavedGisMap.mapping,searchSource:SavedGisMap.searchsource,id:id,defaults:{title:"New Map",description:""}});this.showInRecentlyAccessed=true}SavedGisMap.type="map";SavedGisMap.mapping={title:"text",description:"text",mapStateJSON:"text",layerListJSON:"text",uiStateJSON:"text",bounds:{type:"object"}};SavedGisMap.fieldOrder=["title","description"];SavedGisMap.searchsource=false;SavedGisMap.prototype.getFullPath=function(){return"/app/maps#map/"+this.id};SavedGisMap.prototype.syncWithStore=function(state){var layerList=(0,_map_selectors.getLayerListRaw)(state);var layerListConfigOnly=(0,_util.copyPersistentState)(layerList);this.layerListJSON=JSON.stringify(layerListConfigOnly);this.mapStateJSON=JSON.stringify({zoom:(0,_map_selectors.getMapZoom)(state),center:(0,_map_selectors.getMapCenter)(state),timeFilters:(0,_map_selectors.getTimeFilters)(state),refreshConfig:(0,_map_selectors.getRefreshConfig)(state),query:_lodash2.default.omit((0,_map_selectors.getQuery)(state),"queryLastTriggeredAt")});this.uiStateJSON=JSON.stringify({});this.bounds=(0,_elasticsearch_geo_utils.convertMapExtentToPolygon)((0,_map_selectors.getMapExtent)(state))};return SavedGisMap})},3333:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DataRequest=exports.DataRequest=function(){function DataRequest(descriptor){_classCallCheck(this,DataRequest);this._descriptor=descriptor}_createClass(DataRequest,[{key:"getData",value:function getData(){return this._descriptor.data}},{key:"isLoading",value:function isLoading(){return!!this._descriptor.dataRequestToken}},{key:"getMeta",value:function getMeta(){return this._descriptor.dataMeta}},{key:"hasDataOrRequestInProgress",value:function hasDataOrRequestInProgress(){return this._descriptor.data||this._descriptor.dataRequestToken}},{key:"getDataId",value:function getDataId(){return this._descriptor.dataId}}]);return DataRequest}()},3334:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FillableVector=exports.FillableCircle=undefined;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FillableCircle=exports.FillableCircle=function FillableCircle(_ref){var style=_ref.style;return _react2.default.createElement("svg",{className:"euiIcon euiIcon--medium",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",style:style,viewBox:"0 0 16 16"},_react2.default.createElement("defs",null,_react2.default.createElement("path",{id:"fillableCircle",d:"M8,15 C11.8659932,15 15,11.8659932 15,8 C15,4.13400675 11.8659932,        1 8,1 C4.13400675,1 1,4.13400675 1,8 C1,11.8659932 4.13400675,15 8,        15 Z M8,16 C3.581722,16 0,12.418278 0,8 C0,3.581722 3.581722,0 8,        0 C12.418278,0 16,3.581722 16,8 C16,12.418278 12.418278,16 8,16 Z M8,        12 C10.209139,12 12,10.209139 12,8 C12,5.790861 10.209139,4 8,        4 C5.790861,4 4,5.790861 4,8 C4,10.209139 5.790861,12 8,12 Z M8,        11 C6.34314575,11 5,9.65685425 5,8 C5,6.34314575 6.34314575,5 8,        5 C9.65685425,5 11,6.34314575 11,8 C11,9.65685425 9.65685425,11 8,        11 Z M8,9 C8.55228475,9 9,8.55228475 9,8 C9,7.44771525 8.55228475,7 8,        7 C7.44771525,7 7,7.44771525 7,8 C7,8.55228475 7.44771525,9 8,9 Z"})),_react2.default.createElement("g",null,_react2.default.createElement("ellipse",{id:"path3353",cx:"8.0350437",cy:"7.9660664",rx:"7.3820276",ry:"7.3809776",transform:"matrix(0.99985753,0.01687955,0,1,0,0)"})))};var FillableVector=exports.FillableVector=function FillableVector(_ref2){var style=_ref2.style;return _react2.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},_react2.default.createElement("rect",{width:"15",height:"15",x:".5",y:".5",style:style,rx:"4"}))}},3335:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getRGBColorRangeStrings=getRGBColorRangeStrings;exports.getHexColorRangeStrings=getHexColorRangeStrings;var _colormaps=__webpack_require__(285);var _color_util=__webpack_require__(535);var _chromaJs=__webpack_require__(783);var _chromaJs2=_interopRequireDefault(_chromaJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getRGBColorRangeStrings(colorName,numberColors){var colorKeys=Object.keys(_colormaps.vislibColorMaps);if(!colorKeys.includes(colorName)){throw new Error(colorName+" not found. Expected one of following values:       "+colorKeys)}return(0,_color_util.getLegendColors)(_colormaps.vislibColorMaps[colorName].value,numberColors)}function getHexColorRangeStrings(colorName,numberColors){return getRGBColorRangeStrings(colorName,numberColors).map(function(rgbColor){return(0,_chromaJs2.default)(rgbColor).hex()})}},3336:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStyleEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _vector_style_color_editor=__webpack_require__(3337);var _vector_style_size_editor=__webpack_require__(3340);var _vector_style_defaults=__webpack_require__(762);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VectorStyleEditor=exports.VectorStyleEditor=function(_Component){_inherits(VectorStyleEditor,_Component);function VectorStyleEditor(props){_classCallCheck(this,VectorStyleEditor);var _this=_possibleConstructorReturn(this,(VectorStyleEditor.__proto__||Object.getPrototypeOf(VectorStyleEditor)).call(this,props));_this.state={ordinalFields:[],defaultDynamicProperties:(0,_vector_style_defaults.getDefaultDynamicProperties)(),defaultStaticProperties:(0,_vector_style_defaults.getDefaultStaticProperties)()};return _this}_createClass(VectorStyleEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadOrdinalFields()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this._loadOrdinalFields()}},{key:"_loadOrdinalFields",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var ordinalFields;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.props.layer.getOrdinalFields();case 2:ordinalFields=_context.sent;if(this._isMounted){_context.next=5;break}return _context.abrupt("return");case 5:if(!_lodash2.default.isEqual(ordinalFields,this.state.ordinalFields)){this.setState({ordinalFields:ordinalFields})}case 6:case"end":return _context.stop()}}},_callee,this)}));function _loadOrdinalFields(){return _ref.apply(this,arguments)}return _loadOrdinalFields}()},{key:"render",value:function render(){return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_vector_style_color_editor.VectorStyleColorEditor,{styleProperty:"fillColor",stylePropertyName:_i18n.i18n.translate("xpack.maps.styles.vector.fillColorLabel",{defaultMessage:"Fill color"}),handlePropertyChange:this.props.handlePropertyChange,styleDescriptor:this.props.styleProperties.fillColor,ordinalFields:this.state.ordinalFields,defaultStaticStyleOptions:this.state.defaultStaticProperties.fillColor.options,defaultDynamicStyleOptions:this.state.defaultDynamicProperties.fillColor.options}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_vector_style_color_editor.VectorStyleColorEditor,{styleProperty:"lineColor",stylePropertyName:_i18n.i18n.translate("xpack.maps.styles.vector.borderColorLabel",{defaultMessage:"Border color"}),handlePropertyChange:this.props.handlePropertyChange,styleDescriptor:this.props.styleProperties.lineColor,ordinalFields:this.state.ordinalFields,defaultStaticStyleOptions:this.state.defaultStaticProperties.lineColor.options,defaultDynamicStyleOptions:this.state.defaultDynamicProperties.lineColor.options}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_vector_style_size_editor.VectorStyleSizeEditor,{styleProperty:"lineWidth",stylePropertyName:_i18n.i18n.translate("xpack.maps.styles.vector.borderWidthLabel",{defaultMessage:"Border width"}),handlePropertyChange:this.props.handlePropertyChange,styleDescriptor:this.props.styleProperties.lineWidth,ordinalFields:this.state.ordinalFields,defaultStaticStyleOptions:this.state.defaultStaticProperties.lineWidth.options,defaultDynamicStyleOptions:this.state.defaultDynamicProperties.lineWidth.options}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_vector_style_size_editor.VectorStyleSizeEditor,{styleProperty:"iconSize",stylePropertyName:_i18n.i18n.translate("xpack.maps.styles.vector.symbolSizeLabel",{defaultMessage:"Symbol size"}),handlePropertyChange:this.props.handlePropertyChange,styleDescriptor:this.props.styleProperties.iconSize,ordinalFields:this.state.ordinalFields,defaultStaticStyleOptions:this.state.defaultStaticProperties.iconSize.options,defaultDynamicStyleOptions:this.state.defaultDynamicProperties.iconSize.options}))}}]);return VectorStyleEditor}(_react.Component)},3337:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStyleColorEditor=VectorStyleColorEditor;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _static_dynamic_style_row=__webpack_require__(1222);var _dynamic_color_selection=__webpack_require__(3338);var _static_color_selection=__webpack_require__(3339);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function VectorStyleColorEditor(props){return _react2.default.createElement(_static_dynamic_style_row.StaticDynamicStyleRow,{ordinalFields:props.ordinalFields,property:props.styleProperty,name:props.stylePropertyName,styleDescriptor:props.styleDescriptor,handlePropertyChange:props.handlePropertyChange,DynamicSelector:_dynamic_color_selection.DynamicColorSelection,StaticSelector:_static_color_selection.StaticColorSelection,defaultDynamicStyleOptions:props.defaultDynamicStyleOptions,defaultStaticStyleOptions:props.defaultStaticStyleOptions})}},3338:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.DynamicColorSelection=DynamicColorSelection;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _field_select=__webpack_require__(1223);var _color_ramp_select=__webpack_require__(1224);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DynamicColorSelection(_ref){var ordinalFields=_ref.ordinalFields,onChange=_ref.onChange,styleOptions=_ref.styleOptions;var onFieldChange=function onFieldChange(_ref2){var field=_ref2.field;onChange(_extends({},styleOptions,{field:field}))};var onColorChange=function onColorChange(_ref3){var color=_ref3.color;onChange(_extends({},styleOptions,{color:color}))};return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_color_ramp_select.ColorRampSelect,{onChange:onColorChange,color:styleOptions.color}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_field_select.FieldSelect,{fields:ordinalFields,selectedField:_lodash2.default.get(styleOptions,"field"),onChange:onFieldChange}))}DynamicColorSelection.propTypes={ordinalFields:_propTypes2.default.arrayOf(_field_select.fieldShape).isRequired,styleOptions:_propTypes2.default.shape({color:_propTypes2.default.string.isRequired,field:_field_select.fieldShape}).isRequired,onChange:_propTypes2.default.func.isRequired}},3339:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StaticColorSelection=StaticColorSelection;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function StaticColorSelection(_ref){var onChange=_ref.onChange,styleOptions=_ref.styleOptions;var onColorChange=function onColorChange(color){onChange({color:color})};return _react2.default.createElement(_eui.EuiFormControlLayout,null,_react2.default.createElement(_eui.EuiColorPicker,{onChange:onColorChange,color:styleOptions.color,className:"mapColorPicker euiFieldText"}))}StaticColorSelection.propTypes={styleOptions:_propTypes2.default.shape({color:_propTypes2.default.string.isRequired}).isRequired,onChange:_propTypes2.default.func.isRequired}},3340:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VectorStyleSizeEditor=VectorStyleSizeEditor;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _static_dynamic_style_row=__webpack_require__(1222);var _dynamic_size_selection=__webpack_require__(3341);var _static_size_selection=__webpack_require__(3343);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function VectorStyleSizeEditor(props){return _react2.default.createElement(_static_dynamic_style_row.StaticDynamicStyleRow,{ordinalFields:props.ordinalFields,property:props.styleProperty,name:props.stylePropertyName,styleDescriptor:props.styleDescriptor,handlePropertyChange:props.handlePropertyChange,DynamicSelector:_dynamic_size_selection.DynamicSizeSelection,StaticSelector:_static_size_selection.StaticSizeSelection,defaultDynamicStyleOptions:props.defaultDynamicStyleOptions,defaultStaticStyleOptions:props.defaultStaticStyleOptions})}},3341:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.DynamicSizeSelection=DynamicSizeSelection;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _field_select=__webpack_require__(1223);var _size_range_selector=__webpack_require__(3342);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DynamicSizeSelection(_ref){var ordinalFields=_ref.ordinalFields,styleOptions=_ref.styleOptions,onChange=_ref.onChange;var onFieldChange=function onFieldChange(_ref2){var field=_ref2.field;onChange(_extends({},styleOptions,{field:field}))};var onSizeRangeChange=function onSizeRangeChange(_ref3){var minSize=_ref3.minSize,maxSize=_ref3.maxSize;onChange(_extends({},styleOptions,{minSize:minSize,maxSize:maxSize}))};return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_size_range_selector.SizeRangeSelector,{onChange:onSizeRangeChange,minSize:styleOptions.minSize,maxSize:styleOptions.maxSize}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_field_select.FieldSelect,{fields:ordinalFields,selectedField:_lodash2.default.get(styleOptions,"field"),onChange:onFieldChange}))}DynamicSizeSelection.propTypes={ordinalFields:_propTypes2.default.arrayOf(_field_select.fieldShape).isRequired,styleOptions:_propTypes2.default.shape({minSize:_propTypes2.default.number.isRequired,maxSize:_propTypes2.default.number.isRequired,field:_field_select.fieldShape}).isRequired,onChange:_propTypes2.default.func.isRequired}},3342:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SizeRangeSelector=SizeRangeSelector;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _validated_range=__webpack_require__(761);var _i18n=__webpack_require__(5);var _vector_style_defaults=__webpack_require__(762);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SizeRangeSelector(_ref){var minSize=_ref.minSize,maxSize=_ref.maxSize,onChange=_ref.onChange;var onSizeChange=function onSizeChange(min,max){onChange({minSize:min,maxSize:max})};var onMinSizeChange=function onMinSizeChange(updatedMinSize){onSizeChange(updatedMinSize,updatedMinSize>maxSize?updatedMinSize:maxSize)};var onMaxSizeChange=function onMaxSizeChange(updatedMaxSize){onSizeChange(updatedMaxSize<minSize?updatedMaxSize:minSize,updatedMaxSize)};return _react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.styles.vector.size.minLabel",{defaultMessage:"Min size"}),compressed:true},_react2.default.createElement(_validated_range.ValidatedRange,{min:_vector_style_defaults.DEFAULT_MIN_SIZE,max:_vector_style_defaults.DEFAULT_MAX_SIZE,value:minSize,onChange:onMinSizeChange,showInput:true,showRange:true}))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.styles.vector.size.maxLabel",{defaultMessage:"Max size"}),compressed:true},_react2.default.createElement(_validated_range.ValidatedRange,{min:_vector_style_defaults.DEFAULT_MIN_SIZE,max:_vector_style_defaults.DEFAULT_MAX_SIZE,value:maxSize,onChange:onMaxSizeChange,showInput:true,showRange:true}))))}SizeRangeSelector.propTypes={minSize:_propTypes2.default.number.isRequired,maxSize:_propTypes2.default.number.isRequired,onChange:_propTypes2.default.func.isRequired}},3343:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StaticSizeSelection=StaticSizeSelection;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _validated_range=__webpack_require__(761);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function StaticSizeSelection(_ref){var onChange=_ref.onChange,styleOptions=_ref.styleOptions;var onSizeChange=function onSizeChange(size){onChange({size:size})};return _react2.default.createElement(_validated_range.ValidatedRange,{min:0,max:100,value:styleOptions.size,onChange:onSizeChange,showInput:true,showRange:true})}StaticSizeSelection.propTypes={styleOptions:_propTypes2.default.shape({size:_propTypes2.default.number.isRequired}).isRequired,onChange:_propTypes2.default.func.isRequired}},3344:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LeftInnerJoin=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _es_join_source=__webpack_require__(3345);var _vector_style=__webpack_require__(332);var _util=__webpack_require__(1226);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LeftInnerJoin=exports.LeftInnerJoin=function(){_createClass(LeftInnerJoin,null,[{key:"toHash",value:function toHash(descriptor){return JSON.stringify(descriptor)}}]);function LeftInnerJoin(joinDescriptor){_classCallCheck(this,LeftInnerJoin);this._descriptor=joinDescriptor;this._rightSource=new _es_join_source.ESJoinSource(joinDescriptor.right)}_createClass(LeftInnerJoin,[{key:"destroy",value:function destroy(){this._rightSource.destroy()}},{key:"hasCompleteConfig",value:function hasCompleteConfig(){if(this._descriptor.leftField&&this._rightSource){return this._rightSource.hasCompleteConfig()}return false}},{key:"getJoinFields",value:function getJoinFields(){return this._rightSource.getMetricFields().map(function(_ref){var name=_ref.propertyKey,label=_ref.propertyLabel;return{label:label,name:name}})}},{key:"getSourceId",value:function getSourceId(){return LeftInnerJoin.toHash(this._descriptor)}},{key:"getLeftFieldName",value:function getLeftFieldName(){return this._descriptor.leftField}},{key:"joinPropertiesToFeatureCollection",value:function joinPropertiesToFeatureCollection(featureCollection,propertiesMap){var _this=this;var joinFields=this._rightSource.getMetricFields();featureCollection.features.forEach(function(feature){joinFields.forEach(function(_ref2){var propertyKey=_ref2.propertyKey;delete feature.properties[propertyKey];var stylePropertyName=_vector_style.VectorStyle.getComputedFieldName(propertyKey);delete feature.properties[stylePropertyName]});var joinKey=feature.properties[_this._descriptor.leftField];if(propertiesMap.has(joinKey)){Object.assign(feature.properties,propertiesMap.get(joinKey))}});return _extends({},featureCollection)}},{key:"getJoinSource",value:function getJoinSource(){return this._rightSource}},{key:"getId",value:function getId(){return this._descriptor.id}},{key:"toDescriptor",value:function toDescriptor(){return this._descriptor}},{key:"filterAndFormatPropertiesForTooltip",value:function filterAndFormatPropertiesForTooltip(properties){var metricFields=this._rightSource.getMetricFields();return(0,_util.filterPropertiesForTooltip)(metricFields,properties)}},{key:"getIndexPatternIds",value:function getIndexPatternIds(){return this._rightSource.getIndexPatternIds()}}]);return LeftInnerJoin}()},3345:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ESJoinSource=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.extractPropertiesMap=extractPropertiesMap;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _es_source=__webpack_require__(763);var _schemas=__webpack_require__(64);var _kibana_services=__webpack_require__(227);var _agg_configs=__webpack_require__(497);var _timefilter=__webpack_require__(490);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectDestructuringEmpty(obj){if(obj==null)throw new TypeError("Cannot destructure undefined")}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TERMS_AGG_NAME="join";var aggSchemas=new _schemas.Schemas([{group:"metrics",name:"metric",title:"Value",min:1,max:Infinity,aggFilter:["avg","count","max","min","sum"],defaults:[{schema:"metric",type:"count"}]},{group:"buckets",name:"segment",title:"Terms",aggFilter:"terms",min:1,max:1}]);function extractPropertiesMap(rawEsData,propertyNames,countPropertyName){var propertiesMap=new Map;_lodash2.default.get(rawEsData,["aggregations",TERMS_AGG_NAME,"buckets"],[]).forEach(function(termBucket){var properties={};if(countPropertyName){properties[countPropertyName]=termBucket.doc_count}propertyNames.forEach(function(propertyName){if(_lodash2.default.has(termBucket,[propertyName,"value"])){properties[propertyName]=_lodash2.default.get(termBucket,[propertyName,"value"])}});propertiesMap.set(termBucket.key,properties)});return propertiesMap}var ESJoinSource=exports.ESJoinSource=function(_AbstractESSource){_inherits(ESJoinSource,_AbstractESSource);function ESJoinSource(){_classCallCheck(this,ESJoinSource);return _possibleConstructorReturn(this,(ESJoinSource.__proto__||Object.getPrototypeOf(ESJoinSource)).apply(this,arguments))}_createClass(ESJoinSource,[{key:"hasCompleteConfig",value:function hasCompleteConfig(){if(_lodash2.default.has(this._descriptor,"indexPatternId")&&_lodash2.default.has(this._descriptor,"term")){return true}return false}},{key:"destroy",value:function destroy(){_kibana_services.inspectorAdapters.requests.resetRequest(this._descriptor.id)}},{key:"getIndexPatternIds",value:function getIndexPatternIds(){return[this._descriptor.indexPatternId]}},{key:"_formatMetricKey",value:function _formatMetricKey(metric){var metricKey=metric.type!=="count"?metric.type+"_of_"+metric.field:metric.type;return"__kbnjoin__"+metricKey+"_groupby_"+this._descriptor.indexPatternTitle+"."+this._descriptor.term}},{key:"_formatMetricLabel",value:function _formatMetricLabel(metric){var metricLabel=metric.type!=="count"?metric.type+" "+metric.field:"count";return metricLabel+" of "+this._descriptor.indexPatternTitle+":"+this._descriptor.term}},{key:"getPropertiesMap",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(searchFilters,leftSourceName,leftFieldName){var indexPattern,timeAware,configStates,aggConfigs,rawEsData,searchSource,dsl,metricPropertyNames,countConfigState,countPropertyName;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(this.hasCompleteConfig()){_context.next=2;break}return _context.abrupt("return",[]);case 2:_context.next=4;return this._getIndexPattern();case 4:indexPattern=_context.sent;_context.next=7;return this.isTimeAware();case 7:timeAware=_context.sent;configStates=this._makeAggConfigs();aggConfigs=new _agg_configs.AggConfigs(indexPattern,configStates,aggSchemas.all);rawEsData=void 0;_context.prev=11;searchSource=new _kibana_services.SearchSource;searchSource.setField("index",indexPattern);searchSource.setField("size",0);searchSource.setField("filter",function(){var filters=[];if(timeAware){filters.push(_timefilter.timefilter.createFilter(indexPattern,searchFilters.timeFilters))}return filters});searchSource.setField("query",searchFilters.query);dsl=aggConfigs.toDsl();searchSource.setField("aggs",dsl);_context.next=21;return(0,_kibana_services.fetchSearchSourceAndRecordWithInspector)({searchSource:searchSource,requestName:this._descriptor.indexPatternTitle+"."+this._descriptor.term,requestId:this._descriptor.id,requestDesc:this.getJoinDescription(leftSourceName,leftFieldName)});case 21:rawEsData=_context.sent;_context.next=27;break;case 24:_context.prev=24;_context.t0=_context["catch"](11);throw new Error(_i18n.i18n.translate("xpack.maps.source.esJoin.errorMessage",{defaultMessage:"Elasticsearch search request failed, error: {message}",values:{message:_context.t0.message}}));case 27:metricPropertyNames=configStates.filter(function(configState){return configState.schema==="metric"&&configState.type!=="count"}).map(function(configState){return configState.id});countConfigState=configStates.find(function(configState){return configState.type==="count"});countPropertyName=_lodash2.default.get(countConfigState,"id");return _context.abrupt("return",{propertiesMap:extractPropertiesMap(rawEsData,metricPropertyNames,countPropertyName)});case 31:case"end":return _context.stop()}}},_callee,this,[[11,24]])}));function getPropertiesMap(_x,_x2,_x3){return _ref.apply(this,arguments)}return getPropertiesMap}()},{key:"isFilterByMapBounds",value:function isFilterByMapBounds(){return false}},{key:"getJoinDescription",value:function getJoinDescription(leftSourceName,leftFieldName){var metrics=this._getValidMetrics().map(function(metric){return metric.type!=="count"?metric.type+" "+metric.field:"count"});var joinStatement=[];joinStatement.push(_i18n.i18n.translate("xpack.maps.source.esJoin.joinLeftDescription",{defaultMessage:"Join {leftSourceName}:{leftFieldName} with",values:{leftSourceName:leftSourceName,leftFieldName:leftFieldName}}));joinStatement.push(this._descriptor.indexPatternTitle+":"+this._descriptor.term);joinStatement.push(_i18n.i18n.translate("xpack.maps.source.esJoin.joinMetricsDescription",{defaultMessage:"for metrics {metrics}",values:{metrics:metrics.join(",")}}));return _i18n.i18n.translate("xpack.maps.source.esJoin.joinDescription",{defaultMessage:"Elasticsearch terms aggregation request for {description}",values:{description:joinStatement.join(" ")}})}},{key:"_makeAggConfigs",value:function _makeAggConfigs(){var metricAggConfigs=this.getMetricFields().map(function(metric){var metricAggConfig={id:metric.propertyKey,enabled:true,type:metric.type,schema:"metric",params:{}};if(metric.type!=="count"){metricAggConfig.params={field:metric.field}}return metricAggConfig});return[].concat(_toConsumableArray(metricAggConfigs),[{id:TERMS_AGG_NAME,enabled:true,type:"terms",schema:"segment",params:{field:this._descriptor.term,size:1e4}}])}},{key:"getDisplayName",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return","es_table "+this._descriptor.indexPatternId);case 1:case"end":return _context2.stop()}}},_callee2,this)}));function getDisplayName(){return _ref2.apply(this,arguments)}return getDisplayName}()}],[{key:"renderEditor",value:function renderEditor(_ref3){_objectDestructuringEmpty(_ref3);return"<div>editor details</div>"}}]);return ESJoinSource}(_es_source.AbstractESSource);ESJoinSource.type="ES_JOIN_SOURCE"},3346:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FeatureTooltip=FeatureTooltip;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FeatureTooltip(_ref){var properties=_ref.properties;return Object.keys(properties).map(function(propertyName){return _react2.default.createElement("div",{key:propertyName},_react2.default.createElement("strong",null,propertyName)," ",properties[propertyName])})}},3347:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.map=map;var _store_actions=__webpack_require__(216);var _util=__webpack_require__(765);var _constants=__webpack_require__(193);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var getLayerIndex=function getLayerIndex(list,layerId){return list.findIndex(function(_ref){var id=_ref.id;return layerId===id})};var updateLayerInList=function updateLayerInList(state,layerId,attribute,newValue){if(!layerId){return state}var layerList=state.layerList;var layerIdx=getLayerIndex(layerList,layerId);var updatedLayer=_extends({},layerList[layerIdx],_defineProperty({},attribute,newValue||newValue===""||newValue===0?newValue:!layerList[layerIdx][attribute]));var updatedList=[].concat(_toConsumableArray(layerList.slice(0,layerIdx)),[updatedLayer],_toConsumableArray(layerList.slice(layerIdx+1)));return _extends({},state,{layerList:updatedList})};var updateLayerSourceDescriptorProp=function updateLayerSourceDescriptorProp(state,layerId,propName,value){var layerList=state.layerList;var layerIdx=getLayerIndex(layerList,layerId);var updatedLayer=_extends({},layerList[layerIdx],{sourceDescriptor:_extends({},layerList[layerIdx].sourceDescriptor,_defineProperty({},propName,value))});var updatedList=[].concat(_toConsumableArray(layerList.slice(0,layerIdx)),[updatedLayer],_toConsumableArray(layerList.slice(layerIdx+1)));return _extends({},state,{layerList:updatedList})};var INITIAL_STATE={ready:false,goto:null,mapState:{zoom:4,center:{lon:-100.41,lat:32.82},extent:null,mouseCoordinates:null,timeFilters:null,query:null,refreshConfig:null,refreshTimerLastTriggeredAt:null},selectedLayerId:null,__transientLayerId:null,layerList:[],waitingForMapReadyLayerList:[]};function map(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:INITIAL_STATE;var action=arguments[1];switch(action.type){case _store_actions.REMOVE_TRACKED_LAYER_STATE:return removeTrackedLayerState(state,action.layerId);case _store_actions.TRACK_CURRENT_LAYER_STATE:return trackCurrentLayerState(state,action.layerId);case _store_actions.ROLLBACK_TO_TRACKED_LAYER_STATE:return rollbackTrackedLayerState(state,action.layerId);case _store_actions.SET_MOUSE_COORDINATES:return _extends({},state,{mapState:_extends({},state.mapState,{mouseCoordinates:{lat:action.lat,lon:action.lon}})});case _store_actions.CLEAR_MOUSE_COORDINATES:return _extends({},state,{mapState:_extends({},state.mapState,{mouseCoordinates:null})});case _store_actions.SET_GOTO:return _extends({},state,{goto:{center:action.center,bounds:action.bounds}});case _store_actions.CLEAR_GOTO:return _extends({},state,{goto:null});case _store_actions.SET_LAYER_ERROR_STATUS:var layerList=state.layerList;var layerIdx=getLayerIndex(layerList,action.layerId);if(layerIdx===-1){return state}return _extends({},state,{layerList:[].concat(_toConsumableArray(layerList.slice(0,layerIdx)),[_extends({},layerList[layerIdx],{__isInErrorState:action.isInErrorState,__errorMessage:action.errorMessage})],_toConsumableArray(layerList.slice(layerIdx+1)))});case _store_actions.UPDATE_SOURCE_DATA_REQUEST:return updateSourceDataRequest(state,action);case _store_actions.LAYER_DATA_LOAD_STARTED:return updateWithDataRequest(state,action);case _store_actions.LAYER_DATA_LOAD_ERROR:return resetDataRequest(state,action);case _store_actions.LAYER_DATA_LOAD_ENDED:return updateWithDataResponse(state,action);case _store_actions.TOUCH_LAYER:var layer=state.layerList.find(function(layer){return layer.id===action.layerId});if(!layer){return state}var indexOfLayer=state.layerList.indexOf(layer);var newLayer=_extends({},layer);var newLayerList=[].concat(_toConsumableArray(state.layerList));newLayerList[indexOfLayer]=newLayer;return _extends({},state,{layerList:newLayerList});case _store_actions.MAP_READY:return _extends({},state,{ready:true});case _store_actions.MAP_DESTROYED:return _extends({},state,{ready:false});case _store_actions.MAP_EXTENT_CHANGED:var newMapState={center:action.mapState.center,zoom:action.mapState.zoom,extent:action.mapState.extent,buffer:action.mapState.buffer};return _extends({},state,{mapState:_extends({},state.mapState,newMapState)});case _store_actions.SET_QUERY:var query=action.query,timeFilters=action.timeFilters;return _extends({},state,{mapState:_extends({},state.mapState,{query:query,timeFilters:timeFilters})});case _store_actions.SET_REFRESH_CONFIG:var isPaused=action.isPaused,interval=action.interval;return _extends({},state,{mapState:_extends({},state.mapState,{refreshConfig:{isPaused:isPaused,interval:interval}})});case _store_actions.TRIGGER_REFRESH_TIMER:return _extends({},state,{mapState:_extends({},state.mapState,{refreshTimerLastTriggeredAt:(new Date).toISOString()})});case _store_actions.SET_SELECTED_LAYER:var selectedMatch=state.layerList.find(function(layer){return layer.id===action.selectedLayerId});return _extends({},state,{selectedLayerId:selectedMatch?action.selectedLayerId:null});case _store_actions.SET_TRANSIENT_LAYER:var transientMatch=state.layerList.find(function(layer){return layer.id===action.transientLayerId});return _extends({},state,{__transientLayerId:transientMatch?action.transientLayerId:null});case _store_actions.UPDATE_LAYER_ORDER:return _extends({},state,{layerList:action.newLayerOrder.map(function(layerNumber){return state.layerList[layerNumber]})});case _store_actions.UPDATE_LAYER_PROP:return updateLayerInList(state,action.id,action.propName,action.newValue);case _store_actions.UPDATE_SOURCE_PROP:return updateLayerSourceDescriptorProp(state,action.layerId,action.propName,action.value);case _store_actions.SET_JOINS:var layerDescriptor=state.layerList.find(function(descriptor){return descriptor.id===action.layer.getId()});if(layerDescriptor){var newLayerDescriptor=_extends({},layerDescriptor,{joins:action.joins.slice()});var index=state.layerList.findIndex(function(descriptor){return descriptor.id===action.layer.getId()});var _newLayerList=state.layerList.slice();_newLayerList[index]=newLayerDescriptor;return _extends({},state,{layerList:_newLayerList})}return state;case _store_actions.ADD_LAYER:return _extends({},state,{layerList:[].concat(_toConsumableArray(state.layerList),[action.layer])});case _store_actions.REMOVE_LAYER:return _extends({},state,{layerList:[].concat(_toConsumableArray(state.layerList.filter(function(_ref2){var id=_ref2.id;return id!==action.id})))});case _store_actions.ADD_WAITING_FOR_MAP_READY_LAYER:return _extends({},state,{waitingForMapReadyLayerList:[].concat(_toConsumableArray(state.waitingForMapReadyLayerList),[action.layer])});case _store_actions.CLEAR_WAITING_FOR_MAP_READY_LAYER_LIST:return _extends({},state,{waitingForMapReadyLayerList:[]});case _store_actions.TOGGLE_LAYER_VISIBLE:return updateLayerInList(state,action.layerId,"visible");case _store_actions.UPDATE_LAYER_STYLE:var styleLayerId=action.layerId;return updateLayerInList(state,styleLayerId,"style",_extends({},action.style));default:return state}}function findDataRequest(layerDescriptor,dataRequestAction){if(!layerDescriptor.__dataRequests){return}return layerDescriptor.__dataRequests.find(function(dataRequest){return dataRequest.dataId===dataRequestAction.dataId})}function updateWithDataRequest(state,action){var dataRequest=getValidDataRequest(state,action,false);var layerRequestingData=findLayerById(state,action.layerId);if(!dataRequest){dataRequest={dataId:action.dataId};layerRequestingData.__dataRequests=[].concat(_toConsumableArray(layerRequestingData.__dataRequests?layerRequestingData.__dataRequests:[]),[dataRequest])}dataRequest.dataMetaAtStart=action.meta;dataRequest.dataRequestToken=action.requestToken;var layerList=[].concat(_toConsumableArray(state.layerList));return _extends({},state,{layerList:layerList})}function updateSourceDataRequest(state,action){var layerDescriptor=findLayerById(state,action.layerId);if(!layerDescriptor){return state}var dataRequest=layerDescriptor.__dataRequests.find(function(dataRequest){return dataRequest.dataId===_constants.SOURCE_DATA_ID_ORIGIN});if(!dataRequest){return state}dataRequest.data=action.newData;return resetDataRequest(state,action,dataRequest)}function updateWithDataResponse(state,action){var dataRequest=getValidDataRequest(state,action);if(!dataRequest){return state}dataRequest.data=action.data;dataRequest.dataMeta=_extends({},dataRequest.dataMetaAtStart,action.meta);dataRequest.dataMetaAtStart=null;return resetDataRequest(state,action,dataRequest)}function resetDataRequest(state,action,request){var dataRequest=request||getValidDataRequest(state,action);if(!dataRequest){return state}dataRequest.dataRequestToken=null;dataRequest.dataId=action.dataId;var layerList=[].concat(_toConsumableArray(state.layerList));return _extends({},state,{layerList:layerList})}function getValidDataRequest(state,action){var checkRequestToken=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var layer=findLayerById(state,action.layerId);if(!layer){return}var dataRequest=findDataRequest(layer,action);if(!dataRequest){return}if(checkRequestToken&&dataRequest.dataRequestToken&&dataRequest.dataRequestToken!==action.requestToken){return}return dataRequest}function findLayerById(state,id){return state.layerList.find(function(layer){return layer.id===id})}function trackCurrentLayerState(state,layerId){var layer=findLayerById(state,layerId);var layerCopy=(0,_util.copyPersistentState)(layer);return updateLayerInList(state,layerId,_util.TRACKED_LAYER_DESCRIPTOR,layerCopy)}function removeTrackedLayerState(state,layerId){var layer=findLayerById(state,layerId);if(!layer){return state}var copyLayer=_extends({},layer);delete copyLayer[_util.TRACKED_LAYER_DESCRIPTOR];return _extends({},state,{layerList:replaceInLayerList(state.layerList,layerId,copyLayer)})}function rollbackTrackedLayerState(state,layerId){var layer=findLayerById(state,layerId);if(!layer){return state}var trackedLayerDescriptor=layer[_util.TRACKED_LAYER_DESCRIPTOR];var rolledbackLayer=_extends({},layer,trackedLayerDescriptor);delete rolledbackLayer[_util.TRACKED_LAYER_DESCRIPTOR];return _extends({},state,{layerList:replaceInLayerList(state.layerList,layerId,rolledbackLayer)})}function replaceInLayerList(layerList,layerId,newLayerDescriptor){var layerIndex=getLayerIndex(layerList,layerId);var newLayerList=[].concat(_toConsumableArray(layerList));newLayerList[layerIndex]=newLayerDescriptor;return newLayerList}},3348:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ems_file_source=__webpack_require__(3349);Object.defineProperty(exports,"EMSFileSource",{enumerable:true,get:function get(){return _ems_file_source.EMSFileSource}})},3349:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EMSFileSource=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _vector_source=__webpack_require__(764);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _constants=__webpack_require__(193);var _kibana_services=__webpack_require__(227);var _meta=__webpack_require__(290);var _create_source_editor=__webpack_require__(3350);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EMSFileSource=exports.EMSFileSource=function(_AbstractVectorSource){_inherits(EMSFileSource,_AbstractVectorSource);_createClass(EMSFileSource,null,[{key:"createDescriptor",value:function createDescriptor(id){return{type:EMSFileSource.type,id:id}}},{key:"renderEditor",value:function renderEditor(_ref){var onPreviewSource=_ref.onPreviewSource;var onChange=function onChange(selectedId){var emsFileSourceDescriptor=EMSFileSource.createDescriptor(selectedId);var emsFileSource=new EMSFileSource(emsFileSourceDescriptor);onPreviewSource(emsFileSource)};return _react2.default.createElement(_create_source_editor.EMSFileCreateSourceEditor,{onChange:onChange})}}]);function EMSFileSource(descriptor){_classCallCheck(this,EMSFileSource);return _possibleConstructorReturn(this,(EMSFileSource.__proto__||Object.getPrototypeOf(EMSFileSource)).call(this,descriptor))}_createClass(EMSFileSource,[{key:"_getEmsVectorFileMeta",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this2=this;var emsFiles,meta;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_meta.getEmsVectorFilesMeta)();case 2:emsFiles=_context.sent;meta=emsFiles.find(function(source){return source.id===_this2._descriptor.id});if(meta){_context.next=6;break}throw new Error(_i18n.i18n.translate("xpack.maps.source.emsFile.unableToFindIdErrorMessage",{defaultMessage:"Unable to find EMS vector shapes for id: {id}",values:{id:this._descriptor.id}}));case 6:return _context.abrupt("return",meta);case 7:case"end":return _context.stop()}}},_callee,this)}));function _getEmsVectorFileMeta(){return _ref2.apply(this,arguments)}return _getEmsVectorFileMeta}()},{key:"getGeoJsonWithMeta",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var emsVectorFileMeta,featureCollection;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this._getEmsVectorFileMeta();case 2:emsVectorFileMeta=_context2.sent;_context2.next=5;return _vector_source.AbstractVectorSource.getGeoJson({format:emsVectorFileMeta.format,featureCollectionPath:"data",fetchUrl:"../"+_constants.GIS_API_PATH+"/data/ems?id="+encodeURIComponent(this._descriptor.id)});case 5:featureCollection=_context2.sent;return _context2.abrupt("return",{data:featureCollection,meta:{}});case 7:case"end":return _context2.stop()}}},_callee2,this)}));function getGeoJsonWithMeta(){return _ref3.apply(this,arguments)}return getGeoJsonWithMeta}()},{key:"getImmutableProperties",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var emsLink;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _kibana_services.emsServiceSettings.getEMSHotLink({id:this._descriptor.id});case 2:emsLink=_context3.sent;return _context3.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:EMSFileSource.title},{label:_i18n.i18n.translate("xpack.maps.source.emsFile.layerLabel",{defaultMessage:"Layer"}),value:this._descriptor.id,link:emsLink}]);case 4:case"end":return _context3.stop()}}},_callee3,this)}));function getImmutableProperties(){return _ref4.apply(this,arguments)}return getImmutableProperties}()},{key:"getDisplayName",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var emsVectorFileMeta;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return this._getEmsVectorFileMeta();case 3:emsVectorFileMeta=_context4.sent;return _context4.abrupt("return",emsVectorFileMeta.name);case 7:_context4.prev=7;_context4.t0=_context4["catch"](0);return _context4.abrupt("return",this._descriptor.id);case 10:case"end":return _context4.stop()}}},_callee4,this,[[0,7]])}));function getDisplayName(){return _ref5.apply(this,arguments)}return getDisplayName}()},{key:"getAttributions",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var emsVectorFileMeta;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this._getEmsVectorFileMeta();case 2:emsVectorFileMeta=_context5.sent;return _context5.abrupt("return",emsVectorFileMeta.attributions);case 4:case"end":return _context5.stop()}}},_callee5,this)}));function getAttributions(){return _ref6.apply(this,arguments)}return getAttributions}()},{key:"getStringFields",value:function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var emsVectorFileMeta;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return this._getEmsVectorFileMeta();case 2:emsVectorFileMeta=_context6.sent;return _context6.abrupt("return",emsVectorFileMeta.fields.map(function(f){return{name:f.name,label:f.description}}));case 4:case"end":return _context6.stop()}}},_callee6,this)}));function getStringFields(){return _ref7.apply(this,arguments)}return getStringFields}()},{key:"canFormatFeatureProperties",value:function canFormatFeatureProperties(){return true}}]);return EMSFileSource}(_vector_source.AbstractVectorSource);EMSFileSource.type=_constants.EMS_FILE;EMSFileSource.title=_i18n.i18n.translate("xpack.maps.source.emsFileTitle",{defaultMessage:"Vector shapes"});EMSFileSource.description=_i18n.i18n.translate("xpack.maps.source.emsFileDescription",{defaultMessage:"Vector shapes of administrative boundaries from Elastic Maps Service"});EMSFileSource.icon="emsApp"},3350:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EMSFileCreateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _meta=__webpack_require__(290);var _ems_unavailable_message=__webpack_require__(1231);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EMSFileCreateSourceEditor=exports.EMSFileCreateSourceEditor=function(_React$Component){_inherits(EMSFileCreateSourceEditor,_React$Component);function EMSFileCreateSourceEditor(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,EMSFileCreateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=EMSFileCreateSourceEditor.__proto__||Object.getPrototypeOf(EMSFileCreateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={emsFileOptionsRaw:null,selectedOption:null},_this._loadFileOptions=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var options;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_meta.getEmsVectorFilesMeta)();case 2:options=_context.sent;if(_this._isMounted){_this.setState({emsFileOptionsRaw:options})}case 4:case"end":return _context.stop()}}},_callee,_this2)})),_this._onChange=function(selectedOptions){if(selectedOptions.length===0){return}_this.setState({selectedOption:selectedOptions[0]});var emsFileId=selectedOptions[0].value;_this.props.onChange(emsFileId)},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(EMSFileCreateSourceEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadFileOptions()}},{key:"render",value:function render(){if(!this.state.emsFileOptionsRaw){return null}var options=this.state.emsFileOptionsRaw.map(function(_ref3){var id=_ref3.id,name=_ref3.name;return{label:name,value:id}});return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.emsFile.layerLabel",{defaultMessage:"Layer"}),helpText:this.state.emsFileOptionsRaw.length===0?(0,_ems_unavailable_message.getEmsUnavailableMessage)():null},_react2.default.createElement(_eui.EuiComboBox,{placeholder:_i18n.i18n.translate("xpack.maps.source.emsFile.selectPlaceholder",{defaultMessage:"Select EMS vector shapes"}),options:options,selectedOptions:this.state.selectedOption?[this.state.selectedOption]:[],onChange:this._onChange,isClearable:false,singleSelection:true,isDisabled:this.state.emsFileOptionsRaw.length===0,"data-test-subj":"emsVectorComboBox"}))}}]);return EMSFileCreateSourceEditor}(_react2.default.Component)},3351:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _kibana_regionmap_source=__webpack_require__(3352);Object.defineProperty(exports,"KibanaRegionmapSource",{enumerable:true,get:function get(){return _kibana_regionmap_source.KibanaRegionmapSource}})},3352:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.KibanaRegionmapSource=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _vector_source=__webpack_require__(764);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _create_source_editor=__webpack_require__(3353);var _meta=__webpack_require__(290);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var KibanaRegionmapSource=exports.KibanaRegionmapSource=function(_AbstractVectorSource){_inherits(KibanaRegionmapSource,_AbstractVectorSource);function KibanaRegionmapSource(descriptor){_classCallCheck(this,KibanaRegionmapSource);return _possibleConstructorReturn(this,(KibanaRegionmapSource.__proto__||Object.getPrototypeOf(KibanaRegionmapSource)).call(this,descriptor))}_createClass(KibanaRegionmapSource,[{key:"getImmutableProperties",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:KibanaRegionmapSource.title},{label:_i18n.i18n.translate("xpack.maps.source.kbnRegionMap.vectorLayerLabel",{defaultMessage:"Vector layer"}),value:this._descriptor.name}]);case 1:case"end":return _context.stop()}}},_callee,this)}));function getImmutableProperties(){return _ref.apply(this,arguments)}return getImmutableProperties}()},{key:"_getVectorFileMeta",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this2=this;var regionList,meta;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return(0,_meta.getKibanaRegionList)();case 2:regionList=_context2.sent;meta=regionList.find(function(source){return source.name===_this2._descriptor.name});if(meta){_context2.next=6;break}throw new Error(_i18n.i18n.translate("xpack.maps.source.kbnRegionMap.noConfigErrorMessage",{defaultMessage:"Unable to find map.regionmap configuration for {name}",values:{name:this._descriptor.name}}));case 6:return _context2.abrupt("return",meta);case 7:case"end":return _context2.stop()}}},_callee2,this)}));function _getVectorFileMeta(){return _ref2.apply(this,arguments)}return _getVectorFileMeta}()},{key:"getGeoJsonWithMeta",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var vectorFileMeta,featureCollection;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this._getVectorFileMeta();case 2:vectorFileMeta=_context3.sent;_context3.next=5;return _vector_source.AbstractVectorSource.getGeoJson({format:vectorFileMeta.format.type,featureCollectionPath:vectorFileMeta.meta.feature_collection_path,fetchUrl:vectorFileMeta.url});case 5:featureCollection=_context3.sent;return _context3.abrupt("return",{data:featureCollection});case 7:case"end":return _context3.stop()}}},_callee3,this)}));function getGeoJsonWithMeta(){return _ref3.apply(this,arguments)}return getGeoJsonWithMeta}()},{key:"getStringFields",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var vectorFileMeta;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this._getVectorFileMeta();case 2:vectorFileMeta=_context4.sent;return _context4.abrupt("return",vectorFileMeta.fields.map(function(f){return{name:f.name,label:f.description}}));case 4:case"end":return _context4.stop()}}},_callee4,this)}));function getStringFields(){return _ref4.apply(this,arguments)}return getStringFields}()},{key:"getDisplayName",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",this._descriptor.name);case 1:case"end":return _context5.stop()}}},_callee5,this)}));function getDisplayName(){return _ref5.apply(this,arguments)}return getDisplayName}()},{key:"isTimeAware",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt("return",false);case 1:case"end":return _context6.stop()}}},_callee6,this)}));function isTimeAware(){return _ref6.apply(this,arguments)}return isTimeAware}()},{key:"canFormatFeatureProperties",value:function canFormatFeatureProperties(){return true}}],[{key:"createDescriptor",value:function createDescriptor(options){return{type:KibanaRegionmapSource.type,name:options.name}}}]);return KibanaRegionmapSource}(_vector_source.AbstractVectorSource);KibanaRegionmapSource.type="REGIONMAP_FILE";KibanaRegionmapSource.title=_i18n.i18n.translate("xpack.maps.source.kbnRegionMapTitle",{defaultMessage:"Custom vector shapes"});KibanaRegionmapSource.description=_i18n.i18n.translate("xpack.maps.source.kbnRegionMapDescription",{defaultMessage:"Vector shapes from static files configured in kibana.yml"});KibanaRegionmapSource.icon="logoKibana";KibanaRegionmapSource.renderEditor=function(_ref7){var onPreviewSource=_ref7.onPreviewSource;var onSelect=function onSelect(layerConfig){var sourceDescriptor=KibanaRegionmapSource.createDescriptor(layerConfig);var source=new KibanaRegionmapSource(sourceDescriptor);onPreviewSource(source)};return _react2.default.createElement(_create_source_editor.CreateSourceEditor,{onSelect:onSelect})}},3353:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _meta=__webpack_require__(290);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CreateSourceEditor=exports.CreateSourceEditor=function(_React$Component){_inherits(CreateSourceEditor,_React$Component);function CreateSourceEditor(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,CreateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=CreateSourceEditor.__proto__||Object.getPrototypeOf(CreateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={regionmapLayers:[]},_this._loadList=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var list;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_meta.getKibanaRegionList)();case 2:list=_context.sent;if(_this._isMounted){_this.setState({regionmapLayers:list})}case 4:case"end":return _context.stop()}}},_callee,_this2)})),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(CreateSourceEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadList()}},{key:"render",value:function render(){var _this3=this;var onChange=function onChange(_ref3){var target=_ref3.target;var selectedName=target.options[target.selectedIndex].text;_this3.props.onSelect({name:selectedName})};var regionmapOptions=this.state.regionmapLayers.map(function(_ref4){var name=_ref4.name,url=_ref4.url;return{value:url,text:name}});return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.kbnRegionMap.vectorLayerLabel",{defaultMessage:"Vector layer"}),helpText:this.state.regionmapLayers.length===0?_i18n.i18n.translate("xpack.maps.source.kbnRegionMap.noLayerAvailableHelptext",{defaultMessage:'No vector layers are available. Ask your system administrator to set "map.regionmap" in kibana.yml.'}):null},_react2.default.createElement(_eui.EuiSelect,{hasNoInitialSelection:true,options:regionmapOptions,onChange:onChange,disabled:this.state.regionmapLayers.length===0}))}}]);return CreateSourceEditor}(_react2.default.Component);CreateSourceEditor.propTypes={onSelect:_propTypes2.default.func.isRequired}},3354:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.XYZTMSSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _tms_source=__webpack_require__(548);var _tile_layer=__webpack_require__(445);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var XYZTMSSource=exports.XYZTMSSource=function(_AbstractTMSSource){_inherits(XYZTMSSource,_AbstractTMSSource);function XYZTMSSource(){_classCallCheck(this,XYZTMSSource);return _possibleConstructorReturn(this,(XYZTMSSource.__proto__||Object.getPrototypeOf(XYZTMSSource)).apply(this,arguments))}_createClass(XYZTMSSource,[{key:"getImmutableProperties",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:XYZTMSSource.title},{label:(0,_i18n_getters.getUrlLabel)(),value:this._descriptor.urlTemplate}]);case 1:case"end":return _context.stop()}}},_callee,this)}));function getImmutableProperties(){return _ref.apply(this,arguments)}return getImmutableProperties}()},{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(options){return _tile_layer.TileLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options))}},{key:"createDefaultLayer",value:function createDefaultLayer(options){return new _tile_layer.TileLayer({layerDescriptor:this._createDefaultLayerDescriptor(options),source:this})}},{key:"getDisplayName",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",this._descriptor.urlTemplate);case 1:case"end":return _context2.stop()}}},_callee2,this)}));function getDisplayName(){return _ref2.apply(this,arguments)}return getDisplayName}()},{key:"getUrlTemplate",value:function getUrlTemplate(){return this._descriptor.urlTemplate}}],[{key:"createDescriptor",value:function createDescriptor(urlTemplate){return{type:XYZTMSSource.type,urlTemplate:urlTemplate}}},{key:"renderEditor",value:function renderEditor(_ref3){var onPreviewSource=_ref3.onPreviewSource;var previewTMS=function previewTMS(urlTemplate){var sourceDescriptor=XYZTMSSource.createDescriptor(urlTemplate);var source=new XYZTMSSource(sourceDescriptor);onPreviewSource(source)};return _react2.default.createElement(XYZTMSEditor,{previewTMS:previewTMS})}}]);return XYZTMSSource}(_tms_source.AbstractTMSSource);XYZTMSSource.type="EMS_XYZ";XYZTMSSource.title=_i18n.i18n.translate("xpack.maps.source.ems_xyzTitle",{defaultMessage:"Tile Map Service from URL"});XYZTMSSource.description=_i18n.i18n.translate("xpack.maps.source.ems_xyzDescription",{defaultMessage:"Map tiles from a URL that includes the XYZ coordinates"});XYZTMSSource.icon="grid";var XYZTMSEditor=function(_React$Component){_inherits(XYZTMSEditor,_React$Component);function XYZTMSEditor(){_classCallCheck(this,XYZTMSEditor);var _this2=_possibleConstructorReturn(this,(XYZTMSEditor.__proto__||Object.getPrototypeOf(XYZTMSEditor)).call(this));_this2.state={tmsInput:"",tmsCanPreview:false};return _this2}_createClass(XYZTMSEditor,[{key:"_handleTMSInputChange",value:function _handleTMSInputChange(e){var url=e.target.value;var canPreview=url.indexOf("{x}")>=0&&url.indexOf("{y}")>=0&&url.indexOf("{z}")>=0;this.setState({tmsInput:url,tmsCanPreview:canPreview});if(canPreview){this.props.previewTMS(url)}}},{key:"render",value:function render(){var _this3=this;return _react2.default.createElement(_eui.EuiFormRow,{label:"Url"},_react2.default.createElement(_eui.EuiFieldText,{placeholder:"https://a.tile.openstreetmap.org/{z}/{x}/{y}.png",onChange:function onChange(e){return _this3._handleTMSInputChange(e)}}))}}]);return XYZTMSEditor}(_react2.default.Component)},3355:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EMSTMSSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _tms_source=__webpack_require__(548);var _tile_layer=__webpack_require__(445);var _meta=__webpack_require__(290);var _create_source_editor=__webpack_require__(3356);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EMSTMSSource=exports.EMSTMSSource=function(_AbstractTMSSource){_inherits(EMSTMSSource,_AbstractTMSSource);_createClass(EMSTMSSource,null,[{key:"createDescriptor",value:function createDescriptor(serviceId){return{type:EMSTMSSource.type,id:serviceId}}},{key:"renderEditor",value:function renderEditor(_ref){var onPreviewSource=_ref.onPreviewSource;var onChange=function onChange(_ref2){var target=_ref2.target;var selectedId=target.options[target.selectedIndex].value;var emsTMSSourceDescriptor=EMSTMSSource.createDescriptor(selectedId);var emsTMSSource=new EMSTMSSource(emsTMSSourceDescriptor);onPreviewSource(emsTMSSource)};return _react2.default.createElement(_create_source_editor.EMSTMSCreateSourceEditor,{onChange:onChange})}}]);function EMSTMSSource(descriptor){_classCallCheck(this,EMSTMSSource);return _possibleConstructorReturn(this,(EMSTMSSource.__proto__||Object.getPrototypeOf(EMSTMSSource)).call(this,descriptor))}_createClass(EMSTMSSource,[{key:"getImmutableProperties",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:EMSTMSSource.title},{label:_i18n.i18n.translate("xpack.maps.source.emsTile.serviceId",{defaultMessage:"Tile service"}),value:this._descriptor.id}]);case 1:case"end":return _context.stop()}}},_callee,this)}));function getImmutableProperties(){return _ref3.apply(this,arguments)}return getImmutableProperties}()},{key:"_getEmsTmsMeta",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this2=this;var emsTileServices,meta;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return(0,_meta.getEmsTMSServices)();case 2:emsTileServices=_context2.sent;meta=emsTileServices.find(function(service){return service.id===_this2._descriptor.id});if(meta){_context2.next=6;break}throw new Error(_i18n.i18n.translate("xpack.maps.source.emsTile.errorMessage",{defaultMessage:"Unable to find EMS tile configuration for id: {id}",values:{id:this._descriptor.id}}));case 6:return _context2.abrupt("return",meta);case 7:case"end":return _context2.stop()}}},_callee2,this)}));function _getEmsTmsMeta(){return _ref4.apply(this,arguments)}return _getEmsTmsMeta}()},{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(options){return _tile_layer.TileLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options))}},{key:"createDefaultLayer",value:function createDefaultLayer(options){return new _tile_layer.TileLayer({layerDescriptor:this._createDefaultLayerDescriptor(options),source:this})}},{key:"getDisplayName",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",this._descriptor.id);case 1:case"end":return _context3.stop()}}},_callee3,this)}));function getDisplayName(){return _ref5.apply(this,arguments)}return getDisplayName}()},{key:"getAttributions",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var emsTmsMeta;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this._getEmsTmsMeta();case 2:emsTmsMeta=_context4.sent;if(emsTmsMeta.attributionMarkdown){_context4.next=5;break}return _context4.abrupt("return",[]);case 5:return _context4.abrupt("return",emsTmsMeta.attributionMarkdown.split("|").map(function(attribution){attribution=attribution.trim();var extractLink=/\[(.*)\]\((.*)\)/;var result=extractLink.exec(attribution);return{label:result?result[1]:null,url:result?result[2]:null}}));case 6:case"end":return _context4.stop()}}},_callee4,this)}));function getAttributions(){return _ref6.apply(this,arguments)}return getAttributions}()},{key:"getUrlTemplate",value:function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var emsTmsMeta;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this._getEmsTmsMeta();case 2:emsTmsMeta=_context5.sent;return _context5.abrupt("return",emsTmsMeta.url);case 4:case"end":return _context5.stop()}}},_callee5,this)}));function getUrlTemplate(){return _ref7.apply(this,arguments)}return getUrlTemplate}()}]);return EMSTMSSource}(_tms_source.AbstractTMSSource);EMSTMSSource.type="EMS_TMS";EMSTMSSource.title=_i18n.i18n.translate("xpack.maps.source.emsTileTitle",{defaultMessage:"Tiles"});EMSTMSSource.description=_i18n.i18n.translate("xpack.maps.source.emsTileDescription",{defaultMessage:"Map tiles from Elastic Maps Service"});EMSTMSSource.icon="emsApp"},3356:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EMSTMSCreateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _meta=__webpack_require__(290);var _ems_unavailable_message=__webpack_require__(1231);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EMSTMSCreateSourceEditor=exports.EMSTMSCreateSourceEditor=function(_React$Component){_inherits(EMSTMSCreateSourceEditor,_React$Component);function EMSTMSCreateSourceEditor(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,EMSTMSCreateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=EMSTMSCreateSourceEditor.__proto__||Object.getPrototypeOf(EMSTMSCreateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={emsTmsOptionsRaw:null},_this._loadTmsOptions=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var options;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_meta.getEmsTMSServices)();case 2:options=_context.sent;if(_this._isMounted){_this.setState({emsTmsOptionsRaw:options})}case 4:case"end":return _context.stop()}}},_callee,_this2)})),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(EMSTMSCreateSourceEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadTmsOptions()}},{key:"render",value:function render(){if(!this.state.emsTmsOptionsRaw){return null}var emsTileOptions=this.state.emsTmsOptionsRaw.map(function(service){return{value:service.id,text:service.id}});return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.emsTile.label",{defaultMessage:"Tile service"}),helpText:this.state.emsTmsOptionsRaw.length===0?(0,_ems_unavailable_message.getEmsUnavailableMessage)():null},_react2.default.createElement(_eui.EuiSelect,{hasNoInitialSelection:true,options:emsTileOptions,onChange:this.props.onChange,disabled:this.state.emsTmsOptionsRaw.length===0}))}}]);return EMSTMSCreateSourceEditor}(_react2.default.Component)},3357:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WMSSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _tms_source=__webpack_require__(548);var _tile_layer=__webpack_require__(445);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WMSSource=exports.WMSSource=function(_AbstractTMSSource){_inherits(WMSSource,_AbstractTMSSource);function WMSSource(){_classCallCheck(this,WMSSource);return _possibleConstructorReturn(this,(WMSSource.__proto__||Object.getPrototypeOf(WMSSource)).apply(this,arguments))}_createClass(WMSSource,[{key:"getImmutableProperties",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:WMSSource.title},{label:(0,_i18n_getters.getUrlLabel)(),value:this._descriptor.serviceUrl},{label:_i18n.i18n.translate("xpack.maps.source.wms.layersLabel",{defaultMessage:"Layers"}),value:this._descriptor.layers},{label:_i18n.i18n.translate("xpack.maps.source.wms.stylesLabel",{defaultMessage:"Styles"}),value:this._descriptor.styles}]);case 1:case"end":return _context.stop()}}},_callee,this)}));function getImmutableProperties(){return _ref.apply(this,arguments)}return getImmutableProperties}()},{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(options){return _tile_layer.TileLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options))}},{key:"createDefaultLayer",value:function createDefaultLayer(options){return new _tile_layer.TileLayer({layerDescriptor:this._createDefaultLayerDescriptor(options),source:this})}},{key:"getDisplayName",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",this._descriptor.serviceUrl);case 1:case"end":return _context2.stop()}}},_callee2,this)}));function getDisplayName(){return _ref2.apply(this,arguments)}return getDisplayName}()},{key:"getUrlTemplate",value:function getUrlTemplate(){var styles=this._descriptor.styles||"";return this._descriptor.serviceUrl+"?bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&srs=EPSG:3857&transparent=true&width=256&height=256&layers="+this._descriptor.layers+"&styles="+styles}}],[{key:"createDescriptor",value:function createDescriptor(_ref3){var serviceUrl=_ref3.serviceUrl,layers=_ref3.layers,styles=_ref3.styles;return{type:WMSSource.type,serviceUrl:serviceUrl,layers:layers,styles:styles}}},{key:"renderEditor",value:function renderEditor(_ref4){var onPreviewSource=_ref4.onPreviewSource;var previewWMS=function previewWMS(options){var sourceDescriptor=WMSSource.createDescriptor(options);var source=new WMSSource(sourceDescriptor);onPreviewSource(source)};return _react2.default.createElement(WMSEditor,{previewWMS:previewWMS})}}]);return WMSSource}(_tms_source.AbstractTMSSource);WMSSource.type="WMS";WMSSource.title=_i18n.i18n.translate("xpack.maps.source.wmsTitle",{defaultMessage:"Web Map Service"});WMSSource.description=_i18n.i18n.translate("xpack.maps.source.wmsDescription",{defaultMessage:"Maps from OGC Standard WMS"});WMSSource.icon="grid";var WMSEditor=function(_React$Component){_inherits(WMSEditor,_React$Component);function WMSEditor(){_classCallCheck(this,WMSEditor);var _this2=_possibleConstructorReturn(this,(WMSEditor.__proto__||Object.getPrototypeOf(WMSEditor)).call(this));_this2.state={serviceUrl:"",layers:"",styles:""};return _this2}_createClass(WMSEditor,[{key:"_previewIfPossible",value:function _previewIfPossible(){if(this.state.serviceUrl&&this.state.layers){this.props.previewWMS({serviceUrl:this.state.serviceUrl,layers:this.state.layers,styles:this.state.styles})}}},{key:"_handleServiceUrlChange",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(e){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.setState({serviceUrl:e.target.value});case 2:this._previewIfPossible();case 3:case"end":return _context3.stop()}}},_callee3,this)}));function _handleServiceUrlChange(_x){return _ref5.apply(this,arguments)}return _handleServiceUrlChange}()},{key:"_handleLayersChange",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(e){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.setState({layers:e.target.value});case 2:this._previewIfPossible();case 3:case"end":return _context4.stop()}}},_callee4,this)}));function _handleLayersChange(_x2){return _ref6.apply(this,arguments)}return _handleLayersChange}()},{key:"_handleStylesChange",value:function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(e){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this.setState({styles:e.target.value});case 2:this._previewIfPossible();case 3:case"end":return _context5.stop()}}},_callee5,this)}));function _handleStylesChange(_x3){return _ref7.apply(this,arguments)}return _handleStylesChange}()},{key:"render",value:function render(){var _this3=this;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Url"},_react2.default.createElement(_eui.EuiFieldText,{value:this.state.serviceUrl,onChange:function onChange(e){return _this3._handleServiceUrlChange(e)}})),_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.wms.layersLabel",{defaultMessage:"Layers"}),helpText:_i18n.i18n.translate("xpack.maps.source.wms.layersHelpText",{defaultMessage:"use comma separated list of layer names"})},_react2.default.createElement(_eui.EuiFieldText,{onChange:function onChange(e){return _this3._handleLayersChange(e)}})),_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.wms.stylesLabel",{defaultMessage:"Styles"}),helpText:_i18n.i18n.translate("xpack.maps.source.wms.stylesHelpText",{defaultMessage:"use comma separated list of style names"})},_react2.default.createElement(_eui.EuiFieldText,{onChange:function onChange(e){return _this3._handleStylesChange(e)}})))}}]);return WMSEditor}(_react2.default.Component)},3358:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.KibanaTilemapSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _tms_source=__webpack_require__(548);var _tile_layer=__webpack_require__(445);var _create_source_editor=__webpack_require__(3359);var _meta=__webpack_require__(290);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var KibanaTilemapSource=exports.KibanaTilemapSource=function(_AbstractTMSSource){_inherits(KibanaTilemapSource,_AbstractTMSSource);function KibanaTilemapSource(){_classCallCheck(this,KibanaTilemapSource);return _possibleConstructorReturn(this,(KibanaTilemapSource.__proto__||Object.getPrototypeOf(KibanaTilemapSource)).apply(this,arguments))}_createClass(KibanaTilemapSource,[{key:"getImmutableProperties",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0={label:(0,_i18n_getters.getDataSourceLabel)(),value:KibanaTilemapSource.title};_context.t1=_i18n.i18n.translate("xpack.maps.source.kbnTMS.urlLabel",{defaultMessage:"Tilemap url"});_context.next=4;return this.getUrlTemplate();case 4:_context.t2=_context.sent;_context.t3={label:_context.t1,value:_context.t2};return _context.abrupt("return",[_context.t0,_context.t3]);case 7:case"end":return _context.stop()}}},_callee,this)}));function getImmutableProperties(){return _ref.apply(this,arguments)}return getImmutableProperties}()},{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(options){return _tile_layer.TileLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options))}},{key:"createDefaultLayer",value:function createDefaultLayer(options){return new _tile_layer.TileLayer({layerDescriptor:this._createDefaultLayerDescriptor(options),source:this})}},{key:"getUrlTemplate",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var tilemap;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return(0,_meta.getKibanaTileMap)();case 2:tilemap=_context2.sent;if(tilemap.url){_context2.next=5;break}throw new Error(_i18n.i18n.translate("xpack.maps.source.kbnTMS.noConfigErrorMessage",{defaultMessage:"Unable to find map.tilemap.url configuration in the kibana.yml"}));case 5:return _context2.abrupt("return",tilemap.url);case 6:case"end":return _context2.stop()}}},_callee2,this)}));function getUrlTemplate(){return _ref2.apply(this,arguments)}return getUrlTemplate}()},{key:"getDisplayName",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return this.getUrlTemplate();case 3:return _context3.abrupt("return",_context3.sent);case 6:_context3.prev=6;_context3.t0=_context3["catch"](0);return _context3.abrupt("return","");case 9:case"end":return _context3.stop()}}},_callee3,this,[[0,6]])}));function getDisplayName(){return _ref3.apply(this,arguments)}return getDisplayName}()}],[{key:"createDescriptor",value:function createDescriptor(){return{type:KibanaTilemapSource.type}}}]);return KibanaTilemapSource}(_tms_source.AbstractTMSSource);KibanaTilemapSource.type="KIBANA_TILEMAP";KibanaTilemapSource.title=_i18n.i18n.translate("xpack.maps.source.kbnTMSTitle",{defaultMessage:"Custom Tile Map Service"});KibanaTilemapSource.description=_i18n.i18n.translate("xpack.maps.source.kbnTMSDescription",{defaultMessage:"Map tiles configured in kibana.yml"});KibanaTilemapSource.icon="logoKibana";KibanaTilemapSource.renderEditor=function(_ref4){var onPreviewSource=_ref4.onPreviewSource;var previewTilemap=function previewTilemap(){var sourceDescriptor=KibanaTilemapSource.createDescriptor();var source=new KibanaTilemapSource(sourceDescriptor);onPreviewSource(source)};return _react2.default.createElement(_create_source_editor.CreateSourceEditor,{previewTilemap:previewTilemap})}},3359:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _meta=__webpack_require__(290);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CreateSourceEditor=exports.CreateSourceEditor=function(_Component){_inherits(CreateSourceEditor,_Component);function CreateSourceEditor(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,CreateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=CreateSourceEditor.__proto__||Object.getPrototypeOf(CreateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={url:null},_this._loadUrl=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var tilemap;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_meta.getKibanaTileMap)();case 2:tilemap=_context.sent;if(_this._isMounted){_this.setState({url:tilemap.url},function(){if(_this.state.url){_this.props.previewTilemap()}})}case 4:case"end":return _context.stop()}}},_callee,_this2)})),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(CreateSourceEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadUrl()}},{key:"render",value:function render(){if(this.state.url===null){return null}return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.kbnTMS.kbnTMS.urlLabel",{defaultMessage:"Tilemap url"}),helpText:this.state.url?null:_i18n.i18n.translate("xpack.maps.source.kbnTMS.noLayerAvailableHelptext",{defaultMessage:'No tilemap layer is available. Ask your system administrator to set "map.tilemap.url" in kibana.yml.'})},_react2.default.createElement(_eui.EuiFieldText,{readOnly:true,value:this.state.url}))}}]);return CreateSourceEditor}(_react.Component);CreateSourceEditor.propTypes={previewTilemap:_propTypes2.default.func.isRequired}},3360:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _es_geo_grid_source=__webpack_require__(3361);Object.defineProperty(exports,"ESGeoGridSource",{enumerable:true,get:function get(){return _es_geo_grid_source.ESGeoGridSource}})},3361:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ESGeoGridSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _v=__webpack_require__(330);var _v2=_interopRequireDefault(_v);var _es_source=__webpack_require__(763);var _heatmap_layer=__webpack_require__(1228);var _vector_layer=__webpack_require__(758);var _schemas=__webpack_require__(64);var _elasticsearch_geo_utils=__webpack_require__(547);var _agg_configs=__webpack_require__(497);var _tabify=__webpack_require__(1234);var _convert_to_geojson=__webpack_require__(3362);var _vector_style=__webpack_require__(332);var _render_as=__webpack_require__(767);var _create_source_editor=__webpack_require__(3363);var _update_source_editor=__webpack_require__(3364);var _grid_resolution=__webpack_require__(766);var _zoom_to_precision=__webpack_require__(3367);var _constants=__webpack_require__(193);var _util=__webpack_require__(1226);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var COUNT_PROP_LABEL="count";var COUNT_PROP_NAME="doc_count";var aggSchemas=new _schemas.Schemas([{group:"metrics",name:"metric",title:"Value",min:1,max:Infinity,aggFilter:["avg","count","max","min","sum"],defaults:[{schema:"metric",type:"count"}]},{group:"buckets",name:"segment",title:"Geo Coordinates",aggFilter:"geohash_grid",min:1,max:1}]);var ESGeoGridSource=exports.ESGeoGridSource=function(_AbstractESSource){_inherits(ESGeoGridSource,_AbstractESSource);function ESGeoGridSource(){_classCallCheck(this,ESGeoGridSource);return _possibleConstructorReturn(this,(ESGeoGridSource.__proto__||Object.getPrototypeOf(ESGeoGridSource)).apply(this,arguments))}_createClass(ESGeoGridSource,[{key:"renderSourceSettingsEditor",value:function renderSourceSettingsEditor(_ref){var onChange=_ref.onChange;return _react2.default.createElement(_update_source_editor.UpdateSourceEditor,{indexPatternId:this._descriptor.indexPatternId,onChange:onChange,metrics:this._descriptor.metrics,renderAs:this._descriptor.requestType,resolution:this._descriptor.resolution})}},{key:"getImmutableProperties",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var indexPatternTitle,indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:indexPatternTitle=this._descriptor.indexPatternId;_context.prev=1;_context.next=4;return this._getIndexPattern();case 4:indexPattern=_context.sent;indexPatternTitle=indexPattern.title;_context.next=10;break;case 8:_context.prev=8;_context.t0=_context["catch"](1);case 10:return _context.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:ESGeoGridSource.title},{label:_i18n.i18n.translate("xpack.maps.source.esGrid.indexPatternLabel",{defaultMessage:"Index pattern"}),value:indexPatternTitle},{label:_i18n.i18n.translate("xpack.maps.source.esGrid.geospatialFieldLabel",{defaultMessage:"Geospatial field"}),value:this._descriptor.geoField},{label:_i18n.i18n.translate("xpack.maps.source.esGrid.showasFieldLabel",{defaultMessage:"Show as"}),value:this._descriptor.requestType}]);case 11:case"end":return _context.stop()}}},_callee,this,[[1,8]])}));function getImmutableProperties(){return _ref2.apply(this,arguments)}return getImmutableProperties}()},{key:"getFieldNames",value:function getFieldNames(){return this.getMetricFields().map(function(_ref3){var propertyKey=_ref3.propertyKey;return propertyKey})}},{key:"isGeoGridPrecisionAware",value:function isGeoGridPrecisionAware(){return true}},{key:"isJoinable",value:function isJoinable(){return false}},{key:"getGridResolution",value:function getGridResolution(){return this._descriptor.resolution}},{key:"getGeoGridPrecision",value:function getGeoGridPrecision(zoom){return(0,_zoom_to_precision.getGeohashPrecisionForZoom)(zoom)+this._getGeoGridPrecisionResolutionDelta()}},{key:"_getGeoGridPrecisionResolutionDelta",value:function _getGeoGridPrecisionResolutionDelta(){if(this._descriptor.resolution===_grid_resolution.GRID_RESOLUTION.COARSE){return 0}if(this._descriptor.resolution===_grid_resolution.GRID_RESOLUTION.FINE){return 1}if(this._descriptor.resolution===_grid_resolution.GRID_RESOLUTION.MOST_FINE){return 2}throw new Error(_i18n.i18n.translate("xpack.maps.source.esGrid.resolutionParamErrorMessage",{defaultMessage:"Grid resolution param not recognized: {resolution}",values:{resolution:this._descriptor.resolution}}))}},{key:"getGeoJsonWithMeta",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(_ref4,searchFilters){var layerName=_ref4.layerName;var featureCollection;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.getGeoJsonPoints({layerName:layerName},{geogridPrecision:searchFilters.geogridPrecision,buffer:searchFilters.buffer,timeFilters:searchFilters.timeFilters,query:searchFilters.query});case 2:featureCollection=_context2.sent;if(this._descriptor.requestType===_render_as.RENDER_AS.GRID){featureCollection.features.forEach(function(feature){feature.geometry=(0,_elasticsearch_geo_utils.makeGeohashGridPolygon)(feature)})}return _context2.abrupt("return",{data:featureCollection,meta:{areResultsTrimmed:false}});case 5:case"end":return _context2.stop()}}},_callee2,this)}));function getGeoJsonWithMeta(_x,_x2){return _ref5.apply(this,arguments)}return getGeoJsonWithMeta}()},{key:"getNumberFields",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",this.getMetricFields().map(function(_ref7){var name=_ref7.propertyKey,label=_ref7.propertyLabel;return{label:label,name:name}}));case 1:case"end":return _context3.stop()}}},_callee3,this)}));function getNumberFields(){return _ref6.apply(this,arguments)}return getNumberFields}()},{key:"getGeoJsonPoints",value:function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(_ref8,_ref9){var layerName=_ref8.layerName;var geogridPrecision=_ref9.geogridPrecision,buffer=_ref9.buffer,timeFilters=_ref9.timeFilters,query=_ref9.query;var indexPattern,searchSource,aggConfigs,esResponse,tabifiedResp,_convertToGeoJson,featureCollection;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this._getIndexPattern();case 2:indexPattern=_context4.sent;_context4.next=5;return this._makeSearchSource({buffer:buffer,timeFilters:timeFilters,query:query},0);case 5:searchSource=_context4.sent;aggConfigs=new _agg_configs.AggConfigs(indexPattern,this._makeAggConfigs(geogridPrecision),aggSchemas.all);searchSource.setField("aggs",aggConfigs.toDsl());_context4.next=10;return this._runEsQuery(layerName,searchSource,_i18n.i18n.translate("xpack.maps.source.esGrid.inspectorDescription",{defaultMessage:"Elasticsearch geo grid aggregation request"}));case 10:esResponse=_context4.sent;tabifiedResp=(0,_tabify.tabifyAggResponse)(aggConfigs,esResponse);_convertToGeoJson=(0,_convert_to_geojson.convertToGeoJson)(tabifiedResp),featureCollection=_convertToGeoJson.featureCollection;return _context4.abrupt("return",featureCollection);case 14:case"end":return _context4.stop()}}},_callee4,this)}));function getGeoJsonPoints(_x3,_x4){return _ref10.apply(this,arguments)}return getGeoJsonPoints}()},{key:"isFilterByMapBounds",value:function isFilterByMapBounds(){return true}},{key:"_formatMetricKey",value:function _formatMetricKey(metric){return metric.type!=="count"?metric.type+"_of_"+metric.field:COUNT_PROP_NAME}},{key:"_formatMetricLabel",value:function _formatMetricLabel(metric){return metric.type!=="count"?metric.type+" of "+metric.field:COUNT_PROP_LABEL}},{key:"_makeAggConfigs",value:function _makeAggConfigs(precision){var metricAggConfigs=this.getMetricFields().map(function(metric){var metricAggConfig={id:metric.propertyKey,enabled:true,type:metric.type,schema:"metric",params:{}};if(metric.type!=="count"){metricAggConfig.params={field:metric.field}}return metricAggConfig});return[].concat(_toConsumableArray(metricAggConfigs),[{id:"grid",enabled:true,type:"geohash_grid",schema:"segment",params:{field:this._descriptor.geoField,isFilteredByCollar:false,useGeocentroid:true,autoPrecision:false,precision:precision}}])}},{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(options){if(this._descriptor.requestType===_render_as.RENDER_AS.HEATMAP){return _heatmap_layer.HeatmapLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options))}var descriptor=_vector_layer.VectorLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options));descriptor.style=_vector_style.VectorStyle.createDescriptor({fillColor:{type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:{field:{label:COUNT_PROP_LABEL,name:COUNT_PROP_NAME,origin:_constants.SOURCE_DATA_ID_ORIGIN},color:"Blues"}},iconSize:{type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:{field:{label:COUNT_PROP_LABEL,name:COUNT_PROP_NAME,origin:_constants.SOURCE_DATA_ID_ORIGIN},minSize:4,maxSize:32}}});return descriptor}},{key:"createDefaultLayer",value:function createDefaultLayer(options){if(this._descriptor.requestType===_render_as.RENDER_AS.HEATMAP){return new _heatmap_layer.HeatmapLayer({layerDescriptor:this._createDefaultLayerDescriptor(options),source:this})}var layerDescriptor=this._createDefaultLayerDescriptor(options);var style=new _vector_style.VectorStyle(layerDescriptor.style);return new _vector_layer.VectorLayer({layerDescriptor:layerDescriptor,source:this,style:style})}},{key:"canFormatFeatureProperties",value:function canFormatFeatureProperties(){return true}},{key:"filterAndFormatProperties",value:function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(properties){var metricFields;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:metricFields=this.getMetricFields();return _context5.abrupt("return",(0,_util.filterPropertiesForTooltip)(metricFields,properties));case 2:case"end":return _context5.stop()}}},_callee5,this)}));function filterAndFormatProperties(_x5){return _ref11.apply(this,arguments)}return filterAndFormatProperties}()}],[{key:"createDescriptor",value:function createDescriptor(_ref12){var indexPatternId=_ref12.indexPatternId,geoField=_ref12.geoField,requestType=_ref12.requestType,resolution=_ref12.resolution;return{type:ESGeoGridSource.type,id:(0,_v2.default)(),indexPatternId:indexPatternId,geoField:geoField,requestType:requestType,resolution:resolution?resolution:_grid_resolution.GRID_RESOLUTION.COARSE}}},{key:"renderEditor",value:function renderEditor(_ref13){var onPreviewSource=_ref13.onPreviewSource;var onSelect=function onSelect(sourceConfig){if(!sourceConfig){onPreviewSource(null);return}var sourceDescriptor=ESGeoGridSource.createDescriptor(sourceConfig);var source=new ESGeoGridSource(sourceDescriptor);onPreviewSource(source)};return _react2.default.createElement(_create_source_editor.CreateSourceEditor,{onSelect:onSelect})}}]);return ESGeoGridSource}(_es_source.AbstractESSource);ESGeoGridSource.type="ES_GEO_GRID";ESGeoGridSource.title=_i18n.i18n.translate("xpack.maps.source.esGridTitle",{defaultMessage:"Grid aggregation"});ESGeoGridSource.description=_i18n.i18n.translate("xpack.maps.source.esGridDescription",{defaultMessage:"Geospatial data grouped in grids with metrics for each gridded cell"})},3362:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.convertToGeoJson=convertToGeoJson;var _decode_geo_hash=__webpack_require__(500);var _grid_dimensions=__webpack_require__(1146);function convertToGeoJson(tabifiedResponse){var features=void 0;var min=Infinity;var max=-Infinity;var geoAgg=void 0;if(tabifiedResponse&&tabifiedResponse.rows){var table=tabifiedResponse;var geohashColumn=table.columns.find(function(column){return column.aggConfig.type.dslName==="geohash_grid"});if(!geohashColumn){features=[]}else{geoAgg=geohashColumn.aggConfig;var metricColumns=table.columns.filter(function(column){return column.aggConfig.type.type==="metrics"&&column.aggConfig.type.dslName!=="geo_centroid"});var geocentroidColumn=table.columns.find(function(column){return column.aggConfig.type.dslName==="geo_centroid"});features=table.rows.map(function(row){var geohash=row[geohashColumn.id];if(!geohash)return false;var geohashLocation=(0,_decode_geo_hash.decodeGeoHash)(geohash);var pointCoordinates=void 0;if(geocentroidColumn){var location=row[geocentroidColumn.id];pointCoordinates=[location.lon,location.lat]}else{pointCoordinates=[geohashLocation.longitude[2],geohashLocation.latitude[2]]}var rectangle=[[geohashLocation.latitude[0],geohashLocation.longitude[0]],[geohashLocation.latitude[0],geohashLocation.longitude[1]],[geohashLocation.latitude[1],geohashLocation.longitude[1]],[geohashLocation.latitude[1],geohashLocation.longitude[0]]];var centerLatLng=[geohashLocation.latitude[2],geohashLocation.longitude[2]];if(geoAgg.params.useGeocentroid){pointCoordinates[0]=clampGrid(pointCoordinates[0],geohashLocation.longitude[0],geohashLocation.longitude[1]);pointCoordinates[1]=clampGrid(pointCoordinates[1],geohashLocation.latitude[0],geohashLocation.latitude[1])}var metrics={};metricColumns.forEach(function(metricColumn){metrics[metricColumn.aggConfig.id]=row[metricColumn.id]});return{type:"Feature",geometry:{type:"Point",coordinates:pointCoordinates},properties:_extends({geohash:geohash,geohash_meta:{center:centerLatLng,rectangle:rectangle}},metrics)}}).filter(function(row){return row})}}else{features=[]}var featureCollection={type:"FeatureCollection",features:features};return{featureCollection:featureCollection,meta:{min:min,max:max,geohashGridDimensionsAtEquator:geoAgg&&(0,_grid_dimensions.gridDimensions)(geoAgg.params.precision)}}}function clampGrid(val,min,max){if(val>max)val=max;else if(val<min)val=min;return val}},3363:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _index_pattern_select=__webpack_require__(417);var _single_field_select=__webpack_require__(446);var _render_as=__webpack_require__(767);var _kibana_services=__webpack_require__(227);var _no_index_pattern_callout=__webpack_require__(1235);var _i18n=__webpack_require__(5);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function filterGeoField(_ref){var type=_ref.type;return["geo_point"].includes(type)}var requestTypeOptions=[{label:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.pointsDropdownOption",{defaultMessage:"points"}),value:_render_as.RENDER_AS.POINT},{label:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.gridRectangleDropdownOption",{defaultMessage:"grid rectangles"}),value:_render_as.RENDER_AS.GRID},{label:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.heatmapDropdownOption",{defaultMessage:"heat map"}),value:_render_as.RENDER_AS.HEATMAP}];var CreateSourceEditor=exports.CreateSourceEditor=function(_Component){_inherits(CreateSourceEditor,_Component);function CreateSourceEditor(){var _ref2,_this2=this;var _temp,_this,_ret;_classCallCheck(this,CreateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref2=CreateSourceEditor.__proto__||Object.getPrototypeOf(CreateSourceEditor)).call.apply(_ref2,[this].concat(args))),_this),_this.state={isLoadingIndexPattern:false,indexPatternId:"",geoField:"",requestType:requestTypeOptions[0],noGeoIndexPatternsExist:false},_this.onIndexPatternSelect=function(indexPatternId){_this.setState({indexPatternId:indexPatternId},_this.loadIndexPattern.bind(null,indexPatternId))},_this.loadIndexPattern=function(indexPatternId){_this.setState({isLoadingIndexPattern:true,indexPattern:undefined,geoField:undefined},_this.debouncedLoad.bind(null,indexPatternId))},_this.debouncedLoad=_lodash2.default.debounce(function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(indexPatternId){var indexPattern,geoFields;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!indexPatternId||indexPatternId.length===0)){_context.next=2;break}return _context.abrupt("return");case 2:indexPattern=void 0;_context.prev=3;_context.next=6;return _kibana_services.indexPatternService.get(indexPatternId);case 6:indexPattern=_context.sent;_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](3);return _context.abrupt("return");case 12:if(_this._isMounted){_context.next=14;break}return _context.abrupt("return");case 14:if(!(indexPattern.id!==indexPatternId)){_context.next=16;break}return _context.abrupt("return");case 16:_this.setState({isLoadingIndexPattern:false,indexPattern:indexPattern});geoFields=indexPattern.fields.filter(filterGeoField);if(geoFields[0]){_this._onGeoFieldSelect(geoFields[0].name)}case 19:case"end":return _context.stop()}}},_callee,_this2,[[3,9]])}));return function(_x){return _ref3.apply(this,arguments)}}(),300),_this._onGeoFieldSelect=function(geoField){_this.setState({geoField:geoField},_this.previewLayer)},_this._onRequestTypeSelect=function(selectedOptions){_this.setState({requestType:selectedOptions[0]},_this.previewLayer)},_this.previewLayer=function(){var _this$state=_this.state,indexPatternId=_this$state.indexPatternId,geoField=_this$state.geoField,requestType=_this$state.requestType;var sourceConfig=indexPatternId&&geoField?{indexPatternId:indexPatternId,geoField:geoField,requestType:requestType.value}:null;_this.props.onSelect(sourceConfig)},_this._onNoIndexPatterns=function(){_this.setState({noGeoIndexPatternsExist:true})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(CreateSourceEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true}},{key:"_renderGeoSelect",value:function _renderGeoSelect(){if(!this.state.indexPattern){return null}return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.geofieldLabel",{defaultMessage:"Geospatial field"})},_react2.default.createElement(_single_field_select.SingleFieldSelect,{placeholder:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.geofieldPlaceholder",{defaultMessage:"Select geo field"}),value:this.state.geoField,onChange:this._onGeoFieldSelect,filterField:filterGeoField,fields:this.state.indexPattern?this.state.indexPattern.fields:undefined}))}},{key:"_renderLayerSelect",value:function _renderLayerSelect(){if(!this.state.indexPattern){return null}return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.showAsLabel",{defaultMessage:"Show as"})},_react2.default.createElement(_eui.EuiComboBox,{placeholder:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.showAsPlaceholder",{defaultMessage:"Select a single option"}),singleSelection:{asPlainText:true},options:requestTypeOptions,selectedOptions:[this.state.requestType],onChange:this._onRequestTypeSelect,isClearable:false}))}},{key:"_renderIndexPatternSelect",value:function _renderIndexPatternSelect(){return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.indexPatternLabel",{defaultMessage:"Index pattern"})},_react2.default.createElement(_index_pattern_select.IndexPatternSelect,{isDisabled:this.state.noGeoIndexPatternsExist,indexPatternId:this.state.indexPatternId,onChange:this.onIndexPatternSelect,placeholder:_i18n.i18n.translate("xpack.maps.source.esGeoGrid.indexPatternPlaceholder",{defaultMessage:"Select index pattern"}),fieldTypes:["geo_point"],onNoIndexPatterns:this._onNoIndexPatterns}))}},{key:"_renderNoIndexPatternWarning",value:function _renderNoIndexPatternWarning(){if(!this.state.noGeoIndexPatternsExist){return null}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_no_index_pattern_callout.NoIndexPatternCallout,null),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}))}},{key:"render",value:function render(){return _react2.default.createElement(_react.Fragment,null,this._renderNoIndexPatternWarning(),this._renderIndexPatternSelect(),this._renderGeoSelect(),this._renderLayerSelect())}}]);return CreateSourceEditor}(_react.Component);CreateSourceEditor.propTypes={onSelect:_propTypes2.default.func.isRequired}},3364:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.UpdateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _render_as=__webpack_require__(767);var _metrics_editor=__webpack_require__(1236);var _kibana_services=__webpack_require__(227);var _resolution_editor=__webpack_require__(3366);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var UpdateSourceEditor=exports.UpdateSourceEditor=function(_Component){_inherits(UpdateSourceEditor,_Component);function UpdateSourceEditor(){var _ref;var _temp,_this,_ret;_classCallCheck(this,UpdateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=UpdateSourceEditor.__proto__||Object.getPrototypeOf(UpdateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={fields:null},_this._onMetricsChange=function(metrics){_this.props.onChange({propName:"metrics",value:metrics})},_this._onResolutionChange=function(e){_this.props.onChange({propName:"resolution",value:e})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(UpdateSourceEditor,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadFields()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"_loadFields",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:indexPattern=void 0;_context.prev=1;_context.next=4;return _kibana_services.indexPatternService.get(this.props.indexPatternId);case 4:indexPattern=_context.sent;_context.next=11;break;case 7:_context.prev=7;_context.t0=_context["catch"](1);if(this._isMounted){this.setState({loadError:_i18n.i18n.translate("xpack.maps.source.esGrid.noIndexPatternErrorMessage",{defaultMessage:"Unable to find Index pattern {id}",values:{id:this.props.indexPatternId}})})}return _context.abrupt("return");case 11:if(this._isMounted){_context.next=13;break}return _context.abrupt("return");case 13:this.setState({fields:indexPattern.fields});case 14:case"end":return _context.stop()}}},_callee,this,[[1,7]])}));function _loadFields(){return _ref2.apply(this,arguments)}return _loadFields}()},{key:"_renderMetricsEditor",value:function _renderMetricsEditor(){var metricsFilter=this.props.renderAs===_render_as.RENDER_AS.HEATMAP?function(metric){return["count","sum"].includes(metric.value)}:null;var allowMultipleMetrics=this.props.renderAs!==_render_as.RENDER_AS.HEATMAP;return _react2.default.createElement(_metrics_editor.MetricsEditor,{allowMultipleMetrics:allowMultipleMetrics,metricsFilter:metricsFilter,fields:this.state.fields,metrics:this.props.metrics,onChange:this._onMetricsChange})}},{key:"render",value:function render(){return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_resolution_editor.ResolutionEditor,{resolution:this.props.resolution,onChange:this._onResolutionChange}),this._renderMetricsEditor())}}]);return UpdateSourceEditor}(_react.Component)},3365:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.METRIC_AGGREGATION_VALUES=undefined;exports.MetricSelect=MetricSelect;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _i18n=__webpack_require__(5);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var AGG_OPTIONS=[{label:_i18n.i18n.translate("xpack.maps.metricSelect.averageDropDownOptionLabel",{defaultMessage:"Average"}),value:"avg"},{label:_i18n.i18n.translate("xpack.maps.metricSelect.countDropDownOptionLabel",{defaultMessage:"Count"}),value:"count"},{label:_i18n.i18n.translate("xpack.maps.metricSelect.maxDropDownOptionLabel",{defaultMessage:"Max"}),value:"max"},{label:_i18n.i18n.translate("xpack.maps.metricSelect.minDropDownOptionLabel",{defaultMessage:"Min"}),value:"min"},{label:_i18n.i18n.translate("xpack.maps.metricSelect.sumDropDownOptionLabel",{defaultMessage:"Sum"}),value:"sum"}];var METRIC_AGGREGATION_VALUES=exports.METRIC_AGGREGATION_VALUES=AGG_OPTIONS.map(function(_ref){var value=_ref.value;return value});function MetricSelect(_ref2){var value=_ref2.value,onChange=_ref2.onChange,metricsFilter=_ref2.metricsFilter;function onAggChange(selectedOptions){if(selectedOptions.length===0){return}var aggType=selectedOptions[0].value;onChange(aggType)}var options=metricsFilter?AGG_OPTIONS.filter(metricsFilter):AGG_OPTIONS;return _react2.default.createElement(_eui.EuiComboBox,{placeholder:_i18n.i18n.translate("xpack.maps.metricSelect.selectAggregationPlaceholder",{defaultMessage:"Select aggregation"}),singleSelection:true,isClearable:false,options:options,selectedOptions:AGG_OPTIONS.filter(function(option){return value===option.value}),onChange:onAggChange})}MetricSelect.propTypes={metricsFilter:_propTypes2.default.func,value:_propTypes2.default.oneOf(METRIC_AGGREGATION_VALUES),onChange:_propTypes2.default.func.isRequired}},3366:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResolutionEditor=ResolutionEditor;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _grid_resolution=__webpack_require__(766);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var OPTIONS=[{value:_grid_resolution.GRID_RESOLUTION.COARSE,inputDisplay:_i18n.i18n.translate("xpack.maps.source.esGrid.coarseDropdownOption",{defaultMessage:"coarse"})},{value:_grid_resolution.GRID_RESOLUTION.FINE,inputDisplay:_i18n.i18n.translate("xpack.maps.source.esGrid.fineDropdownOption",{defaultMessage:"fine"})},{value:_grid_resolution.GRID_RESOLUTION.MOST_FINE,inputDisplay:_i18n.i18n.translate("xpack.maps.source.esGrid.finestDropdownOption",{defaultMessage:"finest"})}];function ResolutionEditor(_ref){var resolution=_ref.resolution,onChange=_ref.onChange;return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:true},_react2.default.createElement(_eui.EuiFormLabel,{style:{marginBottom:0}},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.geoGrid.resolutionLabel",defaultMessage:"Grid resolution"})))),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:true},_react2.default.createElement(_eui.EuiSuperSelect,{options:OPTIONS,valueOfSelected:resolution,onChange:onChange}))))}},3367:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ZOOM_TO_PRECISION={0:1,1:2,2:2,3:2,4:3,5:3,6:4,7:4,8:4,9:5,10:5,11:6,12:6,13:6,14:7,15:7,16:8,17:8,18:8,19:9,20:9,21:10,22:10,23:10,24:11,25:11,26:12,27:12,28:12,29:12,30:12};var getGeohashPrecisionForZoom=exports.getGeohashPrecisionForZoom=function getGeohashPrecisionForZoom(zoom){var zoomNormalized=Math.round(zoom);zoomNormalized=Math.max(0,Math.min(zoomNormalized,30));return ZOOM_TO_PRECISION[zoomNormalized]}},3368:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _es_search_source=__webpack_require__(3369);Object.defineProperty(exports,"ESSearchSource",{enumerable:true,get:function get(){return _es_search_source.ESSearchSource}})},3369:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ESSearchSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _v=__webpack_require__(330);var _v2=_interopRequireDefault(_v);var _es_source=__webpack_require__(763);var _elasticsearch_geo_utils=__webpack_require__(547);var _create_source_editor=__webpack_require__(3370);var _update_source_editor=__webpack_require__(3371);var _i18n=__webpack_require__(5);var _i18n_getters=__webpack_require__(291);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var DEFAULT_LIMIT=2048;var ESSearchSource=exports.ESSearchSource=function(_AbstractESSource){_inherits(ESSearchSource,_AbstractESSource);_createClass(ESSearchSource,null,[{key:"renderEditor",value:function renderEditor(_ref){var onPreviewSource=_ref.onPreviewSource;var onSelect=function onSelect(sourceConfig){if(!sourceConfig){onPreviewSource(null);return}var source=new ESSearchSource(_extends({id:(0,_v2.default)()},sourceConfig));onPreviewSource(source)};return _react2.default.createElement(_create_source_editor.CreateSourceEditor,{onSelect:onSelect})}}]);function ESSearchSource(descriptor){_classCallCheck(this,ESSearchSource);return _possibleConstructorReturn(this,(ESSearchSource.__proto__||Object.getPrototypeOf(ESSearchSource)).call(this,{id:descriptor.id,type:ESSearchSource.type,indexPatternId:descriptor.indexPatternId,geoField:descriptor.geoField,limit:_lodash2.default.get(descriptor,"limit",DEFAULT_LIMIT),filterByMapBounds:_lodash2.default.get(descriptor,"filterByMapBounds",true),tooltipProperties:_lodash2.default.get(descriptor,"tooltipProperties",[])}))}_createClass(ESSearchSource,[{key:"renderSourceSettingsEditor",value:function renderSourceSettingsEditor(_ref2){var onChange=_ref2.onChange;return _react2.default.createElement(_update_source_editor.UpdateSourceEditor,{indexPatternId:this._descriptor.indexPatternId,onChange:onChange,filterByMapBounds:this._descriptor.filterByMapBounds,tooltipProperties:this._descriptor.tooltipProperties})}},{key:"getNumberFields",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return this._getIndexPattern();case 3:indexPattern=_context.sent;return _context.abrupt("return",indexPattern.fields.byType.number.map(function(field){return{name:field.name,label:field.name}}));case 7:_context.prev=7;_context.t0=_context["catch"](0);return _context.abrupt("return",[]);case 10:case"end":return _context.stop()}}},_callee,this,[[0,7]])}));function getNumberFields(){return _ref3.apply(this,arguments)}return getNumberFields}()},{key:"getMetricFields",value:function getMetricFields(){return[]}},{key:"getFieldNames",value:function getFieldNames(){return[this._descriptor.geoField].concat(_toConsumableArray(this._descriptor.tooltipProperties))}},{key:"getImmutableProperties",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var indexPatternTitle,geoFieldType,indexPattern,geoField;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:indexPatternTitle=this._descriptor.indexPatternId;geoFieldType="";_context2.prev=2;_context2.next=5;return this._getIndexPattern();case 5:indexPattern=_context2.sent;indexPatternTitle=indexPattern.title;_context2.next=9;return this._getGeoField();case 9:geoField=_context2.sent;geoFieldType=geoField.type;_context2.next=15;break;case 13:_context2.prev=13;_context2.t0=_context2["catch"](2);case 15:return _context2.abrupt("return",[{label:(0,_i18n_getters.getDataSourceLabel)(),value:ESSearchSource.title},{label:_i18n.i18n.translate("xpack.maps.source.esSearch.indexPatternLabel",{defaultMessage:"Index pattern"}),value:indexPatternTitle},{label:_i18n.i18n.translate("xpack.maps.source.esSearch.geoFieldLabel",{defaultMessage:"Geospatial field"}),value:this._descriptor.geoField},{label:_i18n.i18n.translate("xpack.maps.source.esSearch.geoFieldTypeLabel",{defaultMessage:"Geospatial field type"}),value:geoFieldType}]);case 16:case"end":return _context2.stop()}}},_callee2,this,[[2,13]])}));function getImmutableProperties(){return _ref4.apply(this,arguments)}return getImmutableProperties}()},{key:"getGeoJsonWithMeta",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(_ref5,searchFilters){var layerName=_ref5.layerName;var searchSource,featureCollection,indexPattern,flattenHit,resp,geoField;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this._makeSearchSource(searchFilters,this._descriptor.limit);case 2:searchSource=_context3.sent;searchSource.setField("fields",searchFilters.fieldNames);featureCollection=void 0;_context3.next=7;return this._getIndexPattern();case 7:indexPattern=_context3.sent;flattenHit=function flattenHit(hit){var properties=indexPattern.flattenHit(hit);indexPattern.metaFields.forEach(function(metaField){delete properties[metaField]});return properties};_context3.next=11;return this._runEsQuery(layerName,searchSource,"Elasticsearch document request");case 11:resp=_context3.sent;_context3.prev=12;_context3.next=15;return this._getGeoField();case 15:geoField=_context3.sent;featureCollection=(0,_elasticsearch_geo_utils.hitsToGeoJson)(resp.hits.hits,flattenHit,geoField.name,geoField.type);_context3.next=22;break;case 19:_context3.prev=19;_context3.t0=_context3["catch"](12);throw new Error("Unable to convert search response to geoJson feature collection, error: "+_context3.t0.message);case 22:return _context3.abrupt("return",{data:featureCollection,meta:{areResultsTrimmed:resp.hits.total>resp.hits.hits.length}});case 23:case"end":return _context3.stop()}}},_callee3,this,[[12,19]])}));function getGeoJsonWithMeta(_x,_x2){return _ref6.apply(this,arguments)}return getGeoJsonWithMeta}()},{key:"canFormatFeatureProperties",value:function canFormatFeatureProperties(){return this._descriptor.tooltipProperties.length>0}},{key:"filterAndFormatProperties",value:function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(properties){var filteredProperties,indexPattern;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:filteredProperties={};this._descriptor.tooltipProperties.forEach(function(propertyName){filteredProperties[propertyName]=_lodash2.default.get(properties,propertyName,"-")});indexPattern=void 0;_context4.prev=3;_context4.next=6;return this._getIndexPattern();case 6:indexPattern=_context4.sent;_context4.next=13;break;case 9:_context4.prev=9;_context4.t0=_context4["catch"](3);console.warn("Unable to find Index pattern "+this._descriptor.indexPatternId+", values are not formatted");return _context4.abrupt("return",filteredProperties);case 13:this._descriptor.tooltipProperties.forEach(function(propertyName){var field=indexPattern.fields.byName[propertyName];if(!field){return}filteredProperties[propertyName]=field.format.convert(filteredProperties[propertyName])});return _context4.abrupt("return",filteredProperties);case 15:case"end":return _context4.stop()}}},_callee4,this,[[3,9]])}));function filterAndFormatProperties(_x3){return _ref7.apply(this,arguments)}return filterAndFormatProperties}()},{key:"isFilterByMapBounds",value:function isFilterByMapBounds(){return _lodash2.default.get(this._descriptor,"filterByMapBounds",false)}},{key:"getStringFields",value:function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var indexPattern,stringFields;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this._getIndexPattern();case 2:indexPattern=_context5.sent;stringFields=indexPattern.fields.filter(function(field){return field.type==="string"});return _context5.abrupt("return",stringFields.map(function(stringField){return{name:stringField.name,label:stringField.name}}));case 5:case"end":return _context5.stop()}}},_callee5,this)}));function getStringFields(){return _ref8.apply(this,arguments)}return getStringFields}()}]);return ESSearchSource}(_es_source.AbstractESSource);ESSearchSource.type="ES_SEARCH";ESSearchSource.title=_i18n.i18n.translate("xpack.maps.source.esSearchTitle",{defaultMessage:"Documents"});ESSearchSource.description=_i18n.i18n.translate("xpack.maps.source.esSearchDescription",{defaultMessage:"Geospatial data from a Kibana index pattern"})},3370:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _index_pattern_select=__webpack_require__(417);var _single_field_select=__webpack_require__(446);var _kibana_services=__webpack_require__(227);var _no_index_pattern_callout=__webpack_require__(1235);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function filterGeoField(field){return["geo_point","geo_shape"].includes(field.type)}var CreateSourceEditor=exports.CreateSourceEditor=function(_Component){_inherits(CreateSourceEditor,_Component);function CreateSourceEditor(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,CreateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=CreateSourceEditor.__proto__||Object.getPrototypeOf(CreateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={isLoadingIndexPattern:false,indexPatternId:"",geoField:"",noGeoIndexPatternsExist:false},_this.onIndexPatternSelect=function(indexPatternId){_this.setState({indexPatternId:indexPatternId},_this.loadIndexPattern(indexPatternId))},_this.loadIndexPattern=function(indexPatternId){_this.setState({isLoadingIndexPattern:true,indexPattern:undefined,geoField:undefined},_this.debouncedLoad.bind(null,indexPatternId))},_this.debouncedLoad=_lodash2.default.debounce(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(indexPatternId){var indexPattern,geoFields;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!indexPatternId||indexPatternId.length===0)){_context.next=2;break}return _context.abrupt("return");case 2:indexPattern=void 0;_context.prev=3;_context.next=6;return _kibana_services.indexPatternService.get(indexPatternId);case 6:indexPattern=_context.sent;_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](3);return _context.abrupt("return");case 12:if(_this._isMounted){_context.next=14;break}return _context.abrupt("return");case 14:if(!(indexPattern.id!==indexPatternId)){_context.next=16;break}return _context.abrupt("return");case 16:_this.setState({isLoadingIndexPattern:false,indexPattern:indexPattern});geoFields=indexPattern.fields.filter(filterGeoField);if(geoFields[0]){_this.onGeoFieldSelect(geoFields[0].name)}case 19:case"end":return _context.stop()}}},_callee,_this2,[[3,9]])}));return function(_x){return _ref2.apply(this,arguments)}}(),300),_this.onGeoFieldSelect=function(geoField){_this.setState({geoField:geoField},_this.previewLayer)},_this.onLimitChange=function(e){var sanitizedValue=parseInt(e.target.value,10);_this.setState({limit:isNaN(sanitizedValue)?"":sanitizedValue},_this.previewLayer)},_this.previewLayer=function(){var _this$state=_this.state,indexPatternId=_this$state.indexPatternId,geoField=_this$state.geoField;var sourceConfig=indexPatternId&&geoField?{indexPatternId:indexPatternId,geoField:geoField}:null;_this.props.onSelect(sourceConfig)},_this._onNoIndexPatterns=function(){_this.setState({noGeoIndexPatternsExist:true})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(CreateSourceEditor,[{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this.loadIndexPattern(this.state.indexPatternId)}},{key:"_renderGeoSelect",value:function _renderGeoSelect(){if(!this.state.indexPattern){return}return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.esSearch.geofieldLabel",{defaultMessage:"Geospatial field"})},_react2.default.createElement(_single_field_select.SingleFieldSelect,{placeholder:_i18n.i18n.translate("xpack.maps.source.esSearch.selectLabel",{defaultMessage:"Select geo field"}),value:this.state.geoField,onChange:this.onGeoFieldSelect,filterField:filterGeoField,fields:this.state.indexPattern?this.state.indexPattern.fields:undefined}))}},{key:"_renderNoIndexPatternWarning",value:function _renderNoIndexPatternWarning(){if(!this.state.noGeoIndexPatternsExist){return null}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_no_index_pattern_callout.NoIndexPatternCallout,null),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}))}},{key:"render",value:function render(){return _react2.default.createElement(_react.Fragment,null,this._renderNoIndexPatternWarning(),_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.esSearch.indexPatternLabel",{defaultMessage:"Index pattern"})},_react2.default.createElement(_index_pattern_select.IndexPatternSelect,{isDisabled:this.state.noGeoIndexPatternsExist,indexPatternId:this.state.indexPatternId,onChange:this.onIndexPatternSelect,placeholder:_i18n.i18n.translate("xpack.maps.source.esSearch.selectIndexPatternPlaceholder",{defaultMessage:"Select index pattern"}),fieldTypes:["geo_point","geo_shape"],onNoIndexPatterns:this._onNoIndexPatterns})),this._renderGeoSelect())}}]);return CreateSourceEditor}(_react.Component);CreateSourceEditor.propTypes={onSelect:_propTypes2.default.func.isRequired}},3371:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.UpdateSourceEditor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _multi_field_select=__webpack_require__(3372);var _kibana_services=__webpack_require__(227);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var UpdateSourceEditor=exports.UpdateSourceEditor=function(_Component){_inherits(UpdateSourceEditor,_Component);function UpdateSourceEditor(){var _ref;var _temp,_this,_ret;_classCallCheck(this,UpdateSourceEditor);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=UpdateSourceEditor.__proto__||Object.getPrototypeOf(UpdateSourceEditor)).call.apply(_ref,[this].concat(args))),_this),_this.state={fields:null},_this.onTooltipPropertiesSelect=function(propertyNames){_this.props.onChange({propName:"tooltipProperties",value:propertyNames})},_this.onFilterByMapBoundsChange=function(event){_this.props.onChange({propName:"filterByMapBounds",value:event.target.checked})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(UpdateSourceEditor,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this.loadFields()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"loadFields",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:indexPattern=void 0;_context.prev=1;_context.next=4;return _kibana_services.indexPatternService.get(this.props.indexPatternId);case 4:indexPattern=_context.sent;_context.next=11;break;case 7:_context.prev=7;_context.t0=_context["catch"](1);if(this._isMounted){this.setState({loadError:_i18n.i18n.translate("xpack.maps.source.esSearch.loadErrorMessage",{defaultMessage:"Unable to find Index pattern {id}",values:{id:this.props.indexPatternId}})})}return _context.abrupt("return");case 11:if(this._isMounted){_context.next=13;break}return _context.abrupt("return");case 13:this.setState({fields:indexPattern.fields});case 14:case"end":return _context.stop()}}},_callee,this,[[1,7]])}));function loadFields(){return _ref2.apply(this,arguments)}return loadFields}()},{key:"render",value:function render(){return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.source.esSearch.fieldsLabel",{defaultMessage:"Fields to display in tooltip"})},_react2.default.createElement(_multi_field_select.MultiFieldSelect,{placeholder:_i18n.i18n.translate("xpack.maps.source.esSearch.fieldsPlaceholder",{defaultMessage:"Select fields"}),value:this.props.tooltipProperties,onChange:this.onTooltipPropertiesSelect,fields:this.state.fields})),_react2.default.createElement(_eui.EuiFormRow,null,_react2.default.createElement(_eui.EuiSwitch,{label:_i18n.i18n.translate("xpack.maps.source.esSearch.extentFilterLabel",{defaultMessage:"Dynamically filter for data in the visible map area."}),checked:this.props.filterByMapBounds,onChange:this.onFilterByMapBoundsChange})))}}]);return UpdateSourceEditor}(_react.Component);UpdateSourceEditor.propTypes={indexPatternId:_propTypes2.default.string.isRequired,onChange:_propTypes2.default.func.isRequired,filterByMapBounds:_propTypes2.default.bool.isRequired,tooltipProperties:_propTypes2.default.arrayOf(_propTypes2.default.string).isRequired}},3372:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.MultiFieldSelect=MultiFieldSelect;var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _single_field_select=__webpack_require__(446);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function MultiFieldSelect(_ref){var fields=_ref.fields,filterField=_ref.filterField,onChange=_ref.onChange,value=_ref.value,placeholder=_ref.placeholder,rest=_objectWithoutProperties(_ref,["fields","filterField","onChange","value","placeholder"]);if(!fields){return null}var onSelection=function onSelection(selectedOptions){var fieldNamesArray=selectedOptions.map(function(_ref2){var value=_ref2.value;return value});onChange(fieldNamesArray)};var selectedOptions=value?value.map(function(fieldName){return{value:fieldName,label:fieldName}}):[];return _react2.default.createElement(_eui.EuiComboBox,_extends({placeholder:placeholder,options:(0,_single_field_select.getGroupedFieldOptions)(fields,filterField),selectedOptions:selectedOptions,onChange:onSelection},rest))}MultiFieldSelect.propTypes={placeholder:_propTypes2.default.string,fields:_propTypes2.default.object,onChange:_propTypes2.default.func.isRequired,value:_propTypes2.default.arrayOf(_propTypes2.default.string),filterField:_propTypes2.default.func};MultiFieldSelect.defaultProps={filterField:function filterField(){return true}}},3373:function(module,exports,__webpack_require__){"use strict";var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _react3=__webpack_require__(3);var _i18n=__webpack_require__(5);var _reactDom=__webpack_require__(15);var _modules=__webpack_require__(7);var _timefilter=__webpack_require__(16);var _reactRedux=__webpack_require__(14);var _store=__webpack_require__(1227);var _gis_map=__webpack_require__(3374);var _store_actions=__webpack_require__(216);var _ui=__webpack_require__(267);var _map_selectors=__webpack_require__(192);var _inspector=__webpack_require__(286);var _doc_title=__webpack_require__(280);var _kibana_services=__webpack_require__(227);var _saved_object_save_modal=__webpack_require__(539);var _show_saved_object_save_modal=__webpack_require__(538);var _notify=__webpack_require__(9);var _get_initial_layers=__webpack_require__(3409);var _get_initial_query=__webpack_require__(3410);var _get_initial_time_filters=__webpack_require__(3411);var _get_initial_refresh_config=__webpack_require__(3412);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}var REACT_ANCHOR_DOM_ELEMENT_ID="react-maps-root";var app=_modules.uiModules.get("app/maps",[]);app.controller("GisMapController",function($scope,$route,config,kbnUrl,localStorage,AppState,globalState,Private){var updateIndexPatterns=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(nextIndexPatternIds){var _this=this;var indexPatterns,getIndexPatternPromises;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:indexPatterns=[];getIndexPatternPromises=nextIndexPatternIds.map(function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee(indexPatternId){var indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _kibana_services.indexPatternService.get(indexPatternId);case 3:indexPattern=_context.sent;indexPatterns.push(indexPattern);_context.next=9;break;case 7:_context.prev=7;_context.t0=_context["catch"](0);case 9:case"end":return _context.stop()}}},_callee,_this,[[0,7]])}));return function(_x2){return _ref4.apply(this,arguments)}}());_context2.next=4;return Promise.all(getIndexPatternPromises);case 4:if(!(prevIndexPatternIds!==nextIndexPatternIds)){_context2.next=6;break}return _context2.abrupt("return");case 6:$scope.indexPatterns=indexPatterns;case 7:case"end":return _context2.stop()}}},_callee2,this)}));return function updateIndexPatterns(_x){return _ref3.apply(this,arguments)}}();var doSave=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(saveOptions){var store,docTitle,id;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:store=(0,_store.getStore)();_context3.next=3;return store.dispatch((0,_store_actions.clearTransientLayerStateAndCloseFlyout)());case 3:savedMap.syncWithStore(store.getState());docTitle=Private(_doc_title.DocTitleProvider);id=void 0;_context3.prev=6;_context3.next=9;return savedMap.save(saveOptions);case 9:id=_context3.sent;docTitle.change(savedMap.title);_context3.next=17;break;case 13:_context3.prev=13;_context3.t0=_context3["catch"](6);_notify.toastNotifications.addDanger({title:_i18n.i18n.translate("xpack.maps.mapController.saveErrorMessage",{defaultMessage:"Error on saving '{title}'",values:{title:savedMap.title}}),text:_context3.t0.message,"data-test-subj":"saveMapError"});return _context3.abrupt("return",{error:_context3.t0});case 17:if(id){_notify.toastNotifications.addSuccess({title:_i18n.i18n.translate("xpack.maps.mapController.saveSuccessMessage",{defaultMessage:"Saved '{title}'",values:{title:savedMap.title}}),"data-test-subj":"saveMapSuccess"});if(savedMap.id!==$route.current.params.id){$scope.$evalAsync(function(){kbnUrl.change("map/{{id}}",{id:savedMap.id})})}}return _context3.abrupt("return",{id:id});case 19:case"end":return _context3.stop()}}},_callee3,this,[[6,13]])}));return function doSave(_x3){return _ref5.apply(this,arguments)}}();var savedMap=$scope.map=$route.current.locals.map;var unsubscribe=void 0;_kibana_services.inspectorAdapters.requests.reset();$scope.$listen(globalState,"fetch_with_changes",function(diff){if(diff.includes("time")){$scope.updateQueryAndDispatch({query:$scope.query,dateRange:globalState.time})}if(diff.includes("refreshInterval")){$scope.onRefreshChange({isPaused:globalState.pause,refreshInterval:globalState.value})}});var $state=new AppState;$scope.$listen($state,"fetch_with_changes",function(diff){if(diff.includes("query")&&$state.query){$scope.updateQueryAndDispatch({query:$state.query,dateRange:$scope.time})}});function syncAppAndGlobalState(){$scope.$evalAsync(function(){$state.query=$scope.query;$state.save();globalState.time=$scope.time;globalState.refreshInterval={pause:$scope.refreshConfig.isPaused,value:$scope.refreshConfig.interval};globalState.save()})}$scope.query=(0,_get_initial_query.getInitialQuery)({mapStateJSON:savedMap.mapStateJSON,appState:$state,userQueryLanguage:localStorage.get("kibana.userQueryLanguage")});$scope.time=(0,_get_initial_time_filters.getInitialTimeFilters)({mapStateJSON:savedMap.mapStateJSON,globalState:globalState});$scope.refreshConfig=(0,_get_initial_refresh_config.getInitialRefreshConfig)({mapStateJSON:savedMap.mapStateJSON,globalState:globalState});syncAppAndGlobalState();$scope.indexPatterns=[];$scope.updateQueryAndDispatch=function(_ref){var dateRange=_ref.dateRange,query=_ref.query;$scope.query=query;$scope.time=dateRange;syncAppAndGlobalState();(0,_store.getStore)().dispatch((0,_store_actions.setQuery)({query:$scope.query,timeFilters:$scope.time}))};$scope.onRefreshChange=function(_ref2){var isPaused=_ref2.isPaused,refreshInterval=_ref2.refreshInterval;$scope.refreshConfig={isPaused:isPaused,interval:refreshInterval?refreshInterval:$scope.refreshConfig.interval};syncAppAndGlobalState();(0,_store.getStore)().dispatch((0,_store_actions.setRefreshConfig)($scope.refreshConfig))};function renderMap(){var store=(0,_store.getStore)();store.dispatch((0,_store_actions.setSelectedLayer)(null));store.dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.NONE));handleStoreChanges(store);unsubscribe=store.subscribe(function(){handleStoreChanges(store)});if(savedMap.mapStateJSON){var mapState=JSON.parse(savedMap.mapStateJSON);store.dispatch((0,_store_actions.setGotoWithCenter)({lat:mapState.center.lat,lon:mapState.center.lon,zoom:mapState.zoom}))}var layerList=(0,_get_initial_layers.getInitialLayers)(savedMap.layerListJSON);store.dispatch((0,_store_actions.replaceLayerList)(layerList));store.dispatch((0,_store_actions.setRefreshConfig)($scope.refreshConfig));store.dispatch((0,_store_actions.setQuery)({query:$scope.query,timeFilters:$scope.time}));var root=document.getElementById(REACT_ANCHOR_DOM_ELEMENT_ID);(0,_reactDom.render)(_react2.default.createElement(_reactRedux.Provider,{store:store},_react2.default.createElement(_react3.I18nProvider,null,_react2.default.createElement(_gis_map.GisMap,null))),root)}renderMap();var prevIndexPatternIds=void 0;$scope.isFullScreen=false;function handleStoreChanges(store){var nextIsFullScreen=(0,_ui.getIsFullScreen)(store.getState());if(nextIsFullScreen!==$scope.isFullScreen){$scope.$evalAsync(function(){$scope.isFullScreen=nextIsFullScreen})}var nextIndexPatternIds=(0,_map_selectors.getUniqueIndexPatternIds)(store.getState());if(nextIndexPatternIds!==prevIndexPatternIds){prevIndexPatternIds=nextIndexPatternIds;updateIndexPatterns(nextIndexPatternIds)}}$scope.$on("$destroy",function(){if(unsubscribe){unsubscribe()}var node=document.getElementById(REACT_ANCHOR_DOM_ELEMENT_ID);if(node){(0,_reactDom.unmountComponentAtNode)(node)}});$scope.getMapTitle=function(){return $scope.map.title};_chrome2.default.breadcrumbs.set([{text:_i18n.i18n.translate("xpack.maps.mapController.mapsBreadcrumbLabel",{defaultMessage:"Maps"}),href:"#"},{text:$scope.map.title}]);config.watch("k7design",function(val){return $scope.showPluginBreadcrumbs=!val});_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();$scope.showDatePicker=true;$scope.topNavMenu=[{key:_i18n.i18n.translate("xpack.maps.mapController.fullScreenButtonLabel",{defaultMessage:"full screen"}),description:_i18n.i18n.translate("xpack.maps.mapController.fullScreenDescription",{defaultMessage:"full screen"}),testId:"mapsFullScreenMode",run:function run(){(0,_store.getStore)().dispatch((0,_ui.enableFullScreen)())}},{key:_i18n.i18n.translate("xpack.maps.mapController.openInspectorButtonLabel",{defaultMessage:"inspect"}),description:_i18n.i18n.translate("xpack.maps.mapController.openInspectorDescription",{defaultMessage:"Open Inspector"}),testId:"openInspectorButton",run:function run(){_inspector.Inspector.open(_kibana_services.inspectorAdapters,{})}},{key:_i18n.i18n.translate("xpack.maps.mapController.saveMapButtonLabel",{defaultMessage:"save"}),description:_i18n.i18n.translate("xpack.maps.mapController.saveMapDescription",{defaultMessage:"Save map"}),testId:"mapSaveButton",run:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var onSave,saveModal;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:onSave=function onSave(_ref7){var newTitle=_ref7.newTitle,newCopyOnSave=_ref7.newCopyOnSave,isTitleDuplicateConfirmed=_ref7.isTitleDuplicateConfirmed,onTitleDuplicate=_ref7.onTitleDuplicate;var currentTitle=savedMap.title;savedMap.title=newTitle;savedMap.copyOnSave=newCopyOnSave;var saveOptions={confirmOverwrite:false,isTitleDuplicateConfirmed:isTitleDuplicateConfirmed,onTitleDuplicate:onTitleDuplicate};return doSave(saveOptions).then(function(_ref8){var id=_ref8.id,error=_ref8.error;if(!id||error){savedMap.title=currentTitle}return{id:id,error:error}})};saveModal=_react2.default.createElement(_saved_object_save_modal.SavedObjectSaveModal,{onSave:onSave,onClose:function onClose(){},title:savedMap.title,showCopyOnSave:savedMap.id?true:false,objectType:"map"});(0,_show_saved_object_save_modal.showSaveModal)(saveModal);case 3:case"end":return _context4.stop()}}},_callee4,undefined)}));function run(){return _ref6.apply(this,arguments)}return run}()}]})},3374:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GisMap=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3375);var _ui=__webpack_require__(267);var _store_actions=__webpack_require__(216);var _map_selectors=__webpack_require__(192);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var flyoutDisplay=(0,_ui.getFlyoutDisplay)(state);return{layerDetailsVisible:flyoutDisplay===_ui.FLYOUT_STATE.LAYER_PANEL,addLayerVisible:flyoutDisplay===_ui.FLYOUT_STATE.ADD_LAYER_WIZARD,noFlyoutVisible:flyoutDisplay===_ui.FLYOUT_STATE.NONE,isFullScreen:(0,_ui.getIsFullScreen)(state),refreshConfig:(0,_map_selectors.getRefreshConfig)(state)}}function mapDispatchToProps(dispatch){return{triggerRefreshTimer:function triggerRefreshTimer(){return dispatch((0,_store_actions.triggerRefreshTimer)())},exitFullScreen:function exitFullScreen(){return dispatch((0,_ui.exitFullScreen)())}}}var connectedGisMap=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view.GisMap);exports.GisMap=connectedGisMap},3375:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.GisMap=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _mb=__webpack_require__(3376);var _index=__webpack_require__(3379);var _index2=__webpack_require__(3394);var _index3=__webpack_require__(3407);var _eui=__webpack_require__(1);var _exit_full_screen=__webpack_require__(1186);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var GisMap=exports.GisMap=function(_Component){_inherits(GisMap,_Component);function GisMap(){var _ref;var _temp,_this,_ret;_classCallCheck(this,GisMap);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=GisMap.__proto__||Object.getPrototypeOf(GisMap)).call.apply(_ref,[this].concat(args))),_this),_this.setRefreshTimer=function(){var _this$props$refreshCo=_this.props.refreshConfig,isPaused=_this$props$refreshCo.isPaused,interval=_this$props$refreshCo.interval;if(_this.isPaused===isPaused&&_this.interval===interval){return}_this.isPaused=isPaused;_this.interval=interval;_this.clearRefreshTimer();if(!isPaused&&interval>0){_this.refreshTimerId=setInterval(function(){_this.props.triggerRefreshTimer()},interval)}},_this.clearRefreshTimer=function(){if(_this.refreshTimerId){clearInterval(_this.refreshTimerId)}},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(GisMap,[{key:"componentDidMount",value:function componentDidMount(){this.setRefreshTimer()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.setRefreshTimer()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.clearRefreshTimer()}},{key:"render",value:function render(){var _props=this.props,layerDetailsVisible=_props.layerDetailsVisible,addLayerVisible=_props.addLayerVisible,noFlyoutVisible=_props.noFlyoutVisible,isFullScreen=_props.isFullScreen,exitFullScreen=_props.exitFullScreen;var currentPanel=void 0;var currentPanelClassName=void 0;if(noFlyoutVisible){currentPanel=null}else if(addLayerVisible){currentPanelClassName="mapMapLayerPanel-isVisible";currentPanel=_react2.default.createElement(_index3.AddLayerPanel,null)}else if(layerDetailsVisible){currentPanelClassName="mapMapLayerPanel-isVisible";currentPanel=_react2.default.createElement(_index2.LayerPanel,null)}var exitFullScreenButton=void 0;if(isFullScreen){exitFullScreenButton=_react2.default.createElement(_exit_full_screen.ExitFullScreenButton,{onExitFullScreenMode:exitFullScreen})}return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"none",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{className:"mapMapWrapper"},_react2.default.createElement(_mb.MBMapContainer,null),_react2.default.createElement(_index.WidgetOverlay,null)),_react2.default.createElement(_eui.EuiFlexItem,{className:"mapMapLayerPanel "+currentPanelClassName,grow:false},currentPanel),exitFullScreenButton)}}]);return GisMap}(_react.Component)},3376:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MBMapContainer=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3377);var _store_actions=__webpack_require__(216);var _map_selectors=__webpack_require__(192);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{isMapReady:(0,_map_selectors.getMapReady)(state),layerList:(0,_map_selectors.getLayerList)(state),goto:(0,_map_selectors.getGoto)(state)}}function mapDispatchToProps(dispatch){return{extentChanged:function extentChanged(e){dispatch((0,_store_actions.mapExtentChanged)(e))},onMapReady:function onMapReady(e){dispatch((0,_store_actions.clearGoto)());dispatch((0,_store_actions.mapExtentChanged)(e));dispatch((0,_store_actions.mapReady)())},onMapDestroyed:function onMapDestroyed(){dispatch((0,_store_actions.mapDestroyed)())},setMouseCoordinates:function setMouseCoordinates(_ref){var lat=_ref.lat,lon=_ref.lon;dispatch((0,_store_actions.setMouseCoordinates)({lat:lat,lon:lon}))},clearMouseCoordinates:function clearMouseCoordinates(){dispatch((0,_store_actions.clearMouseCoordinates)())},clearGoto:function clearGoto(){dispatch((0,_store_actions.clearGoto)())}}}var connectedMBMapContainer=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps,null,{withRef:true})(_view.MBMapContainer);exports.MBMapContainer=connectedMBMapContainer},3377:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MBMapContainer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _resize_checker=__webpack_require__(520);var _utils=__webpack_require__(3378);var _kibana_services=__webpack_require__(227);var _constants=__webpack_require__(193);var _mapboxGl=__webpack_require__(760);var _mapboxGl2=_interopRequireDefault(_mapboxGl);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MBMapContainer=exports.MBMapContainer=function(_React$Component){_inherits(MBMapContainer,_React$Component);function MBMapContainer(){_classCallCheck(this,MBMapContainer);var _this=_possibleConstructorReturn(this,(MBMapContainer.__proto__||Object.getPrototypeOf(MBMapContainer)).call(this));_this._debouncedSync=_lodash2.default.debounce(function(){if(_this._isMounted){_this._syncMbMapWithLayerList();_this._syncMbMapWithInspector()}},256);_this._syncMbMapWithMapState=function(){var _this$props=_this.props,isMapReady=_this$props.isMapReady,goto=_this$props.goto,clearGoto=_this$props.clearGoto;if(!isMapReady||!goto){return}clearGoto();if(goto.bounds){var lnLatBounds=new _mapboxGl2.default.LngLatBounds(new _mapboxGl2.default.LngLat(clamp(goto.bounds.min_lon,-180,180),clamp(goto.bounds.min_lat,-89,89)),new _mapboxGl2.default.LngLat(clamp(goto.bounds.max_lon,-180,180),clamp(goto.bounds.max_lat,-89,89)));_this._mbMap.fitBounds(lnLatBounds,{maxZoom:17,padding:16})}else if(goto.center){_this._mbMap.setZoom(goto.center.zoom);_this._mbMap.setCenter({lng:goto.center.lon,lat:goto.center.lat})}};_this._syncMbMapWithLayerList=function(){var _this$props2=_this.props,isMapReady=_this$props2.isMapReady,layerList=_this$props2.layerList;if(!isMapReady){return}(0,_utils.removeOrphanedSourcesAndLayers)(_this._mbMap,layerList);layerList.forEach(function(layer){layer.syncLayerWithMB(_this._mbMap)});(0,_utils.syncLayerOrder)(_this._mbMap,layerList)};_this._syncMbMapWithInspector=function(){if(!_this.props.isMapReady||!_kibana_services.inspectorAdapters.map){return}var stats={center:_this._mbMap.getCenter().toArray(),zoom:_this._mbMap.getZoom()};_kibana_services.inspectorAdapters.map.setMapState({stats:stats,style:_this._mbMap.getStyle()})};_this._mbMap=null;_this._listeners=new Map;return _this}_createClass(MBMapContainer,[{key:"_getMapState",value:function _getMapState(){var zoom=this._mbMap.getZoom();var mbCenter=this._mbMap.getCenter();var mbBounds=this._mbMap.getBounds();return{zoom:_lodash2.default.round(zoom,_constants.ZOOM_PRECISION),center:{lon:_lodash2.default.round(mbCenter.lng,_constants.DECIMAL_DEGREES_PRECISION),lat:_lodash2.default.round(mbCenter.lat,_constants.DECIMAL_DEGREES_PRECISION)},extent:{minLon:_lodash2.default.round(mbBounds.getWest(),_constants.DECIMAL_DEGREES_PRECISION),minLat:_lodash2.default.round(mbBounds.getSouth(),_constants.DECIMAL_DEGREES_PRECISION),maxLon:_lodash2.default.round(mbBounds.getEast(),_constants.DECIMAL_DEGREES_PRECISION),maxLat:_lodash2.default.round(mbBounds.getNorth(),_constants.DECIMAL_DEGREES_PRECISION)}}}},{key:"componentDidMount",value:function componentDidMount(){this._initializeMap();this._isMounted=true}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false;if(this._checker){this._checker.destroy()}if(this._mbMap){this._mbMap.remove();this._mbMap=null}this.props.onMapDestroyed()}},{key:"_initializeMap",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this2=this;var originalMbBoxOnFunc,originalMbBoxRemoveLayerFunc,throttledSetMouseCoordinates;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_utils.createMbMapInstance)(this.refs.mapContainer,this.props.goto?this.props.goto.center:null);case 2:this._mbMap=_context.sent;if(this._isMounted){_context.next=5;break}return _context.abrupt("return");case 5:originalMbBoxOnFunc=this._mbMap.on;originalMbBoxRemoveLayerFunc=this._mbMap.removeLayer;this._mbMap.on=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(args.length<=2){originalMbBoxOnFunc.apply(_this2._mbMap,args);return}var eventType=args[0];var mbLayerId=args[1];var handler=args[2];_this2._addListener(eventType,mbLayerId,handler);originalMbBoxOnFunc.apply(_this2._mbMap,args)};this._mbMap.removeLayer=function(id){_this2._removeListeners(id);originalMbBoxRemoveLayerFunc.apply(_this2._mbMap,[id])};this.assignSizeWatch();this._mbMap.on("moveend",_lodash2.default.debounce(function(){_this2.props.extentChanged(_this2._getMapState())},100));throttledSetMouseCoordinates=_lodash2.default.throttle(function(e){_this2.props.setMouseCoordinates({lat:e.lngLat.lat,lon:e.lngLat.lng})},100);this._mbMap.on("mousemove",throttledSetMouseCoordinates);this._mbMap.on("mouseout",function(){throttledSetMouseCoordinates.cancel();_this2.props.clearMouseCoordinates()});this.props.onMapReady(this._getMapState());case 15:case"end":return _context.stop()}}},_callee,this)}));function _initializeMap(){return _ref.apply(this,arguments)}return _initializeMap}()},{key:"_addListener",value:function _addListener(eventType,mbLayerId,handler){this._removeListener(eventType,mbLayerId);var eventHandlers=!this._listeners.has(mbLayerId)?new Map:this._listeners.get(mbLayerId);eventHandlers.set(eventType,handler);this._listeners.set(mbLayerId,eventHandlers)}},{key:"_removeListeners",value:function _removeListeners(mbLayerId){var _this3=this;if(this._listeners.has(mbLayerId)){var eventHandlers=this._listeners.get(mbLayerId);eventHandlers.forEach(function(value,eventType){_this3._removeListener(eventType,mbLayerId)});this._listeners.delete(mbLayerId)}}},{key:"_removeListener",value:function _removeListener(eventType,mbLayerId){if(this._listeners.has(mbLayerId)){var eventHandlers=this._listeners.get(mbLayerId);if(eventHandlers.has(eventType)){this._mbMap.off(eventType,mbLayerId,eventHandlers.get(eventType));eventHandlers.delete(eventType)}}}},{key:"assignSizeWatch",value:function assignSizeWatch(){var _this4=this;this._checker=new _resize_checker.ResizeChecker(this.refs.mapContainer);this._checker.on("resize",function(){var lastWidth=window.innerWidth;var lastHeight=window.innerHeight;return function(){if(lastWidth===window.innerWidth&&lastHeight===window.innerHeight&&_this4._mbMap){_this4._mbMap.resize()}lastWidth=window.innerWidth;lastHeight=window.innerHeight}}())}},{key:"render",value:function render(){this._syncMbMapWithMapState();this._debouncedSync();return _react2.default.createElement("div",{id:"mapContainer",className:"mapContainer",ref:"mapContainer"})}}]);return MBMapContainer}(_react2.default.Component);function clamp(val,min,max){if(val>max)val=max;else if(val<min)val=min;return val}},3378:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createMbMapInstance=undefined;var createMbMapInstance=exports.createMbMapInstance=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(node,initialView){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",new Promise(function(resolve){var options={attributionControl:false,container:node,style:{version:8,sources:{},layers:[]}};if(initialView){options.zoom=initialView.zoom;options.center={lng:initialView.lon,lat:initialView.lat}}var mbMap=new _mapboxGl2.default.Map(options);mbMap.dragRotate.disable();mbMap.touchZoomRotate.disableRotation();mbMap.addControl(new _mapboxGl2.default.NavigationControl({showCompass:false}),"top-left");mbMap.on("load",function(){resolve(mbMap)})}));case 1:case"end":return _context.stop()}}},_callee,this)}));return function createMbMapInstance(_x,_x2){return _ref.apply(this,arguments)}}();exports.removeOrphanedSourcesAndLayers=removeOrphanedSourcesAndLayers;exports.syncLayerOrder=syncLayerOrder;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _mapboxGl=__webpack_require__(760);var _mapboxGl2=_interopRequireDefault(_mapboxGl);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function removeOrphanedSourcesAndLayers(mbMap,layerList){var layerIds=layerList.map(function(layer){return layer.getId()});var mbStyle=mbMap.getStyle();var mbSourcesToRemove=[];for(var sourceId in mbStyle.sources){if(layerIds.indexOf(sourceId)===-1){mbSourcesToRemove.push(sourceId)}}var mbLayersToRemove=[];mbStyle.layers.forEach(function(layer){if(mbSourcesToRemove.indexOf(layer.source)>=0){mbLayersToRemove.push(layer.id)}});mbLayersToRemove.forEach(function(layerId){mbMap.removeLayer(layerId)});mbSourcesToRemove.forEach(function(sourceId){mbMap.removeSource(sourceId)})}function syncLayerOrder(mbMap,layerList){if(layerList&&layerList.length){var mbLayers=mbMap.getStyle().layers.slice();var currentLayerOrder=_lodash2.default.uniq(mbLayers.map(function(_ref2){var id=_ref2.id;return id.substring(0,id.lastIndexOf("_"))}));var newLayerOrder=layerList.map(function(l){return l.getId()}).filter(function(layerId){return currentLayerOrder.includes(layerId)});var netPos=0;var netNeg=0;var movementArr=currentLayerOrder.reduce(function(accu,id,idx){var movement=newLayerOrder.findIndex(function(newOId){return newOId===id})-idx;movement>0?netPos++:movement<0&&netNeg++;accu.push({id:id,movement:movement});return accu},[]);if(netPos===0&&netNeg===0){return}var movedLayer=netPos>=netNeg&&movementArr.find(function(l){return l.movement<0}).id||netPos<netNeg&&movementArr.find(function(l){return l.movement>0}).id;var nextLayerIdx=newLayerOrder.findIndex(function(layerId){return layerId===movedLayer})+1;var nextLayerId=nextLayerIdx===newLayerOrder.length?null:mbLayers.find(function(_ref3){var id=_ref3.id;return id.startsWith(newLayerOrder[nextLayerIdx])}).id;mbLayers.forEach(function(_ref4){var id=_ref4.id;if(id.startsWith(movedLayer)){mbMap.moveLayer(id,nextLayerId)}})}}},3379:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WidgetOverlay=undefined;var _reactRedux=__webpack_require__(14);var _widget_overlay=__webpack_require__(3380);var connectedWidgetOverlay=(0,_reactRedux.connect)(null,null)(_widget_overlay.WidgetOverlay);exports.WidgetOverlay=connectedWidgetOverlay},3380:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WidgetOverlay=WidgetOverlay;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _layer_control=__webpack_require__(3381);var _view_control=__webpack_require__(3388);var _attribution_control=__webpack_require__(3392);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function WidgetOverlay(){return _react2.default.createElement(_eui.EuiFlexGroup,{className:"mapWidgetOverlay",responsive:false,direction:"column",alignItems:"flexEnd",gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFlexGroup,{className:"mapWidgetOverlay__rightSide",direction:"column",justifyContent:"spaceBetween",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_layer_control.LayerControl,null)),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_view_control.ViewControl,null)))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_attribution_control.AttributionControl,null)))}},3381:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerControl=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3382);var _ui=__webpack_require__(267);function mapDispatchToProps(dispatch){return{showAddLayerWizard:function showAddLayerWizard(){dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.ADD_LAYER_WIZARD))}}}var connectedLayerControl=(0,_reactRedux.connect)(null,mapDispatchToProps)(_view.LayerControl);exports.LayerControl=connectedLayerControl},3382:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerControl=LayerControl;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _layer_toc=__webpack_require__(3383);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function LayerControl(_ref){var showAddLayerWizard=_ref.showAddLayerWizard;var addLayer=_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{size:"xs",flush:"right",onClick:showAddLayerWizard,"data-test-subj":"addLayerButton"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerControl.addLayerButtonLabel",defaultMessage:"Add layer"})));return _react2.default.createElement(_eui.EuiPanel,{className:"mapWidgetControl mapWidgetControl-hasShadow",paddingSize:"none",grow:false},_react2.default.createElement(_eui.EuiFlexItem,{className:"mapWidgetControl__header",grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",responsive:false,gutterSize:"none"},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h2",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerControl.layersTitle",defaultMessage:"Layers"})))),addLayer)),_react2.default.createElement(_eui.EuiFlexItem,{className:"mapLayerControl"},_react2.default.createElement(_layer_toc.LayerTOC,null)))}},3383:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerTOC=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3384);var _store_actions=__webpack_require__(216);var _map_selectors=__webpack_require__(192);var mapDispatchToProps={updateLayerOrder:function updateLayerOrder(newOrder){return(0,_store_actions.updateLayerOrder)(newOrder)}};function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{layerList:(0,_map_selectors.getLayerList)(state)}}var connectedLayerTOC=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps,null,{withRef:true})(_view.LayerTOC);exports.LayerTOC=connectedLayerTOC},3384:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerTOC=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _toc_entry=__webpack_require__(3385);var _jquery=__webpack_require__(17);var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LayerTOC=exports.LayerTOC=function(_React$Component){_inherits(LayerTOC,_React$Component);function LayerTOC(props){_classCallCheck(this,LayerTOC);var _this=_possibleConstructorReturn(this,(LayerTOC.__proto__||Object.getPrototypeOf(LayerTOC)).call(this,props));_this._domContainer=null;return _this}_createClass(LayerTOC,[{key:"componentDidMount",value:function componentDidMount(){this._attachSortHandler()}},{key:"_attachSortHandler",value:function _attachSortHandler(){var _this2=this;var tocEntries=this._domContainer;var length=void 0;(0,_jquery2.default)(tocEntries).sortable({start:function start(evt,_ref){var item=_ref.item;length=tocEntries.children.length;(0,_jquery2.default)(_this2).attr("data-previndex",length-item.index()-2)},update:function update(evt,_ref2){var item=_ref2.item;var prevIndex=+(0,_jquery2.default)(_this2).attr("data-previndex");length=tocEntries.children.length;var newIndex=length-item.index()-1;var newOrder=Array.from(tocEntries.children).map(function(el,idx){return idx});newOrder.splice(prevIndex,1);newOrder.splice(newIndex,0,prevIndex);_this2.props.updateLayerOrder(newOrder)}})}},{key:"_renderLayers",value:function _renderLayers(){return this.props.layerList.map(function(layer){return _react2.default.createElement(_toc_entry.TOCEntry,{key:layer.getId(),layer:layer})}).reverse()}},{key:"render",value:function render(){var _this3=this;var layerEntries=this._renderLayers();return _react2.default.createElement("div",{ref:function ref(node){return _this3._domContainer=node},"data-test-subj":"mapLayerTOC"},layerEntries)}}]);return LayerTOC}(_react2.default.Component)},3385:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TOCEntry=undefined;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3386);var _ui=__webpack_require__(267);var _store_actions=__webpack_require__(216);var _map_selectors=__webpack_require__(192);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{zoom:_lodash2.default.get(state,"map.mapState.zoom",0),getSelectedLayerSelector:function getSelectedLayerSelector(){return(0,_map_selectors.getSelectedLayer)(state)},hasDirtyStateSelector:function hasDirtyStateSelector(){return(0,_map_selectors.hasDirtyState)(state)}}}function mapDispatchToProps(dispatch){var _this=this;return{openLayerPanel:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(layerId){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dispatch((0,_store_actions.removeTransientLayer)());case 2:_context.next=4;return dispatch((0,_store_actions.setSelectedLayer)(layerId));case 4:dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.LAYER_PANEL));case 5:case"end":return _context.stop()}}},_callee,_this)}));function openLayerPanel(_x2){return _ref.apply(this,arguments)}return openLayerPanel}(),toggleVisible:function toggleVisible(layerId){dispatch((0,_store_actions.toggleLayerVisible)(layerId))},fitToBounds:function fitToBounds(layerId){dispatch((0,_store_actions.fitToLayerExtent)(layerId))}}}var connectedTOCEntry=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view.TOCEntry);exports.TOCEntry=connectedTOCEntry},3386:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TOCEntry=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _layer_toc_actions=__webpack_require__(3387);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TOCEntry=exports.TOCEntry=function(_React$Component){_inherits(TOCEntry,_React$Component);function TOCEntry(){var _ref;var _temp,_this,_ret;_classCallCheck(this,TOCEntry);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=TOCEntry.__proto__||Object.getPrototypeOf(TOCEntry)).call.apply(_ref,[this].concat(args))),_this),_this.state={displayName:null,shouldShowModal:false},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(TOCEntry,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._updateDisplayName()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"_updateDisplayName",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var label;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.props.layer.getDisplayName();case 2:label=_context.sent;if(this._isMounted){if(label!==this.state.displayName){this.setState({displayName:label})}}case 4:case"end":return _context.stop()}}},_callee,this)}));function _updateDisplayName(){return _ref2.apply(this,arguments)}return _updateDisplayName}()},{key:"componentDidUpdate",value:function componentDidUpdate(){this._updateDisplayName()}},{key:"_renderCancelModal",value:function _renderCancelModal(){var _this2=this;if(!this.state.shouldShowModal){return null}var closeModal=function closeModal(){_this2.setState({shouldShowModal:false})};var openPanel=function openPanel(){closeModal();_this2.props.openLayerPanel(_this2.props.layer.getId())};return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:closeModal},_react2.default.createElement(_eui.EuiModalBody,null,"There are unsaved changes to your layer. Are you sure you want to proceed?"),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:closeModal},"Do not proceed"),_react2.default.createElement(_eui.EuiButton,{onClick:openPanel,fill:true},"Proceed and discard changes"))))}},{key:"render",value:function render(){var _this3=this;var _props=this.props,layer=_props.layer,openLayerPanel=_props.openLayerPanel,zoom=_props.zoom,_toggleVisible=_props.toggleVisible,_fitToBounds=_props.fitToBounds;var legendIcon=_react2.default.createElement(_layer_toc_actions.LayerTocActions,{layer:layer,fitToBounds:function fitToBounds(){_fitToBounds(layer.getId())},zoom:zoom,toggleVisible:function toggleVisible(){_toggleVisible(layer.getId())},displayName:this.state.displayName});var tocDetails=layer.getTOCDetails();if(tocDetails){tocDetails=_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),tocDetails)}var cancelModal=this._renderCancelModal();var openLayerPanelWithCheck=function openLayerPanelWithCheck(){var selectedLayer=_this3.props.getSelectedLayerSelector();if(selectedLayer&&selectedLayer.getId()===_this3.props.layer.getId()){return}if(_this3.props.hasDirtyStateSelector()){_this3.setState({shouldShowModal:true})}else{openLayerPanel(layer.getId())}};return _react2.default.createElement("div",{className:"mapTocEntry",id:layer.getId(),"data-layerid":layer.getId()},cancelModal,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"none",alignItems:"center",responsive:false,className:layer.isVisible()&&layer.showAtZoomLevel(zoom)&&!layer.hasErrors()?"mapTocEntry-visible":"mapTocEntry-notVisible"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},legendIcon),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement("button",{onClick:openLayerPanelWithCheck,"data-test-subj":"mapOpenLayerButton"+(this.state.displayName?this.state.displayName.replace(" ","_"):"")},_react2.default.createElement("div",{style:{width:180},className:"eui-textTruncate eui-textLeft"},this.state.displayName))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement("span",{className:"mapTocEntry__grab"},_react2.default.createElement(_eui.EuiIcon,{type:"grab"})))),tocDetails)}}]);return TOCEntry}(_react2.default.Component)},3387:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerTocActions=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function flattenPanelTree(tree){var array=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];array.push(tree);if(tree.items){tree.items.forEach(function(item){if(item.panel){flattenPanelTree(item.panel,array);item.panel=item.panel.id}})}return array}function cleanDisplayName(displayName){if(!displayName){return displayName}return displayName.split(" ").join("")}var LayerTocActions=exports.LayerTocActions=function(_Component){_inherits(LayerTocActions,_Component);function LayerTocActions(){var _ref;var _temp,_this,_ret;_classCallCheck(this,LayerTocActions);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=LayerTocActions.__proto__||Object.getPrototypeOf(LayerTocActions)).call.apply(_ref,[this].concat(args))),_this),_this.state={isPopoverOpen:false,supportsFitToBounds:false},_this._onClick=function(){_this.setState(function(prevState){return{isPopoverOpen:!prevState.isPopoverOpen}})},_this._closePopover=function(){_this.setState(function(){return{isPopoverOpen:false}})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(LayerTocActions,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadSupportsFitToBounds()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"_loadSupportsFitToBounds",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var supportsFitToBounds;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.props.layer.supportsFitToBounds();case 2:supportsFitToBounds=_context.sent;if(this._isMounted){this.setState({supportsFitToBounds:supportsFitToBounds})}case 4:case"end":return _context.stop()}}},_callee,this)}));function _loadSupportsFitToBounds(){return _ref2.apply(this,arguments)}return _loadSupportsFitToBounds}()},{key:"_renderButton",value:function _renderButton(){var icon=this._renderIcon();return _react2.default.createElement(_eui.EuiButtonEmpty,{size:"xs",flush:"left",color:"text",onClick:this._onClick,"data-test-subj":"layerTocActionsPanelToggleButton"+cleanDisplayName(this.props.displayName)},icon)}},{key:"_getVisbilityIcon",value:function _getVisbilityIcon(){var iconType=this.props.layer.isVisible()?"eye":"eyeClosed";return _react2.default.createElement(_eui.EuiIcon,{type:iconType,size:"m"})}},{key:"_renderIcon",value:function _renderIcon(){var _props=this.props,zoom=_props.zoom,layer=_props.layer;var smallLegendIcon=void 0;if(layer.hasErrors()){smallLegendIcon=_react2.default.createElement(_eui.EuiIconTip,{"aria-label":_i18n.i18n.translate("xpack.maps.layerTocActions.loadWarningAriaLabel",{defaultMessage:"Load warning"}),size:"m",type:"alert",color:"warning",content:layer.getErrors()})}else if(layer.isLayerLoading()){smallLegendIcon=_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"m"})}else if(!layer.showAtZoomLevel(zoom)){var _layer$getZoomConfig=layer.getZoomConfig(),minZoom=_layer$getZoomConfig.minZoom,maxZoom=_layer$getZoomConfig.maxZoom;var icon=layer.getIcon();smallLegendIcon=_react2.default.createElement(_eui.EuiToolTip,{position:"top",content:_i18n.i18n.translate("xpack.maps.layerTocActions.zoomFeedbackTooltip",{defaultMessage:"Map is at zoom level {zoom}.\n          This layer is only visible between zoom levels {minZoom} to {maxZoom}.",values:{minZoom:minZoom,maxZoom:maxZoom,zoom:zoom}})},icon)}else{smallLegendIcon=layer.getIcon()}return smallLegendIcon}},{key:"_getPanels",value:function _getPanels(){var _this2=this;var visibilityToggle=this._getVisbilityIcon();var panelTree={id:0,title:_i18n.i18n.translate("xpack.maps.layerTocActions.layerActionsTitle",{defaultMessage:"Layer actions"}),items:[{name:_i18n.i18n.translate("xpack.maps.layerTocActions.fitToDataTitle",{defaultMessage:"Fit to data"}),icon:_react2.default.createElement(_eui.EuiIcon,{type:"search",size:"m"}),"data-test-subj":"fitToBoundsButton",toolTipContent:this.state.supportsFitToBounds?null:_i18n.i18n.translate("xpack.maps.layerTocActions.noFitSupportTooltip",{defaultMessage:"Layer does not support fit to data"}),disabled:!this.state.supportsFitToBounds,onClick:function onClick(){_this2._closePopover();_this2.props.fitToBounds()}},{name:this.props.layer.isVisible()?_i18n.i18n.translate("xpack.maps.layerTocActions.hideLayerTitle",{defaultMessage:"Hide layer"}):_i18n.i18n.translate("xpack.maps.layerTocActions.showLayerTitle",{defaultMessage:"Show layer"}),icon:visibilityToggle,"data-test-subj":"layerVisibilityToggleButton",onClick:function onClick(){_this2._closePopover();_this2.props.toggleVisible()}}]};return flattenPanelTree(panelTree)}},{key:"render",value:function render(){return _react2.default.createElement(_eui.EuiPopover,{id:"contextMenu",button:this._renderButton(),isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,panelPaddingSize:"none",withTitle:true,anchorPosition:"leftUp"},_react2.default.createElement(_eui.EuiContextMenu,{initialPanelId:0,panels:this._getPanels(),"data-test-subj":"layerTocActionsPanel"+cleanDisplayName(this.props.displayName)}))}}]);return LayerTocActions}(_react.Component)},3388:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ViewControl=undefined;var _reactRedux=__webpack_require__(14);var _view_control=__webpack_require__(3389);var _map_selectors=__webpack_require__(192);var _ui=__webpack_require__(267);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{isSetViewOpen:(0,_ui.getIsSetViewOpen)(state),mouseCoordinates:(0,_map_selectors.getMouseCoordinates)(state)}}function mapDispatchToProps(dispatch){return{closeSetView:function closeSetView(){dispatch((0,_ui.closeSetView)())},openSetView:function openSetView(){dispatch((0,_ui.openSetView)())}}}var connectedViewControl=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view_control.ViewControl);exports.ViewControl=connectedViewControl},3389:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ViewControl=ViewControl;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _set_view=__webpack_require__(3390);var _constants=__webpack_require__(193);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ViewControl(_ref){var isSetViewOpen=_ref.isSetViewOpen,closeSetView=_ref.closeSetView,openSetView=_ref.openSetView,mouseCoordinates=_ref.mouseCoordinates;var toggleSetViewVisibility=function toggleSetViewVisibility(){if(isSetViewOpen){closeSetView();return}openSetView()};var setView=_react2.default.createElement(_eui.EuiPopover,{anchorPosition:"upRight",button:_react2.default.createElement(_eui.EuiButton,{className:"mapViewControl__gotoButton",fill:true,size:"s",onClick:toggleSetViewVisibility,"data-test-subj":"toggleSetViewVisibilityButton"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.viewControl.goToButtonLabel",defaultMessage:"Go to"})),isOpen:isSetViewOpen,closePopover:closeSetView},_react2.default.createElement(_set_view.SetView,null));function renderMouseCoordinates(){var lat=mouseCoordinates?_lodash2.default.round(mouseCoordinates.lat,_constants.DECIMAL_DEGREES_PRECISION):"";var lon=mouseCoordinates?_lodash2.default.round(mouseCoordinates.lon,_constants.DECIMAL_DEGREES_PRECISION):"";return _react2.default.createElement(_eui.EuiPanel,{className:"mapWidgetControl mapViewControl__coordinates",paddingSize:"none"},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("p",null,_react2.default.createElement("strong",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.viewControl.latLabel",defaultMessage:"lat:"}))," ",lat,","," ",_react2.default.createElement("strong",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.viewControl.lonLabel",defaultMessage:"lon:"}))," ",lon)))}return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,null,mouseCoordinates&&renderMouseCoordinates()),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},setView))}},3390:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SetView=undefined;var _reactRedux=__webpack_require__(14);var _set_view=__webpack_require__(3391);var _store_actions=__webpack_require__(216);var _map_selectors=__webpack_require__(192);var _ui=__webpack_require__(267);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{zoom:(0,_map_selectors.getMapZoom)(state),center:(0,_map_selectors.getMapCenter)(state)}}function mapDispatchToProps(dispatch){return{onSubmit:function onSubmit(_ref){var lat=_ref.lat,lon=_ref.lon,zoom=_ref.zoom;dispatch((0,_ui.closeSetView)());dispatch((0,_store_actions.setGotoWithCenter)({lat:lat,lon:lon,zoom:zoom}))}}}var connectedSetView=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps,null,{withRef:true})(_set_view.SetView);exports.SetView=connectedSetView},3391:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SetView=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SetView=exports.SetView=function(_React$Component){_inherits(SetView,_React$Component);function SetView(){var _ref;var _temp,_this,_ret;_classCallCheck(this,SetView);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=SetView.__proto__||Object.getPrototypeOf(SetView)).call.apply(_ref,[this].concat(args))),_this),_this.state={lat:_this.props.center.lat,lon:_this.props.center.lon,zoom:_this.props.zoom},_this._onLatChange=function(evt){_this._onChange("lat",evt)},_this._onLonChange=function(evt){_this._onChange("lon",evt)},_this._onZoomChange=function(evt){_this._onChange("zoom",evt)},_this._onChange=function(name,evt){var sanitizedValue=parseFloat(evt.target.value);_this.setState(_defineProperty({},name,isNaN(sanitizedValue)?"":sanitizedValue))},_this._renderNumberFormRow=function(_ref2){var value=_ref2.value,min=_ref2.min,max=_ref2.max,onChange=_ref2.onChange,label=_ref2.label,dataTestSubj=_ref2.dataTestSubj;var isInvalid=value===""||value>max||value<min;var error=isInvalid?"Must be between "+min+" and "+max:null;return{isInvalid:isInvalid,component:_react2.default.createElement(_eui.EuiFormRow,{label:label,isInvalid:isInvalid,error:error,compressed:true},_react2.default.createElement(_eui.EuiFieldNumber,{value:value,onChange:onChange,isInvalid:isInvalid,"data-test-subj":dataTestSubj}))}},_this.onSubmit=function(){var _this$state=_this.state,lat=_this$state.lat,lon=_this$state.lon,zoom=_this$state.zoom;_this.props.onSubmit({lat:lat,lon:lon,zoom:zoom})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(SetView,[{key:"render",value:function render(){var _renderNumberFormRow=this._renderNumberFormRow({value:this.state.lat,min:-90,max:90,onChange:this._onLatChange,label:"Latitude",dataTestSubj:"latitudeInput"}),isLatInvalid=_renderNumberFormRow.isInvalid,latFormRow=_renderNumberFormRow.component;var _renderNumberFormRow2=this._renderNumberFormRow({value:this.state.lon,min:-180,max:180,onChange:this._onLonChange,label:"Longitude",dataTestSubj:"longitudeInput"}),isLonInvalid=_renderNumberFormRow2.isInvalid,lonFormRow=_renderNumberFormRow2.component;var _renderNumberFormRow3=this._renderNumberFormRow({value:this.state.zoom,min:0,max:24,onChange:this._onZoomChange,label:"Zoom",dataTestSubj:"zoomInput"}),isZoomInvalid=_renderNumberFormRow3.isInvalid,zoomFormRow=_renderNumberFormRow3.component;return _react2.default.createElement(_eui.EuiForm,null,latFormRow,lonFormRow,zoomFormRow,_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react2.default.createElement(_eui.EuiButton,{size:"s",disabled:isLatInvalid||isLonInvalid||isZoomInvalid,onClick:this.onSubmit,"data-test-subj":"submitViewButton"},"Go")))}}]);return SetView}(_react2.default.Component);SetView.propTypes={zoom:_propTypes2.default.number.isRequired,center:_propTypes2.default.shape({lat:_propTypes2.default.number.isRequired,lon:_propTypes2.default.number.isRequired}),onSubmit:_propTypes2.default.func.isRequired}},3392:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AttributionControl=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3393);var _map_selectors=__webpack_require__(192);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{layerList:(0,_map_selectors.getLayerList)(state)}}function mapDispatchToProps(){return{}}var connectedViewControl=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view.AttributionControl);exports.AttributionControl=connectedViewControl},3393:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AttributionControl=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AttributionControl=exports.AttributionControl=function(_React$Component){_inherits(AttributionControl,_React$Component);function AttributionControl(){var _this2=this;_classCallCheck(this,AttributionControl);var _this=_possibleConstructorReturn(this,(AttributionControl.__proto__||Object.getPrototypeOf(AttributionControl)).call(this));_this._loadAttributions=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var attributionPromises,attributions,uniqueAttributions,i,_loop,j;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:attributionPromises=_this.props.layerList.map(function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(layer){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return layer.getAttributions();case 3:return _context.abrupt("return",_context.sent);case 6:_context.prev=6;_context.t0=_context["catch"](0);return _context.abrupt("return",[]);case 9:case"end":return _context.stop()}}},_callee,_this2,[[0,6]])}));return function(_x){return _ref2.apply(this,arguments)}}());_context2.next=3;return Promise.all(attributionPromises);case 3:attributions=_context2.sent;if(_this._isMounted){_context2.next=6;break}return _context2.abrupt("return");case 6:uniqueAttributions=[];for(i=0;i<attributions.length;i++){_loop=function _loop(j){var testAttr=attributions[i][j];var attr=uniqueAttributions.find(function(added){return added.url===testAttr.url&&added.label===testAttr.label});if(!attr){uniqueAttributions.push(testAttr)}};for(j=0;j<attributions[i].length;j++){_loop(j)}}if(!_lodash2.default.isEqual(_this.state.uniqueAttributions,uniqueAttributions)){_this.setState({uniqueAttributions:uniqueAttributions})}case 9:case"end":return _context2.stop()}}},_callee2,_this2)}));_this.state={uniqueAttributions:[]};return _this}_createClass(AttributionControl,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadAttributions()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidUpdate",value:function componentDidUpdate(){this._loadAttributions()}},{key:"_renderAttribution",value:function _renderAttribution(_ref3){var url=_ref3.url,label=_ref3.label;if(!url){return label}return _react2.default.createElement(_eui.EuiLink,{color:"subdued",href:url,target:"_blank"},label)}},{key:"_renderAttributions",value:function _renderAttributions(){var _this3=this;return this.state.uniqueAttributions.map(function(attribution,index){return _react2.default.createElement(_react.Fragment,{key:index},_this3._renderAttribution(attribution),index<_this3.state.uniqueAttributions.length-1&&", ")})}},{key:"render",value:function render(){if(this.state.uniqueAttributions.length===0){return null}return _react2.default.createElement(_eui.EuiPanel,{className:"mapWidgetControl mapAttributionControl",paddingSize:"none",grow:false},_react2.default.createElement(_eui.EuiText,{color:"subdued",size:"xs"},_react2.default.createElement("small",null,this._renderAttributions())))}}]);return AttributionControl}(_react2.default.Component)},3394:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerPanel=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3395);var _map_selectors=__webpack_require__(192);var _store_actions=__webpack_require__(216);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var selectedLayer=(0,_map_selectors.getSelectedLayer)(state);return{selectedLayer:selectedLayer,hasStateChanged:(0,_map_selectors.hasDirtyState)(state)}}function mapDispatchToProps(dispatch){return{fitToBounds:function fitToBounds(layerId){dispatch((0,_store_actions.fitToLayerExtent)(layerId))}}}var connectedLayerPanel=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view.LayerPanel);exports.LayerPanel=connectedLayerPanel},3395:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LayerPanel=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _style_tabs=__webpack_require__(3396);var _join_editor=__webpack_require__(3398);var _flyout_footer=__webpack_require__(3403);var _settings_panel=__webpack_require__(3405);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LayerPanel=exports.LayerPanel=function(_React$Component){_inherits(LayerPanel,_React$Component);function LayerPanel(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,LayerPanel);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=LayerPanel.__proto__||Object.getPrototypeOf(LayerPanel)).call.apply(_ref,[this].concat(args))),_this),_this.state={},_this.loadDisplayName=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var displayName;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(_this.props.selectedLayer){_context.next=2;break}return _context.abrupt("return");case 2:_context.next=4;return _this.props.selectedLayer.getDisplayName();case 4:displayName=_context.sent;if(!(!_this._isMounted||displayName===_this.state.displayName)){_context.next=7;break}return _context.abrupt("return");case 7:_this.setState({displayName:displayName});case 8:case"end":return _context.stop()}}},_callee,_this2)})),_this.loadImmutableSourceProperties=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var immutableSourceProps;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(_this.state.hasLoadedSourcePropsForLayer||!_this.props.selectedLayer)){_context2.next=2;break}return _context2.abrupt("return");case 2:_context2.next=4;return _this.props.selectedLayer.getImmutableSourceProperties();case 4:immutableSourceProps=_context2.sent;if(_this._isMounted){_this.setState({immutableSourceProps:immutableSourceProps,hasLoadedSourcePropsForLayer:true})}case 6:case"end":return _context2.stop()}}},_callee2,_this2)})),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(LayerPanel,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this.loadDisplayName();this.loadImmutableSourceProperties()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.loadDisplayName();this.loadImmutableSourceProperties()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"_renderJoinSection",value:function _renderJoinSection(){if(!this.props.selectedLayer.isJoinable()){return null}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiPanel,null,_react2.default.createElement(_join_editor.JoinEditor,null)),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}))}},{key:"_renderSourceProperties",value:function _renderSourceProperties(){return this.state.immutableSourceProps.map(function(_ref4){var label=_ref4.label,value=_ref4.value,link=_ref4.link;function renderValue(){if(link){return _react2.default.createElement(_eui.EuiLink,{href:link,target:"_blank"},value)}return _react2.default.createElement("span",null,value)}return _react2.default.createElement("p",{key:label,className:"mapLayerPanel__sourceDetail"},_react2.default.createElement("strong",null,label)," ",renderValue())})}},{key:"render",value:function render(){var selectedLayer=this.props.selectedLayer;if(!selectedLayer){return null}return _react2.default.createElement(_eui.EuiFlexGroup,{direction:"column",gutterSize:"none"},_react2.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true,className:"mapLayerPanel__header"},_react2.default.createElement(_eui.EuiFlexGroup,{responsive:false,alignItems:"center",gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonIcon,{"aria-label":_i18n.i18n.translate("xpack.maps.layerPanel.fitToBoundsAriaLabel",{defaultMessage:"Fit to bounds"}),iconType:selectedLayer.getLayerTypeIconName(),onClick:this.props.fitToBounds},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.fitToBoundsButtonLabel",defaultMessage:"Fit"}))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTitle,{size:"s"},_react2.default.createElement("h2",null,this.state.displayName)))),_react2.default.createElement(_eui.EuiSpacer,{size:"xs"}),_react2.default.createElement("div",{className:"mapLayerPanel__sourceDetails"},_react2.default.createElement(_eui.EuiAccordion,{id:"accordion1",buttonContent:_i18n.i18n.translate("xpack.maps.layerPanel.sourceDetailsLabel",{defaultMessage:"Source details"})},_react2.default.createElement(_eui.EuiText,{color:"subdued",size:"s"},_react2.default.createElement(_eui.EuiSpacer,{size:"xs"}),this._renderSourceProperties())))),_react2.default.createElement(_eui.EuiFlyoutBody,{className:"mapLayerPanel__body"},_react2.default.createElement(_settings_panel.SettingsPanel,null),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),this._renderJoinSection(),_react2.default.createElement(_style_tabs.StyleTabs,{layer:selectedLayer})),_react2.default.createElement(_eui.EuiFlyoutFooter,{className:"mapLayerPanel__footer"},_react2.default.createElement(_flyout_footer.FlyoutFooter,{hasStateChanged:this.props.hasStateChanged})))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){var nextId=nextProps.selectedLayer?nextProps.selectedLayer.getId():null;if(nextId!==prevState.prevId){return{displayName:"",immutableSourceProps:[],hasLoadedSourcePropsForLayer:false,prevId:nextId}}return null}}]);return LayerPanel}(_react2.default.Component)},3396:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StyleTabs=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3397);var _store_actions=__webpack_require__(216);function _objectDestructuringEmpty(obj){if(obj==null)throw new TypeError("Cannot destructure undefined")}function mapDispatchToProps(dispatch){return{updateStyle:function updateStyle(styleDescriptor){dispatch((0,_store_actions.updateLayerStyleForSelectedLayer)(styleDescriptor))}}}function mapStateToProps(_ref,props){_objectDestructuringEmpty(_ref);return{layer:props.layer}}var connectedFlyoutBody=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view.StyleTabs);exports.StyleTabs=connectedFlyoutBody},3397:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StyleTabs=StyleTabs;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function StyleTabs(_ref){var layer=_ref.layer,updateStyle=_ref.updateStyle;return layer.getSupportedStyles().map(function(Style,index){var description=void 0;if(Style.description){description=_react2.default.createElement(_eui.EuiText,{size:"s"},_react2.default.createElement("p",null,Style.description))}var currentStyle=layer.getCurrentStyle();var styleEditor=layer.renderStyleEditor(Style,{handleStyleChange:function handleStyleChange(styleDescriptor){updateStyle(styleDescriptor)},style:Style.canEdit(currentStyle)?currentStyle:null});if(!styleEditor){return null}return _react2.default.createElement(_eui.EuiPanel,{key:index},_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h5",null,Style.getDisplayName())),description,_react2.default.createElement(_eui.EuiSpacer,{margin:"m"}),styleEditor)})}},3398:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JoinEditor=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3399);var _map_selectors=__webpack_require__(192);var _store_actions=__webpack_require__(216);function mapDispatchToProps(dispatch){return{onChange:function onChange(layer,joins){dispatch((0,_store_actions.setJoinsForLayer)(layer,joins))}}}function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{joins:(0,_map_selectors.getSelectedLayerJoinDescriptors)(state),layer:(0,_map_selectors.getSelectedLayer)(state)}}var connectedJoinEditor=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_view.JoinEditor);exports.JoinEditor=connectedJoinEditor},3399:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JoinEditor=JoinEditor;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _v=__webpack_require__(330);var _v2=_interopRequireDefault(_v);var _eui=__webpack_require__(1);var _join=__webpack_require__(3400);var _react3=__webpack_require__(3);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function JoinEditor(_ref){var joins=_ref.joins,layer=_ref.layer,onChange=_ref.onChange;var renderJoins=function renderJoins(){return joins.map(function(joinDescriptor,index){var handleOnChange=function handleOnChange(updatedDescriptor){onChange(layer,[].concat(_toConsumableArray(joins.slice(0,index)),[updatedDescriptor],_toConsumableArray(joins.slice(index+1))))};var handleOnRemove=function handleOnRemove(){onChange(layer,[].concat(_toConsumableArray(joins.slice(0,index)),_toConsumableArray(joins.slice(index+1))))};return _react2.default.createElement(_react.Fragment,{key:index},_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_join.Join,{join:joinDescriptor,layer:layer,onChange:handleOnChange,onRemove:handleOnRemove}))})};var addJoin=function addJoin(){onChange(layer,[].concat(_toConsumableArray(joins),[{right:{id:(0,_v2.default)()}}]))};if(!layer.isJoinable()){return null}return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiFlexGroup,{responsive:false},_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h5",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.joinEditor.termJoinsTitle",defaultMessage:"Term joins"})))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonIcon,{iconType:"plusInCircle",onClick:addJoin,"aria-label":_i18n.i18n.translate("xpack.maps.layerPanel.joinEditor.addJoinAriaLabel",{defaultMessage:"Add join"}),title:_i18n.i18n.translate("xpack.maps.layerPanel.joinEditor.addJoinButtonLabel",{defaultMessage:"Add join"})}))),renderJoins())}},3400:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Join=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);var _join_expression=__webpack_require__(3401);var _metrics_expression=__webpack_require__(3402);var _kibana_services=__webpack_require__(227);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var getIndexPatternId=function getIndexPatternId(props){return _lodash2.default.get(props,"join.right.indexPatternId")};var Join=exports.Join=function(_Component){_inherits(Join,_Component);function Join(){var _ref;var _temp,_this,_ret;_classCallCheck(this,Join);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=Join.__proto__||Object.getPrototypeOf(Join)).call.apply(_ref,[this].concat(args))),_this),_this.state={leftFields:null,leftSourceName:"",rightFields:undefined,loadError:undefined,prevIndexPatternId:getIndexPatternId(_this.props)},_this._onLeftFieldChange=function(leftField){_this.props.onChange({leftField:leftField,right:_this.props.join.right})},_this._onRightSourceChange=function(_ref2){var indexPatternId=_ref2.indexPatternId,indexPatternTitle=_ref2.indexPatternTitle;_this.props.onChange({leftField:_this.props.join.leftField,right:{id:_this.props.join.right.id,indexPatternId:indexPatternId,indexPatternTitle:indexPatternTitle}})},_this._onRightFieldChange=function(term){_this.props.onChange({leftField:_this.props.join.leftField,right:_extends({},_this.props.join.right,{term:term})})},_this._onMetricsChange=function(metrics){_this.props.onChange({leftField:_this.props.join.leftField,right:_extends({},_this.props.join.right,{metrics:metrics})})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(Join,[{key:"componentDidMount",value:function componentDidMount(){this._isMounted=true;this._loadLeftFields();this._loadLeftSourceName()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false}},{key:"componentDidUpdate",value:function componentDidUpdate(){if(!this.state.rightFields&&getIndexPatternId(this.props)&&!this.state.loadError){this._loadRightFields(getIndexPatternId(this.props))}}},{key:"_loadRightFields",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(indexPatternId){var indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(indexPatternId){_context.next=2;break}return _context.abrupt("return");case 2:indexPattern=void 0;_context.prev=3;_context.next=6;return _kibana_services.indexPatternService.get(indexPatternId);case 6:indexPattern=_context.sent;_context.next=13;break;case 9:_context.prev=9;_context.t0=_context["catch"](3);if(this._isMounted){this.setState({loadError:_i18n.i18n.translate("xpack.maps.layerPanel.join.noIndexPatternErrorMessage",{defaultMessage:"Unable to find Index pattern {indexPatternId}",values:{indexPatternId:indexPatternId}})})}return _context.abrupt("return");case 13:if(!(indexPatternId!==this.state.prevIndexPatternId)){_context.next=15;break}return _context.abrupt("return");case 15:if(this._isMounted){_context.next=17;break}return _context.abrupt("return");case 17:this.setState({rightFields:indexPattern.fields});case 18:case"end":return _context.stop()}}},_callee,this,[[3,9]])}));function _loadRightFields(_x){return _ref3.apply(this,arguments)}return _loadRightFields}()},{key:"_loadLeftSourceName",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var leftSourceName;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.props.layer.getSourceName();case 2:leftSourceName=_context2.sent;if(this._isMounted){_context2.next=5;break}return _context2.abrupt("return");case 5:this.setState({leftSourceName:leftSourceName});case 6:case"end":return _context2.stop()}}},_callee2,this)}));function _loadLeftSourceName(){return _ref4.apply(this,arguments)}return _loadLeftSourceName}()},{key:"_loadLeftFields",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var stringFields;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:stringFields=void 0;_context3.prev=1;_context3.next=4;return this.props.layer.getStringFields();case 4:stringFields=_context3.sent;_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3["catch"](1);stringFields=[];case 10:if(this._isMounted){_context3.next=12;break}return _context3.abrupt("return");case 12:this.setState({leftFields:stringFields});case 13:case"end":return _context3.stop()}}},_callee3,this,[[1,7]])}));function _loadLeftFields(){return _ref5.apply(this,arguments)}return _loadLeftFields}()},{key:"render",value:function render(){var _props=this.props,join=_props.join,onRemove=_props.onRemove;var _state=this.state,leftSourceName=_state.leftSourceName,leftFields=_state.leftFields,rightFields=_state.rightFields;var right=_lodash2.default.get(join,"right",{});var rightSourceName=right.indexPatternTitle?right.indexPatternTitle:right.indexPatternId;var metricsExpression=void 0;if(join.leftField&&right.indexPatternId&&right.term){metricsExpression=_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_metrics_expression.MetricsExpression,{metrics:right.metrics,rightFields:rightFields,onChange:this._onMetricsChange}))}return _react2.default.createElement("div",{className:"mapJoinItem"},_react2.default.createElement(_eui.EuiFlexGroup,{className:"mapJoinItem__inner",responsive:false,wrap:true,gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_join_expression.JoinExpression,{leftSourceName:leftSourceName,leftValue:join.leftField,leftFields:leftFields,onLeftFieldChange:this._onLeftFieldChange,rightSourceIndexPatternId:right.indexPatternId,rightSourceName:rightSourceName,onRightSourceChange:this._onRightSourceChange,rightValue:right.term,rightFields:rightFields,onRightFieldChange:this._onRightFieldChange})),metricsExpression,_react2.default.createElement(_eui.EuiButtonIcon,{className:"mapJoinItem__delete",iconType:"trash",color:"danger","aria-label":_i18n.i18n.translate("xpack.maps.layerPanel.join.deleteJoinAriaLabel",{defaultMessage:"Delete join"}),title:_i18n.i18n.translate("xpack.maps.layerPanel.join.deleteJoinTitle",{defaultMessage:"Delete join"}),onClick:onRemove})))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){var nextIndexPatternId=getIndexPatternId(nextProps);if(nextIndexPatternId!==prevState.prevIndexPatternId){return{rightFields:undefined,loadError:undefined,prevIndexPatternId:nextIndexPatternId}}return null}}]);return Join}(_react.Component)},3401:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JoinExpression=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);var _index_pattern_select=__webpack_require__(417);var _single_field_select=__webpack_require__(446);var _react3=__webpack_require__(3);var _kibana_services=__webpack_require__(227);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var JoinExpression=exports.JoinExpression=function(_Component){_inherits(JoinExpression,_Component);function JoinExpression(){var _ref,_this2=this;var _temp,_this,_ret;_classCallCheck(this,JoinExpression);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=JoinExpression.__proto__||Object.getPrototypeOf(JoinExpression)).call.apply(_ref,[this].concat(args))),_this),_this.state={isPopoverOpen:false},_this._togglePopover=function(){_this.setState(function(prevState){return{isPopoverOpen:!prevState.isPopoverOpen}})},_this._closePopover=function(){_this.setState({isPopoverOpen:false})},_this._onRightSourceChange=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(indexPatternId){var indexPattern;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _kibana_services.indexPatternService.get(indexPatternId);case 3:indexPattern=_context.sent;_this.props.onRightSourceChange({indexPatternId:indexPatternId,indexPatternTitle:indexPattern.title});_context.next=9;break;case 7:_context.prev=7;_context.t0=_context["catch"](0);case 9:case"end":return _context.stop()}}},_callee,_this2,[[0,7]])}));return function(_x){return _ref2.apply(this,arguments)}}(),_this._onLeftFieldChange=function(selectedFields){_this.props.onLeftFieldChange(_lodash2.default.get(selectedFields,"[0].value.name",null))},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(JoinExpression,[{key:"_renderLeftFieldSelect",value:function _renderLeftFieldSelect(){var _props=this.props,leftValue=_props.leftValue,leftFields=_props.leftFields;if(!leftFields){return null}var options=leftFields.map(function(field){return{value:field,label:field.label}});var leftFieldOption=void 0;if(leftValue){leftFieldOption=options.find(function(option){var field=option.value;return field.name===leftValue})}var selectedOptions=leftFieldOption?[leftFieldOption]:[];return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.leftFieldLabel",{defaultMessage:"Left field"})},_react2.default.createElement(_eui.EuiComboBox,{placeholder:getSelectFieldPlaceholder(),singleSelection:true,isClearable:false,options:options,selectedOptions:selectedOptions,onChange:this._onLeftFieldChange}))}},{key:"_renderRightSourceSelect",value:function _renderRightSourceSelect(){if(!this.props.leftValue){return null}return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.rightSourceLabel",{defaultMessage:"Right source"})},_react2.default.createElement(_index_pattern_select.IndexPatternSelect,{placeholder:_i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.selectIndexPatternPlaceholder",{defaultMessage:"Select index pattern"}),indexPatternId:this.props.rightSourceIndexPatternId,onChange:this._onRightSourceChange,isClearable:false}))}},{key:"_renderRightFieldSelect",value:function _renderRightFieldSelect(){if(!this.props.rightFields||!this.props.leftValue){return null}var filterStringOrNumberFields=function filterStringOrNumberFields(field){return field.type==="string"||field.type==="number"};return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.rightFieldLabel",{defaultMessage:"Right field"})},_react2.default.createElement(_single_field_select.SingleFieldSelect,{placeholder:getSelectFieldPlaceholder(),value:this.props.rightValue,onChange:this.props.onRightFieldChange,filterField:filterStringOrNumberFields,fields:this.props.rightFields,isClearable:false}))}},{key:"_getExpressionValue",value:function _getExpressionValue(){var _props2=this.props,leftSourceName=_props2.leftSourceName,leftValue=_props2.leftValue,rightSourceName=_props2.rightSourceName,rightValue=_props2.rightValue;if(leftSourceName&&leftValue&&rightSourceName&&rightValue){return leftSourceName+":"+leftValue+" with "+rightSourceName+":"+rightValue}return _i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.selectPlaceholder",{defaultMessage:"-- select --"})}},{key:"render",value:function render(){var leftSourceName=this.props.leftSourceName;return _react2.default.createElement(_eui.EuiPopover,{id:"joinPopover",isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,ownFocus:true,initialFocus:"body",withTitle:true,anchorPosition:"leftCenter",button:_react2.default.createElement(_eui.EuiExpression,{onClick:this._togglePopover,description:"Join",uppercase:false,value:this._getExpressionValue()})},_react2.default.createElement("div",{style:{width:300}},_react2.default.createElement(_eui.EuiPopoverTitle,null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.joinExpression.joinPopoverTitle",defaultMessage:"Join"})),_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.leftSourceLabel",{defaultMessage:"Left source"})},_react2.default.createElement(_eui.EuiComboBox,{selectedOptions:[{value:leftSourceName,label:leftSourceName}],isDisabled:true})),this._renderLeftFieldSelect(),this._renderRightSourceSelect(),this._renderRightFieldSelect()))}}]);return JoinExpression}(_react.Component);JoinExpression.propTypes={leftSourceName:_propTypes2.default.string,leftValue:_propTypes2.default.string,leftFields:_propTypes2.default.arrayOf(_propTypes2.default.shape({label:_propTypes2.default.string.isRequired,name:_propTypes2.default.string.isRequired})),onLeftFieldChange:_propTypes2.default.func.isRequired,rightSourceIndexPatternId:_propTypes2.default.string,rightSourceName:_propTypes2.default.string,onRightSourceChange:_propTypes2.default.func.isRequired,rightValue:_propTypes2.default.string,rightFields:_propTypes2.default.object,onRightFieldChange:_propTypes2.default.func.isRequired};function getSelectFieldPlaceholder(){return _i18n.i18n.translate("xpack.maps.layerPanel.joinExpression.selectFieldPlaceholder",{defaultMessage:"Select field"})}},3402:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MetricsExpression=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _i18n=__webpack_require__(5);var _eui=__webpack_require__(1);var _metrics_editor=__webpack_require__(1236);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MetricsExpression=exports.MetricsExpression=function(_Component){_inherits(MetricsExpression,_Component);function MetricsExpression(){var _ref;var _temp,_this,_ret;_classCallCheck(this,MetricsExpression);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=MetricsExpression.__proto__||Object.getPrototypeOf(MetricsExpression)).call.apply(_ref,[this].concat(args))),_this),_this.state={isPopoverOpen:false},_this._togglePopover=function(){_this.setState(function(prevState){return{isPopoverOpen:!prevState.isPopoverOpen}})},_this._closePopover=function(){_this.setState({isPopoverOpen:false})},_this._renderMetricsEditor=function(){if(!_this.props.rightFields){return _react2.default.createElement(_eui.EuiFormErrorText,null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.metricsExpression.joinMustBeSetErrorMessage",defaultMessage:"JOIN must be set"}))}return _react2.default.createElement(_metrics_editor.MetricsEditor,{fields:_this.props.rightFields,metrics:_this.props.metrics,onChange:_this.props.onChange})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(MetricsExpression,[{key:"render",value:function render(){var metricExpressions=this.props.metrics.filter(function(_ref2){var type=_ref2.type,field=_ref2.field;if(type==="count"){return true}if(field){return true}return false}).map(function(_ref3){var type=_ref3.type,field=_ref3.field;if(type==="count"){return"count"}return type+" "+field});var useMetricDescription=_i18n.i18n.translate("xpack.maps.layerPanel.metricsExpression.useMetricsDescription",{defaultMessage:"{metricsLength, plural, one {and use metric} other {and use metrics}}",values:{metricsLength:metricExpressions.length}});return _react2.default.createElement(_eui.EuiPopover,{id:"metricsPopover",isOpen:this.state.isPopoverOpen,closePopover:this._closePopover,ownFocus:true,initialFocus:"body",withTitle:true,anchorPosition:"leftCenter",button:_react2.default.createElement(_eui.EuiExpression,{onClick:this._togglePopover,description:useMetricDescription,uppercase:false,value:metricExpressions.length>0?metricExpressions.join(", "):"count"})},_react2.default.createElement("div",{style:{width:400}},_react2.default.createElement(_eui.EuiPopoverTitle,null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.metricsExpression.metricsPopoverTitle",defaultMessage:"Metrics"})),this._renderMetricsEditor()))}}]);return MetricsExpression}(_react.Component);MetricsExpression.propTypes={metrics:_propTypes2.default.array,rightFields:_propTypes2.default.object,onChange:_propTypes2.default.func.isRequired};MetricsExpression.defaultProps={metrics:[{type:"count"}]}},3403:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FlyoutFooter=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3404);var _ui=__webpack_require__(267);var _store_actions=__webpack_require__(216);var mapDispatchToProps=function mapDispatchToProps(dispatch){return{cancelLayerPanel:function cancelLayerPanel(){dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.NONE));dispatch((0,_store_actions.setSelectedLayer)(null))},saveLayerEdits:function saveLayerEdits(){dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.NONE));dispatch((0,_store_actions.removeTrackedLayerStateForSelectedLayer)());dispatch((0,_store_actions.setSelectedLayer)(null))},removeLayer:function removeLayer(){dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.NONE));dispatch((0,_store_actions.removeSelectedLayer)())}}};var connectedFlyoutFooter=(0,_reactRedux.connect)(null,mapDispatchToProps)(_view.FlyoutFooter);exports.FlyoutFooter=connectedFlyoutFooter},3404:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FlyoutFooter=undefined;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var FlyoutFooter=exports.FlyoutFooter=function FlyoutFooter(_ref){var cancelLayerPanel=_ref.cancelLayerPanel,saveLayerEdits=_ref.saveLayerEdits,removeLayer=_ref.removeLayer,hasStateChanged=_ref.hasStateChanged;var removeBtn=_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{color:"danger",onClick:removeLayer,flush:"right","data-test-subj":"mapRemoveLayerButton"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.footer.removeLayerButtonLabel",defaultMessage:"Remove layer"})));var cancelButtonLabel=hasStateChanged?_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.footer.cancelButtonLabel",defaultMessage:"Cancel"}):_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.footer.closeButtonLabel",defaultMessage:"Close"});return _react2.default.createElement(_eui.EuiFlexGroup,{responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:cancelLayerPanel,flush:"left"},cancelButtonLabel)),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiSpacer,null)),removeBtn,_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{disabled:!hasStateChanged,iconType:"check",onClick:saveLayerEdits,fill:true},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.footer.saveAndCloseButtonLabel",defaultMessage:"Save & close"}))))}},3405:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SettingsPanel=undefined;var _reactRedux=__webpack_require__(14);var _settings_panel=__webpack_require__(3406);var _map_selectors=__webpack_require__(192);var _store_actions=__webpack_require__(216);function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var selectedLayer=(0,_map_selectors.getSelectedLayer)(state);return{alpha:selectedLayer.getAlpha(),label:selectedLayer.getLabel(),layerId:selectedLayer.getId(),maxZoom:selectedLayer.getMaxZoom(),minZoom:selectedLayer.getMinZoom(),layer:selectedLayer}}function mapDispatchToProps(dispatch){return{updateLabel:function updateLabel(id,label){return dispatch((0,_store_actions.updateLayerLabel)(id,label))},updateMinZoom:function updateMinZoom(id,minZoom){return dispatch((0,_store_actions.updateLayerMinZoom)(id,minZoom))},updateMaxZoom:function updateMaxZoom(id,maxZoom){return dispatch((0,_store_actions.updateLayerMaxZoom)(id,maxZoom))},updateAlpha:function updateAlpha(id,alpha){return dispatch((0,_store_actions.updateLayerAlpha)(id,alpha))},updateSourceProp:function updateSourceProp(id,propName,value){return dispatch((0,_store_actions.updateSourceProp)(id,propName,value))}}}var connectedSettingsPanel=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps)(_settings_panel.SettingsPanel);exports.SettingsPanel=connectedSettingsPanel},3406:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SettingsPanel=SettingsPanel;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _validated_range=__webpack_require__(761);var _i18n=__webpack_require__(5);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SettingsPanel(props){var onLabelChange=function onLabelChange(event){var label=event.target.value;props.updateLabel(props.layerId,label)};var onMinZoomChange=function onMinZoomChange(event){var zoom=parseInt(event.target.value,10);props.updateMinZoom(props.layerId,zoom)};var onMaxZoomChange=function onMaxZoomChange(event){var zoom=parseInt(event.target.value,10);props.updateMaxZoom(props.layerId,zoom)};var onAlphaChange=function onAlphaChange(alpha){props.updateAlpha(props.layerId,alpha)};var onSourceChange=function onSourceChange(_ref){var propName=_ref.propName,value=_ref.value;props.updateSourceProp(props.layerId,propName,value)};var renderLayerErrors=function renderLayerErrors(){if(!props.layer.hasErrors()){return null}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{color:"warning",title:_i18n.i18n.translate("xpack.maps.layerPanel.settingsPanel.unableToLoadTitle",{defaultMessage:"Unable to load layer"})},_react2.default.createElement("p",{"data-test-subj":"layerErrorMessage"},props.layer.getErrors())),_react2.default.createElement(_eui.EuiSpacer,{margin:"m"}))};var renderZoomSliders=function renderZoomSliders(){return _react2.default.createElement(_eui.EuiFormRow,{helpText:_i18n.i18n.translate("xpack.maps.layerPanel.settingsPanel.zoomFeedbackHelptext",{defaultMessage:"Display layer when map is in zoom range."})},_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.settingsPanel.minZoomLabel",{defaultMessage:"Min zoom"})},_react2.default.createElement(_eui.EuiRange,{min:0,max:24,value:props.minZoom.toString(),onChange:onMinZoomChange,showInput:true,showRange:true}))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.settingsPanel.maxZoomLabel",{defaultMessage:"Max zoom"})},_react2.default.createElement(_eui.EuiRange,{min:0,max:24,value:props.maxZoom.toString(),onChange:onMaxZoomChange,showInput:true,showRange:true})))))};var renderLabel=function renderLabel(){return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerNameLabel",{defaultMessage:"Layer name"})},_react2.default.createElement(_eui.EuiFieldText,{value:props.label,onChange:onLabelChange}))};var renderAlphaSlider=function renderAlphaSlider(){return _react2.default.createElement(_eui.EuiFormRow,{label:_i18n.i18n.translate("xpack.maps.layerPanel.settingsPanel.layerTransparencyLabel",{defaultMessage:"Layer transparency"})},_react2.default.createElement("div",{className:"mapAlphaRange"},_react2.default.createElement(_validated_range.ValidatedRange,{min:0,max:1,step:.05,value:props.alpha,onChange:onAlphaChange,showLabels:true,showInput:true,showRange:true})))};return _react2.default.createElement(_react.Fragment,null,renderLayerErrors(),_react2.default.createElement(_eui.EuiPanel,null,_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h5",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.layerPanel.settingsPanel.settingsTitle",defaultMessage:"Settings"}))))),_react2.default.createElement(_eui.EuiSpacer,{margin:"m"}),renderLabel(),renderZoomSliders(),renderAlphaSlider(),props.layer.renderSourceSettingsEditor({onChange:onSourceChange})))}},3407:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddLayerPanel=undefined;var _reactRedux=__webpack_require__(14);var _view=__webpack_require__(3408);var _ui=__webpack_require__(267);var _map_selectors=__webpack_require__(192);var _store_actions=__webpack_require__(216);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function mapStateToProps(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var selectedLayer=(0,_map_selectors.getSelectedLayer)(state);return{flyoutVisible:(0,_ui.getFlyoutDisplay)(state)!==_ui.FLYOUT_STATE.NONE,hasLayerSelected:!!selectedLayer,isLoading:selectedLayer&&selectedLayer.isLayerLoading()}}function mapDispatchToProps(dispatch){var _this=this;return{closeFlyout:function closeFlyout(){dispatch((0,_store_actions.clearTransientLayerStateAndCloseFlyout)())},previewLayer:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(layer){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dispatch((0,_store_actions.setSelectedLayer)(null));case 2:_context.next=4;return dispatch((0,_store_actions.removeTransientLayer)());case 4:dispatch((0,_store_actions.addLayer)(layer.toLayerDescriptor()));dispatch((0,_store_actions.setSelectedLayer)(layer.getId()));dispatch((0,_store_actions.setTransientLayer)(layer.getId()));case 7:case"end":return _context.stop()}}},_callee,_this)}));function previewLayer(_x2){return _ref.apply(this,arguments)}return previewLayer}(),removeTransientLayer:function removeTransientLayer(){dispatch((0,_store_actions.setSelectedLayer)(null));dispatch((0,_store_actions.removeTransientLayer)())},selectLayerAndAdd:function selectLayerAndAdd(){dispatch((0,_store_actions.setTransientLayer)(null));dispatch((0,_ui.updateFlyout)(_ui.FLYOUT_STATE.LAYER_PANEL))}}}var connectedFlyOut=(0,_reactRedux.connect)(mapStateToProps,mapDispatchToProps,null,{withRef:true})(_view.AddLayerPanel);exports.AddLayerPanel=connectedFlyOut},3408:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddLayerPanel=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _all_sources=__webpack_require__(1230);var _eui=__webpack_require__(1);var _react3=__webpack_require__(3);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AddLayerPanel=exports.AddLayerPanel=function(_Component){_inherits(AddLayerPanel,_Component);function AddLayerPanel(){var _ref;var _temp,_this,_ret;_classCallCheck(this,AddLayerPanel);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=AddLayerPanel.__proto__||Object.getPrototypeOf(AddLayerPanel)).call.apply(_ref,[this].concat(args))),_this),_this.state={sourceType:null,isLoading:false,hasLayerSelected:false,layer:null},_this._previewLayer=function(source){if(!source){_this.setState({layer:null});_this.props.removeTransientLayer();return}_this.setState({layer:source.createDefaultLayer({})},function(){return _this.props.previewLayer(_this.state.layer)})},_this._clearSource=function(){_this.setState({sourceType:null});_this.props.removeTransientLayer()},_this._onSourceTypeChange=function(sourceType){_this.setState({sourceType:sourceType})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(AddLayerPanel,[{key:"_renderNextBtn",value:function _renderNextBtn(){var _this2=this;if(!this.state.sourceType){return null}var _props=this.props,hasLayerSelected=_props.hasLayerSelected,isLoading=_props.isLoading,selectLayerAndAdd=_props.selectLayerAndAdd;return _react2.default.createElement(_eui.EuiButton,{disabled:!hasLayerSelected,isLoading:hasLayerSelected&&isLoading,iconSide:"right",iconType:"sortRight",onClick:function onClick(){_this2.setState({layer:null});selectLayerAndAdd()},fill:true},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.addLayerPanel.addLayerButtonLabel",defaultMessage:"Add layer"}))}},{key:"_renderSourceCards",value:function _renderSourceCards(){var _this3=this;return _all_sources.ALL_SOURCES.map(function(Source){var icon=Source.icon?_react2.default.createElement(_eui.EuiIcon,{type:Source.icon,size:"l"}):null;return _react2.default.createElement(_react.Fragment,{key:Source.type},_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiCard,{className:"mapLayerAddpanel__card",title:Source.title,icon:icon,onClick:function onClick(){return _this3._onSourceTypeChange(Source.type)},description:Source.description,layout:"horizontal","data-test-subj":_lodash2.default.camelCase(Source.title)}))})}},{key:"_renderSourceSelect",value:function _renderSourceSelect(){return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h2",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.addLayerPanel.chooseDataSourceTitle",defaultMessage:"Choose data source"}))),this._renderSourceCards())}},{key:"_renderSourceEditor",value:function _renderSourceEditor(){var _this4=this;var editorProperties={onPreviewSource:this._previewLayer};var Source=_all_sources.ALL_SOURCES.find(function(Source){return Source.type===_this4.state.sourceType});if(!Source){throw new Error("Unexepected source type: "+this.state.sourceType)}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiButtonEmpty,{size:"xs",flush:"left",onClick:this._clearSource,iconType:"arrowLeft"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.addLayerPanel.changeDataSourceButtonLabel",defaultMessage:"Change data source"})),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiPanel,null,Source.renderEditor(editorProperties)))}},{key:"_renderAddLayerForm",value:function _renderAddLayerForm(){if(!this.state.sourceType){return this._renderSourceSelect()}return this._renderSourceEditor()}},{key:"_renderFlyout",value:function _renderFlyout(){return _react2.default.createElement(_eui.EuiFlexGroup,{direction:"column",gutterSize:"none"},_react2.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true,className:"mapLayerPanel__header"},_react2.default.createElement(_eui.EuiTitle,{size:"s"},_react2.default.createElement("h2",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.addLayerPanel.panelTitle",defaultMessage:"Add layer"})))),_react2.default.createElement(_eui.EuiFlyoutBody,{className:"mapLayerPanel__body","data-test-subj":"layerAddForm"},this._renderAddLayerForm()),_react2.default.createElement(_eui.EuiFlyoutFooter,{className:"mapLayerPanel__footer"},_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:this.props.closeFlyout,flush:"left","data-test-subj":"layerAddCancelButton"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.addLayerPanel.cancelButtonLabel",defaultMessage:"Cancel"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},this._renderNextBtn()))))}},{key:"render",value:function render(){return this.props.flyoutVisible?this._renderFlyout():null}}]);return AddLayerPanel}(_react.Component)},3409:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getInitialLayers=getInitialLayers;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _kibana_tilemap_source=__webpack_require__(1233);var _ems_tms_source=__webpack_require__(1232);var _meta=__webpack_require__(290);var _constants=__webpack_require__(193);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getInitialLayers(savedMapLayerListJSON){if(savedMapLayerListJSON){return JSON.parse(savedMapLayerListJSON)}if(!(0,_meta.isMetaDataLoaded)()){var descriptor=_ems_tms_source.EMSTMSSource.createDescriptor(_constants.DEFAULT_EMS_TILE_LAYER);var source=new _ems_tms_source.EMSTMSSource(descriptor);var layer=source.createDefaultLayer();return[layer.toLayerDescriptor()]}var dataSources=(0,_meta.getDataSourcesSync)();if(_lodash2.default.get(dataSources,"kibana.tilemap.url")){var sourceDescriptor=_kibana_tilemap_source.KibanaTilemapSource.createDescriptor();var _source=new _kibana_tilemap_source.KibanaTilemapSource(sourceDescriptor);var _layer=_source.createDefaultLayer();return[_layer.toLayerDescriptor()]}var emsTmsServices=_lodash2.default.get(dataSources,"ems.tms");if(emsTmsServices&&emsTmsServices.length>0){var _sourceDescriptor=_ems_tms_source.EMSTMSSource.createDescriptor(emsTmsServices[0].id);var _source2=new _ems_tms_source.EMSTMSSource(_sourceDescriptor,{emsTmsServices:emsTmsServices});var _layer2=_source2.createDefaultLayer();return[_layer2.toLayerDescriptor()]}return[]}},3410:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getInitialQuery=getInitialQuery;function getInitialQuery(_ref){var mapStateJSON=_ref.mapStateJSON,_ref$appState=_ref.appState,appState=_ref$appState===undefined?{}:_ref$appState,userQueryLanguage=_ref.userQueryLanguage;if(appState.query){return appState.query}if(mapStateJSON){var mapState=JSON.parse(mapStateJSON);if(mapState.query){return mapState.query}}return{query:"",language:userQueryLanguage||"kuery"}}},3411:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.getInitialTimeFilters=getInitialTimeFilters;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var uiSettings=_chrome2.default.getUiSettingsClient();function getInitialTimeFilters(_ref){var mapStateJSON=_ref.mapStateJSON,_ref$globalState=_ref.globalState,globalState=_ref$globalState===undefined?{}:_ref$globalState;if(mapStateJSON){var mapState=JSON.parse(mapStateJSON);if(mapState.timeFilters){return mapState.timeFilters}}var defaultTime=uiSettings.get("timepicker:timeDefaults");return _extends({},defaultTime,globalState.time)}},3412:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.getInitialRefreshConfig=getInitialRefreshConfig;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var uiSettings=_chrome2.default.getUiSettingsClient();function getInitialRefreshConfig(_ref){var mapStateJSON=_ref.mapStateJSON,_ref$globalState=_ref.globalState,globalState=_ref$globalState===undefined?{}:_ref$globalState;if(mapStateJSON){var mapState=JSON.parse(mapStateJSON);if(mapState.refreshConfig){return mapState.refreshConfig}}var defaultRefreshConfig=uiSettings.get("timepicker:refreshIntervalDefaults");var refreshInterval=_extends({},defaultRefreshConfig,globalState.refreshInterval);return{isPaused:refreshInterval.pause,interval:refreshInterval.value}}},3413:function(module,exports){module.exports='<map-listing\n  find="find"\n  delete="delete"\n  listing-limit="listingLimit"\n></map-listing>\n'},3414:function(module,exports){module.exports='<div id="maps-plugin"  ng-class="{mapFullScreen: isFullScreen}">\n  <div id="maps-top-nav">\n    <div>\n      <kbn-top-nav name="map" config="topNavMenu">\n        <div data-transclude-slots>\n          \x3c!-- Title. --\x3e\n          <div data-transclude-slot="topLeftCorner">\n            <div\n              class="kuiLocalBreadcrumbs"\n              data-test-subj="breadcrumbs"\n              role="heading"\n              aria-level="1"\n              ng-if="showPluginBreadcrumbs">\n              <div class="kuiLocalBreadcrumb">\n                <a\n                  class="kuiLocalBreadcrumb__link"\n                  href="#"\n                  i18n-id="xpack.maps.mapController.mapsBreadcrumbLabel"\n                  i18n-default-message="Maps"\n                ></a>\n              </div>\n              <div class="kuiLocalBreadcrumb">\n                {{ getMapTitle() }}\n              </div>\n            </div>\n          </div>\n\n          \x3c!-- Search. --\x3e\n          <div ng-show="chrome.getVisible()" class="fullWidth" data-transclude-slot="bottomRow">\n            <query-bar\n              query="query"\n              app-name="\'maps\'"\n              on-submit="updateQueryAndDispatch"\n              index-patterns="indexPatterns"\n              show-date-picker="showDatePicker"\n              date-range-from="time.from"\n              date-range-to="time.to"\n              is-refresh-paused="refreshConfig.isPaused"\n              refresh-interval="refreshConfig.interval"\n              on-refresh-change="onRefreshChange"\n            ></query-bar>\n          </div>\n\n        </div>\n      </kbn-top-nav>\n    </div>\n  </div>\n\n  <div id="react-maps-root"></div>\n\n</div>\n'},3415:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MapListing=exports.EMPTY_FILTER=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _notify=__webpack_require__(9);var _eui=__webpack_require__(1);var _i18n=__webpack_require__(5);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EMPTY_FILTER=exports.EMPTY_FILTER="";var MapListing=exports.MapListing=function(_React$Component){_inherits(MapListing,_React$Component);function MapListing(props){var _this2=this;_classCallCheck(this,MapListing);var _this=_possibleConstructorReturn(this,(MapListing.__proto__||Object.getPrototypeOf(MapListing)).call(this,props));_this.debouncedFetch=_lodash2.default.debounce(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(filter){var response;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.props.find(filter);case 2:response=_context.sent;if(_this._isMounted){_context.next=5;break}return _context.abrupt("return");case 5:if(filter===_this.state.filter){_this.setState({hasInitialFetchReturned:true,isFetchingItems:false,items:response.hits,totalItems:response.total,showLimitError:response.total>_this.props.listingLimit})}case 6:case"end":return _context.stop()}}},_callee,_this2)}));return function(_x){return _ref.apply(this,arguments)}}(),300);_this.fetchItems=function(){_this.setState({isFetchingItems:true},_this.debouncedFetch.bind(null,_this.state.filter))};_this.deleteSelectedItems=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _this.props.delete(_this.state.selectedIds);case 3:_context2.next=8;break;case 5:_context2.prev=5;_context2.t0=_context2["catch"](0);_notify.toastNotifications.addDanger({title:_i18n.i18n.translate("xpack.maps.mapListing.unableToDeleteToastTitle",{defaultMessage:"Unable to delete map(s)"}),text:""+_context2.t0});case 8:_this.fetchItems();_this.setState({selectedIds:[]});_this.closeDeleteModal();case 11:case"end":return _context2.stop()}}},_callee2,_this2,[[0,5]])}));_this.closeDeleteModal=function(){_this.setState({showDeleteModal:false})};_this.openDeleteModal=function(){_this.setState({showDeleteModal:true})};_this.onTableChange=function(_ref3){var page=_ref3.page,_ref3$sort=_ref3.sort,sort=_ref3$sort===undefined?{}:_ref3$sort;var pageIndex=page.index,pageSize=page.size;var sortField=sort.field,sortDirection=sort.direction;if(_this.state.sortField===sortField&&_this.state.sortDirection==="desc"&&sortDirection==="asc"){sortField=null;sortDirection=null}_this.setState({page:pageIndex,perPage:pageSize,sortField:sortField,sortDirection:sortDirection})};_this.getPageOfItems=function(){var itemsCopy=_this.state.items.slice();if(_this.state.sortField){itemsCopy.sort(function(a,b){var fieldA=_lodash2.default.get(a,_this.state.sortField,"");var fieldB=_lodash2.default.get(b,_this.state.sortField,"");var order=1;if(_this.state.sortDirection==="desc"){order=-1}return order*fieldA.toLowerCase().localeCompare(fieldB.toLowerCase())})}var startIndex=_this.state.page*_this.state.perPage;var lastIndex=startIndex+_this.state.perPage;return itemsCopy.slice(startIndex,lastIndex)};_this.state={hasInitialFetchReturned:false,isFetchingItems:false,showDeleteModal:false,showLimitError:false,filter:EMPTY_FILTER,items:[],selectedIds:[],page:0,perPage:20};return _this}_createClass(MapListing,[{key:"componentWillMount",value:function componentWillMount(){this._isMounted=true}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._isMounted=false;this.debouncedFetch.cancel()}},{key:"componentDidMount",value:function componentDidMount(){this.fetchItems()}},{key:"hasNoItems",value:function hasNoItems(){if(!this.state.isFetchingItems&&this.state.items.length===0&&!this.state.filter){return true}return false}},{key:"renderConfirmDeleteModal",value:function renderConfirmDeleteModal(){return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:_i18n.i18n.translate("xpack.maps.mapListing.deleteSelectedItemsTitle",{defaultMessage:"Delete selected items?"}),onCancel:this.closeDeleteModal,onConfirm:this.deleteSelectedItems,cancelButtonText:_i18n.i18n.translate("xpack.maps.mapListing.cancelTitle",{defaultMessage:"Cancel"}),confirmButtonText:_i18n.i18n.translate("xpack.maps.mapListing.deleteTitle",{defaultMessage:"Delete"}),defaultFocusedButton:"cancel"},_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.mapListing.deleteWarning",defaultMessage:"You can't recover deleted items."}))))}},{key:"renderListingLimitWarning",value:function renderListingLimitWarning(){if(this.state.showLimitError){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{title:_i18n.i18n.translate("xpack.maps.mapListing.limitExceededTitle",{defaultMessage:"Listing limit exceeded"}),color:"warning",iconType:"help"},_react2.default.createElement("p",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.mapListing.limitHelpDescription",defaultMessage:"You have {totalItems} items, but your <strong>listingLimit</strong> setting prevents the table below from displaying more than {listingLimit}. You can change this setting under ",values:{totalItems:this.state.totalItems,listingLimit:this.props.listingLimit}}),_react2.default.createElement(_eui.EuiLink,{href:"#/management/kibana/settings"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.mapListing.advancedSettingsLinkText",defaultMessage:"Advanced Settings"})),".")),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}}},{key:"renderNoResultsMessage",value:function renderNoResultsMessage(){if(this.state.isFetchingItems){return""}if(this.hasNoItems()){return _i18n.i18n.translate("xpack.maps.mapListing.noItemsDescription",{defaultMessage:"Looks like you don't have any maps. Click the create button to create one."})}return _i18n.i18n.translate("xpack.maps.mapListing.noMatchDescription",{defaultMessage:"No items matched your search."})}},{key:"renderSearchBar",value:function renderSearchBar(){var _this3=this;var deleteBtn=void 0;if(this.state.selectedIds.length>0){deleteBtn=_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{color:"danger",onClick:this.openDeleteModal,"data-test-subj":"deleteSelectedItems",key:"delete"},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.mapListing.deleteSelectedButtonLabel",defaultMessage:"Delete selected"})))}return _react2.default.createElement(_eui.EuiFlexGroup,null,deleteBtn,_react2.default.createElement(_eui.EuiFlexItem,{grow:true},_react2.default.createElement(_eui.EuiFieldSearch,{"aria-label":_i18n.i18n.translate("xpack.maps.mapListing.searchAriaLabel",{defaultMessage:"Filter items"}),placeholder:_i18n.i18n.translate("xpack.maps.mapListing.searchPlaceholder",{defaultMessage:"Search..."}),fullWidth:true,value:this.state.filter,onChange:function onChange(e){_this3.setState({filter:e.target.value},_this3.fetchItems)},"data-test-subj":"searchFilter"})))}},{key:"renderTable",value:function renderTable(){var _this4=this;var tableColumns=[{field:"title",name:_i18n.i18n.translate("xpack.maps.mapListing.titleFieldTitle",{defaultMessage:"Title"}),sortable:true,render:function render(field,record){return _react2.default.createElement(_eui.EuiLink,{href:"#/map/"+record.id,"data-test-subj":"mapListingTitleLink-"+record.title.split(" ").join("-")},field)}},{field:"description",name:_i18n.i18n.translate("xpack.maps.mapListing.descriptionFieldTitle",{defaultMessage:"Description"}),dataType:"string",sortable:true}];var pagination={pageIndex:this.state.page,pageSize:this.state.perPage,totalItemCount:this.state.items.length,pageSizeOptions:[10,20,50]};var selection={onSelectionChange:function onSelectionChange(selection){_this4.setState({selectedIds:selection.map(function(item){return item.id})})}};var sorting={};if(this.state.sortField){sorting.sort={field:this.state.sortField,direction:this.state.sortDirection}}var items=this.state.items.length===0?[]:this.getPageOfItems();return _react2.default.createElement(_eui.EuiBasicTable,{itemId:"id",items:items,loading:this.state.isFetchingItems,columns:tableColumns,selection:selection,noItemsMessage:this.renderNoResultsMessage(),pagination:pagination,sorting:sorting,onChange:this.onTableChange})}},{key:"renderListing",value:function renderListing(){var createButton=void 0;if(!this.props.hideWriteControls){createButton=_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{href:"#/map","data-test-subj":"newMapLink",fill:true},_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.mapListing.createMapButtonLabel",defaultMessage:"Create map"})))}return _react2.default.createElement("div",null,this.state.showDeleteModal&&this.renderConfirmDeleteModal(),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"flexEnd","data-test-subj":"top-nav"},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiTitle,{size:"l"},_react2.default.createElement("h1",null,_react2.default.createElement(_react3.FormattedMessage,{id:"xpack.maps.mapListing.listingTableTitle",defaultMessage:"Maps"})))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiBetaBadge,{label:"Beta",tooltipContent:_i18n.i18n.translate("xpack.maps.mapListing.betaMessageBadge",{defaultMessage:"Maps is still in beta. Please help us improve by reporting issues or bugs in the Kibana repo."})}))),createButton),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),this.renderListingLimitWarning(),this.renderSearchBar(),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),this.renderTable())}},{key:"renderPageContent",value:function renderPageContent(){if(!this.state.hasInitialFetchReturned){return}return _react2.default.createElement(_eui.EuiPageContent,{horizontalPosition:"center"},this.renderListing())}},{key:"render",value:function render(){return _react2.default.createElement(_eui.EuiPage,{"data-test-subj":"mapsListingPage",restrictWidth:true},_react2.default.createElement(_eui.EuiPageBody,null,this.renderPageContent()))}}]);return MapListing}(_react2.default.Component);MapListing.propTypes={find:_propTypes2.default.func.isRequired,delete:_propTypes2.default.func.isRequired,listingLimit:_propTypes2.default.number.isRequired}},445:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TileLayer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _layer=__webpack_require__(755);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _tile_style=__webpack_require__(1220);var _constants=__webpack_require__(193);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TileLayer=exports.TileLayer=function(_AbstractLayer){_inherits(TileLayer,_AbstractLayer);function TileLayer(_ref){var layerDescriptor=_ref.layerDescriptor,source=_ref.source,style=_ref.style;_classCallCheck(this,TileLayer);var _this=_possibleConstructorReturn(this,(TileLayer.__proto__||Object.getPrototypeOf(TileLayer)).call(this,{layerDescriptor:layerDescriptor,source:source,style:style}));if(!style){_this._style=new _tile_style.TileStyle}return _this}_createClass(TileLayer,[{key:"syncData",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(_ref2){var startLoading=_ref2.startLoading,stopLoading=_ref2.stopLoading,onLoadError=_ref2.onLoadError,dataFilters=_ref2.dataFilters;var sourceDataRequest,requestToken,url;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!this.isVisible()||!this.showAtZoomLevel(dataFilters.zoom))){_context.next=2;break}return _context.abrupt("return");case 2:sourceDataRequest=this.getSourceDataRequest();if(!sourceDataRequest){_context.next=5;break}return _context.abrupt("return");case 5:requestToken=Symbol("layer-source-refresh:"+this.getId()+" - source");startLoading(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,dataFilters);_context.prev=7;_context.next=10;return this._source.getUrlTemplate();case 10:url=_context.sent;stopLoading(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,url,{});_context.next=17;break;case 14:_context.prev=14;_context.t0=_context["catch"](7);onLoadError(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,_context.t0.message);case 17:case"end":return _context.stop()}}},_callee,this,[[7,14]])}));function syncData(_x){return _ref3.apply(this,arguments)}return syncData}()},{key:"syncLayerWithMB",value:function syncLayerWithMB(mbMap){var source=mbMap.getSource(this.getId());var mbLayerId=this.getId()+"_raster";if(!source){var sourceDataRequest=this.getSourceDataRequest();if(!sourceDataRequest){return}var url=sourceDataRequest.getData();if(!url){return}var sourceId=this.getId();mbMap.addSource(sourceId,{type:"raster",tiles:[url],tileSize:256,scheme:"xyz"});mbMap.addLayer({id:mbLayerId,type:"raster",source:sourceId,minzoom:this._descriptor.minZoom,maxzoom:this._descriptor.maxZoom})}this._setTileLayerProperties(mbMap,mbLayerId)}},{key:"_setTileLayerProperties",value:function _setTileLayerProperties(mbMap,mbLayerId){mbMap.setLayoutProperty(mbLayerId,"visibility",this.isVisible()?"visible":"none");mbMap.setLayerZoomRange(mbLayerId,this._descriptor.minZoom,this._descriptor.maxZoom);mbMap.setPaintProperty(mbLayerId,"raster-opacity",this.getAlpha())}},{key:"getLayerTypeIconName",value:function getLayerTypeIconName(){return"grid"}},{key:"getIcon",value:function getIcon(){return _react2.default.createElement(_eui.EuiIcon,{type:this.getLayerTypeIconName()})}},{key:"isLayerLoading",value:function isLayerLoading(){return false}}],[{key:"createDescriptor",value:function createDescriptor(options){var tileLayerDescriptor=_get(TileLayer.__proto__||Object.getPrototypeOf(TileLayer),"createDescriptor",this).call(this,options);tileLayerDescriptor.type=TileLayer.type;tileLayerDescriptor.alpha=_lodash2.default.get(options,"alpha",1);tileLayerDescriptor.style=_tile_style.TileStyle.createDescriptor(tileLayerDescriptor.style.properties);return tileLayerDescriptor}}]);return TileLayer}(_layer.AbstractLayer);TileLayer.type="TILE"},446:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getGroupedFieldOptions=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.SingleFieldSelect=SingleFieldSelect;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _propTypes=__webpack_require__(4);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}var getGroupedFieldOptions=exports.getGroupedFieldOptions=function getGroupedFieldOptions(fields,filterField){if(!fields){return undefined}var fieldsByTypeMap=new Map;var groupedFieldOptions=[];fields.filter(filterField).forEach(function(field){if(fieldsByTypeMap.has(field.type)){var fieldsList=fieldsByTypeMap.get(field.type);fieldsList.push(field.name);fieldsByTypeMap.set(field.type,fieldsList)}else{fieldsByTypeMap.set(field.type,[field.name])}});fieldsByTypeMap.forEach(function(fieldsList,fieldType){groupedFieldOptions.push({label:fieldType,options:fieldsList.sort().map(function(fieldName){return{value:fieldName,label:fieldName}})})});groupedFieldOptions.sort(function(a,b){if(a.label<b.label)return-1;if(a.label>b.label)return 1;return 0});return groupedFieldOptions};function SingleFieldSelect(_ref){var fields=_ref.fields,filterField=_ref.filterField,onChange=_ref.onChange,value=_ref.value,placeholder=_ref.placeholder,rest=_objectWithoutProperties(_ref,["fields","filterField","onChange","value","placeholder"]);var onSelection=function onSelection(selectedOptions){onChange(_lodash2.default.get(selectedOptions,"0.value"))};return _react2.default.createElement(_eui.EuiComboBox,_extends({placeholder:placeholder,singleSelection:true,options:getGroupedFieldOptions(fields,filterField),selectedOptions:value?[{value:value,label:value}]:[],onChange:onSelection,isDisabled:!fields},rest))}SingleFieldSelect.propTypes={placeholder:_propTypes2.default.string,fields:_propTypes2.default.object,onChange:_propTypes2.default.func.isRequired,value:_propTypes2.default.string,filterField:_propTypes2.default.func};SingleFieldSelect.defaultProps={filterField:function filterField(){return true}}},547:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.hitsToGeoJson=hitsToGeoJson;exports.geoPointToGeometry=geoPointToGeometry;exports.makeGeohashGridPolygon=makeGeohashGridPolygon;exports.geoShapeToGeometry=geoShapeToGeometry;exports.createExtentFilter=createExtentFilter;exports.convertMapExtentToPolygon=convertMapExtentToPolygon;var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function hitsToGeoJson(hits,flattenHit,geoFieldName,geoFieldType){var features=[];hits.forEach(function(hit){var properties=flattenHit(hit);var geometries=void 0;if(geoFieldType==="geo_point"){geometries=geoPointToGeometry(properties[geoFieldName])}else if(geoFieldType==="geo_shape"){geometries=geoShapeToGeometry(properties[geoFieldName])}else{var errorMessage=_i18n.i18n.translate("xpack.maps.elasticsearch_geo_utils.unsupportedFieldTypeErrorMessage",{defaultMessage:"Unsupported field type, expected: geo_shape or geo_point, you provided: {geoFieldType}",values:{geoFieldType:geoFieldType}});throw new Error(errorMessage)}delete properties[geoFieldName];return geometries.map(function(geometry){features.push({type:"Feature",geometry:geometry,properties:properties})})});return{type:"FeatureCollection",features:features}}function pointGeometryFactory(lat,lon){return{type:"Point",coordinates:[lon,lat]}}function geoPointToGeometry(value){if(!value){return[]}if(typeof value==="string"){var commaSplit=value.split(",");if(commaSplit.length===1){var errorMessage=_i18n.i18n.translate("xpack.maps.elasticsearch_geo_utils.geohashIsUnsupportedErrorMessage",{defaultMessage:"Unable to convert to geojson, geohash not supported"});throw new Error(errorMessage)}var lat=parseFloat(commaSplit[0]);var lon=parseFloat(commaSplit[1]);return[pointGeometryFactory(lat,lon)]}if((typeof value==="undefined"?"undefined":_typeof(value))==="object"&&_lodash2.default.has(value,"lat")&&_lodash2.default.has(value,"lon")){return[pointGeometryFactory(value.lat,value.lon)]}if(!Array.isArray(value)){var _errorMessage=_i18n.i18n.translate("xpack.maps.elasticsearch_geo_utils.unsupportedGeoPointValueErrorMessage",{defaultMessage:"Unsupported geo_point value: {geoPointValue}",values:{geoPointValue:value}});throw new Error(_errorMessage)}if(value.length===2&&typeof value[0]==="number"&&typeof value[1]==="number"){var _lat=value[1];var _lon=value[0];return[pointGeometryFactory(_lat,_lon)]}return value.reduce(function(points,itemInValueArray){return points.concat(geoPointToGeometry(itemInValueArray))},[])}function makeGeohashGridPolygon(geohashGridFeature){var esBbox=geohashGridFeature.properties.geohash_meta.rectangle;return{type:"Polygon",coordinates:[[[esBbox[0][1],esBbox[0][0]],[esBbox[1][1],esBbox[1][0]],[esBbox[2][1],esBbox[2][0]],[esBbox[3][1],esBbox[3][0]],[esBbox[0][1],esBbox[0][0]]]]}}function geoShapeToGeometry(value){if(!value){return[]}if(Array.isArray(value)){return value.reduce(function(shapes,itemInValueArray){return shapes.concat(geoShapeToGeometry(itemInValueArray))},[])}if(typeof value==="string"){var errorMessage=_i18n.i18n.translate("xpack.maps.elasticsearch_geo_utils.wktIsUnsupportedErrorMessage",{defaultMessage:"Unable to convert WKT to geojson, not supported"});throw new Error(errorMessage)}var geoJson=_lodash2.default.cloneDeep(value);switch(geoJson.type){case"point":geoJson.type="Point";break;case"linestring":geoJson.type="LineString";break;case"polygon":geoJson.type="Polygon";break;case"multipoint":geoJson.type="MultiPoint";break;case"multilinestring":geoJson.type="MultiLineString";break;case"multipolygon":geoJson.type="MultiPolygon";break;case"geometrycollection":geoJson.type="GeometryCollection";break;case"envelope":case"circle":throw new Error("Unable to convert "+geoJson.type+" geometry to geojson, not supported")}return[geoJson]}var POLYGON_COORDINATES_EXTERIOR_INDEX=0;var TOP_LEFT_INDEX=0;var BOTTOM_RIGHT_INDEX=2;function createExtentFilter(mapExtent,geoFieldName,geoFieldType){var safePolygon=convertMapExtentToPolygon(mapExtent);if(geoFieldType==="geo_point"){var verticies=safePolygon.coordinates[POLYGON_COORDINATES_EXTERIOR_INDEX];return{geo_bounding_box:_defineProperty({},geoFieldName,{top_left:verticies[TOP_LEFT_INDEX],bottom_right:verticies[BOTTOM_RIGHT_INDEX]})}}else if(geoFieldType==="geo_shape"){return{geo_shape:_defineProperty({},geoFieldName,{shape:safePolygon,relation:"INTERSECTS"})}}else{var errorMessage=_i18n.i18n.translate("xpack.maps.elasticsearch_geo_utils.unsupportedGeoFieldTypeErrorMessage",{defaultMessage:"Unsupported field type, expected: geo_shape or geo_point, you provided: {geoFieldType}",values:{geoFieldType:geoFieldType}});throw new Error(errorMessage)}}function formatEnvelopeAsPolygon(_ref){var maxLat=_ref.maxLat,maxLon=_ref.maxLon,minLat=_ref.minLat,minLon=_ref.minLon;var left=minLon;var right=maxLon;var top=maxLat>90?90:maxLat;var bottom=minLat<-90?-90:minLat;var topLeft=[left,top];var bottomLeft=[left,bottom];var bottomRight=[right,bottom];var topRight=[right,top];return{type:"polygon",coordinates:[[topLeft,bottomLeft,bottomRight,topRight,topLeft]]}}function convertMapExtentToPolygon(_ref2){var maxLat=_ref2.maxLat,maxLon=_ref2.maxLon,minLat=_ref2.minLat,minLon=_ref2.minLon;var lonDelta=maxLon-minLon;if(lonDelta>=360){return formatEnvelopeAsPolygon({maxLat:maxLat,maxLon:180,minLat:minLat,minLon:-180})}if(maxLon>180){var overlapWestOfDateLine=maxLon-180;return formatEnvelopeAsPolygon({maxLat:maxLat,maxLon:-180+overlapWestOfDateLine,minLat:minLat,minLon:minLon})}if(minLon<-180){var overlapEastOfDateLine=Math.abs(minLon)-180;return formatEnvelopeAsPolygon({maxLat:maxLat,maxLon:maxLon,minLat:minLat,minLon:180-overlapEastOfDateLine})}return formatEnvelopeAsPolygon({maxLat:maxLat,maxLon:maxLon,minLat:minLat,minLon:minLon})}},548:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractTMSSource=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _source=__webpack_require__(1225);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AbstractTMSSource=exports.AbstractTMSSource=function(_AbstractSource){_inherits(AbstractTMSSource,_AbstractSource);function AbstractTMSSource(){_classCallCheck(this,AbstractTMSSource);return _possibleConstructorReturn(this,(AbstractTMSSource.__proto__||Object.getPrototypeOf(AbstractTMSSource)).apply(this,arguments))}_createClass(AbstractTMSSource,[{key:"getUrlTemplate",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:throw new Error("Should implement TMSSource#getUrlTemplate");case 1:case"end":return _context.stop()}}},_callee,this)}));function getUrlTemplate(){return _ref.apply(this,arguments)}return getUrlTemplate}()}]);return AbstractTMSSource}(_source.AbstractSource)},755:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractLayer=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _turf=__webpack_require__(759);var _turf2=_interopRequireDefault(_turf);var _booleanContains=__webpack_require__(1239);var _booleanContains2=_interopRequireDefault(_booleanContains);var _data_request=__webpack_require__(3333);var _constants=__webpack_require__(193);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SOURCE_UPDATE_REQUIRED=true;var NO_SOURCE_UPDATE_REQUIRED=false;var AbstractLayer=exports.AbstractLayer=function(){function AbstractLayer(_ref){var _this=this;var layerDescriptor=_ref.layerDescriptor,source=_ref.source,style=_ref.style;_classCallCheck(this,AbstractLayer);this.renderSourceSettingsEditor=function(_ref2){var onChange=_ref2.onChange;return _this._source.renderSourceSettingsEditor({onChange:onChange})};this._descriptor=AbstractLayer.createDescriptor(layerDescriptor);this._source=source;this._style=style;if(this._descriptor.__dataRequests){this._dataRequests=this._descriptor.__dataRequests.map(function(dataRequest){return new _data_request.DataRequest(dataRequest)})}else{this._dataRequests=[]}}_createClass(AbstractLayer,[{key:"destroy",value:function destroy(){if(this._source){this._source.destroy()}}},{key:"isJoinable",value:function isJoinable(){return this._source.isJoinable()}},{key:"supportsFitToBounds",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this._source.supportsFitToBounds();case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}},_callee,this)}));function supportsFitToBounds(){return _ref3.apply(this,arguments)}return supportsFitToBounds}()},{key:"getDisplayName",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!this._descriptor.label){_context2.next=2;break}return _context2.abrupt("return",this._descriptor.label);case 2:_context2.next=4;return this._source.getDisplayName();case 4:_context2.t0=_context2.sent;if(_context2.t0){_context2.next=7;break}_context2.t0="Layer "+this._descriptor.id;case 7:return _context2.abrupt("return",_context2.t0);case 8:case"end":return _context2.stop()}}},_callee2,this)}));function getDisplayName(){return _ref4.apply(this,arguments)}return getDisplayName}()},{key:"getAttributions",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(this.hasErrors()){_context3.next=4;break}_context3.next=3;return this._source.getAttributions();case 3:return _context3.abrupt("return",_context3.sent);case 4:return _context3.abrupt("return",[]);case 5:case"end":return _context3.stop()}}},_callee3,this)}));function getAttributions(){return _ref5.apply(this,arguments)}return getAttributions}()},{key:"getLabel",value:function getLabel(){return this._descriptor.label?this._descriptor.label:""}},{key:"getIcon",value:function getIcon(){console.warn("Icon not available for this layer type")}},{key:"getTOCDetails",value:function getTOCDetails(){return null}},{key:"getId",value:function getId(){return this._descriptor.id}},{key:"getSource",value:function getSource(){return this._source}},{key:"isVisible",value:function isVisible(){return this._descriptor.visible}},{key:"showAtZoomLevel",value:function showAtZoomLevel(zoom){if(zoom>=this._descriptor.minZoom&&zoom<=this._descriptor.maxZoom){return true}return false}},{key:"getMinZoom",value:function getMinZoom(){return this._descriptor.minZoom}},{key:"getMaxZoom",value:function getMaxZoom(){return this._descriptor.maxZoom}},{key:"getAlpha",value:function getAlpha(){return this._descriptor.alpha}},{key:"getZoomConfig",value:function getZoomConfig(){return{minZoom:this._descriptor.minZoom,maxZoom:this._descriptor.maxZoom}}},{key:"getSupportedStyles",value:function getSupportedStyles(){return[]}},{key:"getCurrentStyle",value:function getCurrentStyle(){return this._style}},{key:"getImmutableSourceProperties",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",this._source.getImmutableProperties());case 1:case"end":return _context4.stop()}}},_callee4,this)}));function getImmutableSourceProperties(){return _ref6.apply(this,arguments)}return getImmutableSourceProperties}()},{key:"getSourceDataRequest",value:function getSourceDataRequest(){return this._dataRequests.find(function(dataRequest){return dataRequest.getDataId()===_constants.SOURCE_DATA_ID_ORIGIN})}},{key:"isLayerLoading",value:function isLayerLoading(){return this._dataRequests.some(function(dataRequest){return dataRequest.isLoading()})}},{key:"hasErrors",value:function hasErrors(){return _lodash2.default.get(this._descriptor,"__isInErrorState",false)}},{key:"getErrors",value:function getErrors(){return this.hasErrors()?this._descriptor.__errorMessage:""}},{key:"toLayerDescriptor",value:function toLayerDescriptor(){return this._descriptor}},{key:"syncData",value:function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:case"end":return _context5.stop()}}},_callee5,this)}));function syncData(){return _ref7.apply(this,arguments)}return syncData}()},{key:"syncLayerWithMb",value:function syncLayerWithMb(){}},{key:"updateDueToExtent",value:function updateDueToExtent(source){var meta=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var dataFilters=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var extentAware=source.isFilterByMapBounds();if(!extentAware){return NO_SOURCE_UPDATE_REQUIRED}var previousBuffer=meta.buffer;var newBuffer=dataFilters.buffer;if(!previousBuffer){return SOURCE_UPDATE_REQUIRED}if(_lodash2.default.isEqual(previousBuffer,newBuffer)){return NO_SOURCE_UPDATE_REQUIRED}var previousBufferGeometry=_turf2.default.bboxPolygon([previousBuffer.minLon,previousBuffer.minLat,previousBuffer.maxLon,previousBuffer.maxLat]);var newBufferGeometry=_turf2.default.bboxPolygon([newBuffer.minLon,newBuffer.minLat,newBuffer.maxLon,newBuffer.maxLat]);var doesPreviousBufferContainNewBuffer=(0,_booleanContains2.default)(previousBufferGeometry,newBufferGeometry);var isTrimmed=_lodash2.default.get(meta,"areResultsTrimmed",false);return doesPreviousBufferContainNewBuffer&&!isTrimmed?NO_SOURCE_UPDATE_REQUIRED:SOURCE_UPDATE_REQUIRED}},{key:"getLayerTypeIconName",value:function getLayerTypeIconName(){throw new Error("should implement Layer#getLayerTypeIconName")}},{key:"getBounds",value:function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt("return",{min_lon:-180,max_lon:180,min_lat:-89,max_lat:89});case 1:case"end":return _context6.stop()}}},_callee6,this)}));function getBounds(){return _ref8.apply(this,arguments)}return getBounds}()},{key:"renderStyleEditor",value:function renderStyleEditor(style,options){return style.renderEditor(options)}},{key:"getIndexPatternIds",value:function getIndexPatternIds(){return[]}},{key:"getOrdinalFields",value:function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt("return",[]);case 1:case"end":return _context7.stop()}}},_callee7,this)}));function getOrdinalFields(){return _ref9.apply(this,arguments)}return getOrdinalFields}()}],[{key:"getBoundDataForSource",value:function getBoundDataForSource(mbMap,sourceId){var mbStyle=mbMap.getStyle();return mbStyle.sources[sourceId].data}},{key:"createDescriptor",value:function createDescriptor(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var layerDescriptor=_extends({},options);layerDescriptor.__dataRequests=_lodash2.default.get(options,"__dataRequests",[]);layerDescriptor.id=_lodash2.default.get(options,"id",Math.random().toString(36).substr(2,5));layerDescriptor.label=options.label&&options.label.length>0?options.label:null;layerDescriptor.minZoom=_lodash2.default.get(options,"minZoom",0);layerDescriptor.maxZoom=_lodash2.default.get(options,"maxZoom",24);layerDescriptor.alpha=_lodash2.default.get(options,"alpha",.75);layerDescriptor.visible=_lodash2.default.get(options,"visible",true);layerDescriptor.style=_lodash2.default.get(options,"style",{});return layerDescriptor}}]);return AbstractLayer}()},757:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var AbstractStyle=exports.AbstractStyle=function(){function AbstractStyle(){_classCallCheck(this,AbstractStyle)}_createClass(AbstractStyle,[{key:"getDescriptorWithMissingStylePropsRemoved",value:function getDescriptorWithMissingStylePropsRemoved(){return{hasChanges:false}}}]);return AbstractStyle}()},758:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VectorLayer=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _mapboxGl=__webpack_require__(760);var _mapboxGl2=_interopRequireDefault(_mapboxGl);var _turf=__webpack_require__(759);var _turf2=_interopRequireDefault(_turf);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _layer=__webpack_require__(755);var _vector_style=__webpack_require__(332);var _left_inner_join=__webpack_require__(3344);var _constants=__webpack_require__(193);var _feature_tooltip=__webpack_require__(3346);var _store=__webpack_require__(1227);var _map_selectors=__webpack_require__(192);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EMPTY_FEATURE_COLLECTION={type:"FeatureCollection",features:[]};var CLOSED_SHAPE_MB_FILTER=["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]];var ALL_SHAPE_MB_FILTER=["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"],["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"]];var VectorLayer=exports.VectorLayer=function(_AbstractLayer){_inherits(VectorLayer,_AbstractLayer);_createClass(VectorLayer,null,[{key:"createDescriptor",value:function createDescriptor(options){var layerDescriptor=_get(VectorLayer.__proto__||Object.getPrototypeOf(VectorLayer),"createDescriptor",this).call(this,options);layerDescriptor.type=VectorLayer.type;if(!options.style){var mapColors=(0,_map_selectors.getMapColors)((0,_store.getStore)().getState());var styleProperties=_vector_style.VectorStyle.createDefaultStyleProperties(mapColors);layerDescriptor.style=_vector_style.VectorStyle.createDescriptor(styleProperties)}return layerDescriptor}}]);function VectorLayer(options){_classCallCheck(this,VectorLayer);var _this=_possibleConstructorReturn(this,(VectorLayer.__proto__||Object.getPrototypeOf(VectorLayer)).call(this,options));_this._joins=[];if(options.layerDescriptor.joins){options.layerDescriptor.joins.forEach(function(joinDescriptor){_this._joins.push(new _left_inner_join.LeftInnerJoin(joinDescriptor))})}return _this}_createClass(VectorLayer,[{key:"destroy",value:function destroy(){if(this._source){this._source.destroy()}this._joins.forEach(function(joinSource){joinSource.destroy()})}},{key:"getJoins",value:function getJoins(){return this._joins.slice()}},{key:"getValidJoins",value:function getValidJoins(){return this._joins.filter(function(join){return join.hasCompleteConfig()})}},{key:"getSupportedStyles",value:function getSupportedStyles(){return[_vector_style.VectorStyle]}},{key:"getIcon",value:function getIcon(){var isPointsOnly=this._isPointsOnly();return this._style.getIcon(isPointsOnly)}},{key:"getLayerTypeIconName",value:function getLayerTypeIconName(){return"vector"}},{key:"getTOCDetails",value:function getTOCDetails(){return this._style.getTOCDetails()}},{key:"_getBoundsBasedOnData",value:function _getBoundsBasedOnData(){var featureCollection=this._getSourceFeatureCollection();if(!featureCollection){return null}var bbox=_turf2.default.bbox(featureCollection);return{min_lon:bbox[0],min_lat:bbox[1],max_lon:bbox[2],max_lat:bbox[3]}}},{key:"getBounds",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(filters){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!this._source.isBoundsAware()){_context.next=4;break}_context.next=3;return this._source.getBoundsForFilters(filters);case 3:return _context.abrupt("return",_context.sent);case 4:return _context.abrupt("return",this._getBoundsBasedOnData());case 5:case"end":return _context.stop()}}},_callee,this)}));function getBounds(_x){return _ref.apply(this,arguments)}return getBounds}()},{key:"getStringFields",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this._source.getStringFields();case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop()}}},_callee2,this)}));function getStringFields(){return _ref2.apply(this,arguments)}return getStringFields}()},{key:"getSourceName",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",this._source.getDisplayName());case 1:case"end":return _context3.stop()}}},_callee3,this)}));function getSourceName(){return _ref3.apply(this,arguments)}return getSourceName}()},{key:"getOrdinalFields",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var numberFields,numberFieldOptions,joinFields;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this._source.getNumberFields();case 2:numberFields=_context4.sent;numberFieldOptions=numberFields.map(function(_ref5){var label=_ref5.label,name=_ref5.name;return{label:label,name:name,origin:_constants.SOURCE_DATA_ID_ORIGIN}});joinFields=[];this.getValidJoins().forEach(function(join){var fields=join.getJoinFields().map(function(joinField){return _extends({},joinField,{origin:"join"})});joinFields.push.apply(joinFields,_toConsumableArray(fields))});return _context4.abrupt("return",[].concat(_toConsumableArray(numberFieldOptions),joinFields));case 7:case"end":return _context4.stop()}}},_callee4,this)}));function getOrdinalFields(){return _ref4.apply(this,arguments)}return getOrdinalFields}()},{key:"getIndexPatternIds",value:function getIndexPatternIds(){var indexPatternIds=this._source.getIndexPatternIds();this.getValidJoins().forEach(function(join){indexPatternIds.push.apply(indexPatternIds,_toConsumableArray(join.getIndexPatternIds()))});return indexPatternIds}},{key:"_findDataRequestForSource",value:function _findDataRequestForSource(sourceDataId){return this._dataRequests.find(function(dataRequest){return dataRequest.getDataId()===sourceDataId})}},{key:"_canSkipSourceUpdate",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(source,sourceDataId,searchFilters){var timeAware,refreshTimerAware,extentAware,isFieldAware,isQueryAware,isGeoGridPrecisionAware,_sourceDataRequest,sourceDataRequest,meta,updateDueToTime,updateDueToRefreshTimer,updateDueToFields,updateDueToQuery,updateDueToPrecisionChange,updateDueToExtentChange;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return source.isTimeAware();case 2:timeAware=_context5.sent;_context5.next=5;return source.isRefreshTimerAware();case 5:refreshTimerAware=_context5.sent;extentAware=source.isFilterByMapBounds();isFieldAware=source.isFieldAware();isQueryAware=source.isQueryAware();isGeoGridPrecisionAware=source.isGeoGridPrecisionAware();if(!(!timeAware&&!refreshTimerAware&&!extentAware&&!isFieldAware&&!isQueryAware&&!isGeoGridPrecisionAware)){_context5.next=15;break}_sourceDataRequest=this._findDataRequestForSource(sourceDataId);if(!(_sourceDataRequest&&_sourceDataRequest.hasDataOrRequestInProgress())){_context5.next=14;break}return _context5.abrupt("return",true);case 14:return _context5.abrupt("return",false);case 15:sourceDataRequest=this._findDataRequestForSource(sourceDataId);if(sourceDataRequest){_context5.next=18;break}return _context5.abrupt("return",false);case 18:meta=sourceDataRequest.getMeta();if(meta){_context5.next=21;break}return _context5.abrupt("return",false);case 21:updateDueToTime=false;if(timeAware){updateDueToTime=!_lodash2.default.isEqual(meta.timeFilters,searchFilters.timeFilters)}updateDueToRefreshTimer=false;if(refreshTimerAware&&searchFilters.refreshTimerLastTriggeredAt){updateDueToRefreshTimer=!_lodash2.default.isEqual(meta.refreshTimerLastTriggeredAt,searchFilters.refreshTimerLastTriggeredAt)}updateDueToFields=false;if(isFieldAware){updateDueToFields=!_lodash2.default.isEqual(meta.fieldNames,searchFilters.fieldNames)}updateDueToQuery=false;if(isQueryAware){updateDueToQuery=!_lodash2.default.isEqual(meta.query,searchFilters.query)}updateDueToPrecisionChange=false;if(isGeoGridPrecisionAware){updateDueToPrecisionChange=!_lodash2.default.isEqual(meta.geogridPrecision,searchFilters.geogridPrecision)}updateDueToExtentChange=this.updateDueToExtent(source,meta,searchFilters);return _context5.abrupt("return",!updateDueToTime&&!updateDueToRefreshTimer&&!updateDueToExtentChange&&!updateDueToFields&&!updateDueToQuery&&!updateDueToPrecisionChange);case 33:case"end":return _context5.stop()}}},_callee5,this)}));function _canSkipSourceUpdate(_x2,_x3,_x4){return _ref6.apply(this,arguments)}return _canSkipSourceUpdate}()},{key:"_syncJoin",value:function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(join,_ref7){var startLoading=_ref7.startLoading,stopLoading=_ref7.stopLoading,onLoadError=_ref7.onLoadError,dataFilters=_ref7.dataFilters;var joinSource,sourceDataId,requestToken,canSkip,sourceDataRequest,_propertiesMap,leftSourceName,_ref9,propertiesMap;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:joinSource=join.getJoinSource();sourceDataId=join.getSourceId();requestToken=Symbol("layer-join-refresh:"+this.getId()+" - "+sourceDataId);_context6.prev=3;_context6.next=6;return this._canSkipSourceUpdate(joinSource,sourceDataId,dataFilters);case 6:canSkip=_context6.sent;if(!canSkip){_context6.next=11;break}sourceDataRequest=this._findDataRequestForSource(sourceDataId);_propertiesMap=sourceDataRequest?sourceDataRequest.getData():null;return _context6.abrupt("return",{dataHasChanged:false,join:join,propertiesMap:_propertiesMap});case 11:startLoading(sourceDataId,requestToken,dataFilters);_context6.next=14;return this.getSourceName();case 14:leftSourceName=_context6.sent;_context6.next=17;return joinSource.getPropertiesMap(dataFilters,leftSourceName,join.getLeftFieldName());case 17:_ref9=_context6.sent;propertiesMap=_ref9.propertiesMap;stopLoading(sourceDataId,requestToken,propertiesMap);return _context6.abrupt("return",{dataHasChanged:true,join:join,propertiesMap:propertiesMap});case 23:_context6.prev=23;_context6.t0=_context6["catch"](3);onLoadError(sourceDataId,requestToken,"Join error: "+_context6.t0.message);return _context6.abrupt("return",{dataHasChanged:false,join:join,propertiesMap:null});case 27:case"end":return _context6.stop()}}},_callee6,this,[[3,23]])}));function _syncJoin(_x5,_x6){return _ref8.apply(this,arguments)}return _syncJoin}()},{key:"_syncJoins",value:function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(_ref10){var _this2=this;var startLoading=_ref10.startLoading,stopLoading=_ref10.stopLoading,onLoadError=_ref10.onLoadError,dataFilters=_ref10.dataFilters;var joinSyncs;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:joinSyncs=this.getValidJoins().map(function(){var _ref12=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(join){return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt("return",_this2._syncJoin(join,{startLoading:startLoading,stopLoading:stopLoading,onLoadError:onLoadError,dataFilters:dataFilters}));case 1:case"end":return _context7.stop()}}},_callee7,_this2)}));return function(_x8){return _ref12.apply(this,arguments)}}());_context8.next=3;return Promise.all(joinSyncs);case 3:return _context8.abrupt("return",_context8.sent);case 4:case"end":return _context8.stop()}}},_callee8,this)}));function _syncJoins(_x7){return _ref11.apply(this,arguments)}return _syncJoins}()},{key:"_getSearchFilters",value:function _getSearchFilters(dataFilters){var fieldNames=[].concat(_toConsumableArray(this._source.getFieldNames()),_toConsumableArray(this._style.getSourceFieldNames()),_toConsumableArray(this.getValidJoins().map(function(join){return join.getLeftFieldName()})));return _extends({},dataFilters,{fieldNames:_lodash2.default.uniq(fieldNames).sort(),geogridPrecision:this._source.getGeoGridPrecision(dataFilters.zoom)})}},{key:"_syncSource",value:function(){var _ref14=_asyncToGenerator(regeneratorRuntime.mark(function _callee9(_ref13){var startLoading=_ref13.startLoading,stopLoading=_ref13.stopLoading,onLoadError=_ref13.onLoadError,dataFilters=_ref13.dataFilters;var requestToken,searchFilters,canSkip,sourceDataRequest,layerName,_ref15,data,meta;return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:requestToken=Symbol("layer-source-refresh:"+this.getId()+" - source");searchFilters=this._getSearchFilters(dataFilters);_context9.next=4;return this._canSkipSourceUpdate(this._source,_constants.SOURCE_DATA_ID_ORIGIN,searchFilters);case 4:canSkip=_context9.sent;if(!canSkip){_context9.next=8;break}sourceDataRequest=this.getSourceDataRequest();return _context9.abrupt("return",{refreshed:false,featureCollection:sourceDataRequest.getData()});case 8:_context9.prev=8;startLoading(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,searchFilters);_context9.next=12;return this.getDisplayName();case 12:layerName=_context9.sent;_context9.next=15;return this._source.getGeoJsonWithMeta({layerName:layerName},searchFilters);case 15:_ref15=_context9.sent;data=_ref15.data;meta=_ref15.meta;stopLoading(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,data,meta);return _context9.abrupt("return",{refreshed:true,featureCollection:data});case 22:_context9.prev=22;_context9.t0=_context9["catch"](8);onLoadError(_constants.SOURCE_DATA_ID_ORIGIN,requestToken,_context9.t0.message);return _context9.abrupt("return",{refreshed:false});case 26:case"end":return _context9.stop()}}},_callee9,this,[[8,22]])}));function _syncSource(_x9){return _ref14.apply(this,arguments)}return _syncSource}()},{key:"_joinToFeatureCollection",value:function _joinToFeatureCollection(sourceResult,joinState,updateSourceData){if(!sourceResult.refreshed&&!joinState.dataHasChanged){return false}if(!sourceResult.featureCollection||!joinState.propertiesMap){return false}var updatedFeatureCollection=joinState.join.joinPropertiesToFeatureCollection(sourceResult.featureCollection,joinState.propertiesMap);updateSourceData(updatedFeatureCollection);return true}},{key:"_performJoins",value:function(){var _ref16=_asyncToGenerator(regeneratorRuntime.mark(function _callee10(sourceResult,joinStates,updateSourceData){var _this3=this;var hasJoined;return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:hasJoined=joinStates.map(function(joinState){return _this3._joinToFeatureCollection(sourceResult,joinState,updateSourceData)});return _context10.abrupt("return",hasJoined.some(function(shouldRefresh){return shouldRefresh===true}));case 2:case"end":return _context10.stop()}}},_callee10,this)}));function _performJoins(_x10,_x11,_x12){return _ref16.apply(this,arguments)}return _performJoins}()},{key:"syncData",value:function(){var _ref18=_asyncToGenerator(regeneratorRuntime.mark(function _callee11(_ref17){var startLoading=_ref17.startLoading,stopLoading=_ref17.stopLoading,onLoadError=_ref17.onLoadError,onRefreshStyle=_ref17.onRefreshStyle,dataFilters=_ref17.dataFilters,updateSourceData=_ref17.updateSourceData;var sourceResult,joinResults,shouldRefresh;return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(!(!this.isVisible()||!this.showAtZoomLevel(dataFilters.zoom))){_context11.next=2;break}return _context11.abrupt("return");case 2:_context11.next=4;return this._syncSource({startLoading:startLoading,stopLoading:stopLoading,onLoadError:onLoadError,dataFilters:dataFilters});case 4:sourceResult=_context11.sent;_context11.next=7;return this._syncJoins({startLoading:startLoading,stopLoading:stopLoading,onLoadError:onLoadError,dataFilters:dataFilters});case 7:joinResults=_context11.sent;_context11.next=10;return this._performJoins(sourceResult,joinResults,updateSourceData);case 10:shouldRefresh=_context11.sent;if(shouldRefresh){onRefreshStyle()}case 12:case"end":return _context11.stop()}}},_callee11,this)}));function syncData(_x13){return _ref18.apply(this,arguments)}return syncData}()},{key:"_getSourceFeatureCollection",value:function _getSourceFeatureCollection(){var sourceDataRequest=this.getSourceDataRequest();return sourceDataRequest?sourceDataRequest.getData():null}},{key:"_isPointsOnly",value:function _isPointsOnly(){var featureCollection=this._getSourceFeatureCollection();if(!featureCollection){return false}var isPointsOnly=true;if(featureCollection){for(var i=0;i<featureCollection.features.length;i++){if(featureCollection.features[i].geometry.type!=="Point"){isPointsOnly=false;break}}}else{isPointsOnly=false}return isPointsOnly}},{key:"_syncFeatureCollectionWithMb",value:function _syncFeatureCollectionWithMb(mbMap){var mbGeoJSONSource=mbMap.getSource(this.getId());var featureCollection=this._getSourceFeatureCollection();if(!featureCollection){mbGeoJSONSource.setData(EMPTY_FEATURE_COLLECTION);return}var dataBoundToMap=_layer.AbstractLayer.getBoundDataForSource(mbMap,this.getId());if(featureCollection!==dataBoundToMap){mbGeoJSONSource.setData(featureCollection)}var shouldRefresh=this._style.addScaledPropertiesBasedOnStyle(featureCollection);if(shouldRefresh){mbGeoJSONSource.setData(featureCollection)}}},{key:"_setMbPointsProperties",value:function _setMbPointsProperties(mbMap){var sourceId=this.getId();var pointLayerId=this.getId()+"_circle";var pointLayer=mbMap.getLayer(pointLayerId);if(!pointLayer){mbMap.addLayer({id:pointLayerId,type:"circle",source:sourceId,paint:{}});mbMap.setFilter(pointLayerId,["any",["==",["geometry-type"],"Point"],["==",["geometry-type"],"MultiPoint"]])}this._style.setMBPaintPropertiesForPoints({alpha:this.getAlpha(),mbMap:mbMap,pointLayerId:pointLayerId});mbMap.setLayoutProperty(pointLayerId,"visibility",this.isVisible()?"visible":"none");mbMap.setLayerZoomRange(pointLayerId,this._descriptor.minZoom,this._descriptor.maxZoom);this._addTooltipListeners(mbMap,pointLayerId)}},{key:"_setMbLinePolygonProperties",value:function _setMbLinePolygonProperties(mbMap){var sourceId=this.getId();var fillLayerId=this.getId()+"_fill";var lineLayerId=this.getId()+"_line";if(!mbMap.getLayer(fillLayerId)){mbMap.addLayer({id:fillLayerId,type:"fill",source:sourceId,paint:{}});mbMap.setFilter(fillLayerId,CLOSED_SHAPE_MB_FILTER)}if(!mbMap.getLayer(lineLayerId)){mbMap.addLayer({id:lineLayerId,type:"line",source:sourceId,paint:{}});mbMap.setFilter(lineLayerId,ALL_SHAPE_MB_FILTER)}this._style.setMBPaintProperties({alpha:this.getAlpha(),mbMap:mbMap,fillLayerId:fillLayerId,lineLayerId:lineLayerId});mbMap.setLayoutProperty(fillLayerId,"visibility",this.isVisible()?"visible":"none");mbMap.setLayoutProperty(lineLayerId,"visibility",this.isVisible()?"visible":"none");mbMap.setLayerZoomRange(lineLayerId,this._descriptor.minZoom,this._descriptor.maxZoom);mbMap.setLayerZoomRange(fillLayerId,this._descriptor.minZoom,this._descriptor.maxZoom);this._addTooltipListeners(mbMap,lineLayerId);this._addTooltipListeners(mbMap,fillLayerId)}},{key:"_syncStylePropertiesWithMb",value:function _syncStylePropertiesWithMb(mbMap){this._setMbPointsProperties(mbMap);this._setMbLinePolygonProperties(mbMap)}},{key:"_syncSourceBindingWithMb",value:function _syncSourceBindingWithMb(mbMap){var mbSource=mbMap.getSource(this.getId());if(!mbSource){mbMap.addSource(this.getId(),{type:"geojson",data:EMPTY_FEATURE_COLLECTION})}}},{key:"syncLayerWithMB",value:function syncLayerWithMB(mbMap){this._syncSourceBindingWithMb(mbMap);this._syncFeatureCollectionWithMb(mbMap);this._syncStylePropertiesWithMb(mbMap)}},{key:"renderStyleEditor",value:function renderStyleEditor(Style,options){return Style.renderEditor(_extends({layer:this},options))}},{key:"_canShowTooltips",value:function _canShowTooltips(){return this._source.canFormatFeatureProperties()}},{key:"_getPropertiesForTooltip",value:function(){var _ref19=_asyncToGenerator(regeneratorRuntime.mark(function _callee12(feature){var tooltipsFromSource,allProps;return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return this._source.filterAndFormatProperties(feature.properties);case 2:tooltipsFromSource=_context12.sent;allProps=this._joins.reduce(function(acc,join){var propsFromJoin=join.filterAndFormatPropertiesForTooltip(feature.properties);return _extends({},propsFromJoin,acc)},_extends({},tooltipsFromSource));return _context12.abrupt("return",allProps);case 5:case"end":return _context12.stop()}}},_callee12,this)}));function _getPropertiesForTooltip(_x14){return _ref19.apply(this,arguments)}return _getPropertiesForTooltip}()},{key:"_addTooltipListeners",value:function _addTooltipListeners(mbMap,mbLayerId){var _this4=this;if(!this._canShowTooltips()){return}var showTooltip=function(){var _ref20=_asyncToGenerator(regeneratorRuntime.mark(function _callee13(feature,eventLngLat){var popupAnchorLocation,coordinates,properties;return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:popupAnchorLocation=eventLngLat;if(feature.geometry.type==="Point"){coordinates=feature.geometry.coordinates.slice();while(Math.abs(eventLngLat.lng-coordinates[0])>180){coordinates[0]+=eventLngLat.lng>coordinates[0]?360:-360}popupAnchorLocation=coordinates}_context13.next=4;return _this4._getPropertiesForTooltip(feature);case 4:properties=_context13.sent;_reactDom2.default.render(_react2.default.createElement(_feature_tooltip.FeatureTooltip,{properties:properties}),VectorLayer.tooltipContainer);VectorLayer.popup.setLngLat(popupAnchorLocation).setDOMContent(VectorLayer.tooltipContainer).addTo(mbMap);case 7:case"end":return _context13.stop()}}},_callee13,_this4)}));return function showTooltip(_x15,_x16){return _ref20.apply(this,arguments)}}();var activeFeature=void 0;var isTooltipOpen=false;mbMap.on("mousemove",mbLayerId,_lodash2.default.debounce(function(e){if(!isTooltipOpen){return}var PADDING=2;var mbBbox=[{x:e.point.x-PADDING,y:e.point.y-PADDING},{x:e.point.x+PADDING,y:e.point.y+PADDING}];var features=mbMap.queryRenderedFeatures(mbBbox).filter(function(feature){return feature.layer.source===_this4.getId()});if(features.length===0){return}var propertiesUnchanged=_lodash2.default.isEqual(activeFeature.properties,features[0].properties);var geometryUnchanged=_lodash2.default.isEqual(activeFeature.geometry,features[0].geometry);if(propertiesUnchanged&&geometryUnchanged){return}activeFeature=features[0];showTooltip(activeFeature,e.lngLat)},100));mbMap.on("mouseenter",mbLayerId,function(e){isTooltipOpen=true;mbMap.getCanvas().style.cursor="pointer";activeFeature=e.features[0];showTooltip(activeFeature,e.lngLat)});mbMap.on("mouseleave",mbLayerId,function(){isTooltipOpen=false;mbMap.getCanvas().style.cursor="";VectorLayer.popup.remove();_reactDom2.default.unmountComponentAtNode(VectorLayer.tooltipContainer)})}}]);return VectorLayer}(_layer.AbstractLayer);VectorLayer.type="VECTOR";VectorLayer.popup=new _mapboxGl2.default.Popup({closeButton:false,closeOnClick:false});VectorLayer.tooltipContainer=document.createElement("div")},759:function(module,exports,__webpack_require__){module.exports=__webpack_require__(10)(3827)},760:function(module,exports,__webpack_require__){module.exports=__webpack_require__(10)(3037)},761:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ValidatedRange=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(1);var _react3=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function isWithinRange(min,max,value){if(value>=min&&value<=max){return true}return false}var ValidatedRange=exports.ValidatedRange=function(_React$Component){_inherits(ValidatedRange,_React$Component);function ValidatedRange(){var _ref;var _temp,_this,_ret;_classCallCheck(this,ValidatedRange);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ValidatedRange.__proto__||Object.getPrototypeOf(ValidatedRange)).call.apply(_ref,[this].concat(args))),_this),_this.state={},_this._onRangeChange=function(e){var sanitizedValue=parseFloat(e.target.value,10);var newValue=isNaN(sanitizedValue)?"":sanitizedValue;newValue=Number(newValue);var isValid=isWithinRange(_this.props.min,_this.props.max,newValue)?true:false;_this.setState({value:newValue,isValid:isValid});if(isValid){_this.props.onChange(newValue)}},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(ValidatedRange,[{key:"render",value:function render(){var _props=this.props,max=_props.max,min=_props.min,value=_props.value,onChange=_props.onChange,rest=_objectWithoutProperties(_props,["max","min","value","onChange"]);var errorMessage=void 0;if(!this.state.isValid){errorMessage=_react2.default.createElement(_eui.EuiFormErrorText,null,_react2.default.createElement(_react3.FormattedText,{id:"xpack.maps.validatedRange.rangeErrorMessage",defaultMessage:"Must be between {min} and {max}",values:{min:min,max:max}}))}return _react2.default.createElement(_react.Fragment,null,_react2.default.createElement(_eui.EuiRange,_extends({min:min,max:max,value:this.state.value.toString(),onChange:this._onRangeChange},rest)),errorMessage)}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){if(nextProps.value!==prevState.prevValue){return{value:nextProps.value,prevValue:nextProps.value,isValid:isWithinRange(nextProps.min,nextProps.max,nextProps.value)}}return null}}]);return ValidatedRange}(_react2.default.Component)},762:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DEFAULT_MAX_SIZE=exports.DEFAULT_MIN_SIZE=undefined;exports.getDefaultStaticProperties=getDefaultStaticProperties;exports.getDefaultDynamicProperties=getDefaultDynamicProperties;var _vector_style=__webpack_require__(332);var _color_ramp_select=__webpack_require__(1224);var DEFAULT_COLORS=["#e6194b","#3cb44b","#ffe119","#f58231","#911eb4"];var DEFAULT_MIN_SIZE=exports.DEFAULT_MIN_SIZE=1;var DEFAULT_MAX_SIZE=exports.DEFAULT_MAX_SIZE=64;function getDefaultStaticProperties(){var mapColors=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var lastColor=mapColors.pop();var nextColorIndex=(DEFAULT_COLORS.indexOf(lastColor)+1)%(DEFAULT_COLORS.length-1);var nextColor=DEFAULT_COLORS[nextColorIndex];return{fillColor:{type:_vector_style.VectorStyle.STYLE_TYPE.STATIC,options:{color:nextColor}},lineColor:{type:_vector_style.VectorStyle.STYLE_TYPE.STATIC,options:{color:"#FFFFFF"}},lineWidth:{type:_vector_style.VectorStyle.STYLE_TYPE.STATIC,options:{size:1}},iconSize:{type:_vector_style.VectorStyle.STYLE_TYPE.STATIC,options:{size:10}}}}function getDefaultDynamicProperties(){return{fillColor:{type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:{color:_color_ramp_select.COLOR_GRADIENTS[0].value}},lineColor:{type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:{color:_color_ramp_select.COLOR_GRADIENTS[0].value}},lineWidth:{type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:{minSize:DEFAULT_MIN_SIZE,maxSize:64}},iconSize:{type:_vector_style.VectorStyle.STYLE_TYPE.DYNAMIC,options:{minSize:DEFAULT_MIN_SIZE,maxSize:DEFAULT_MAX_SIZE}}}}},763:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractESSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _vector_source=__webpack_require__(764);var _kibana_services=__webpack_require__(227);var _elasticsearch_geo_utils=__webpack_require__(547);var _timefilter=__webpack_require__(490);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _agg_configs=__webpack_require__(497);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AbstractESSource=exports.AbstractESSource=function(_AbstractVectorSource){_inherits(AbstractESSource,_AbstractVectorSource);function AbstractESSource(descriptor){_classCallCheck(this,AbstractESSource);return _possibleConstructorReturn(this,(AbstractESSource.__proto__||Object.getPrototypeOf(AbstractESSource)).call(this,descriptor))}_createClass(AbstractESSource,[{key:"isFieldAware",value:function isFieldAware(){return true}},{key:"isRefreshTimerAware",value:function isRefreshTimerAware(){return true}},{key:"isQueryAware",value:function isQueryAware(){return true}},{key:"getIndexPatternIds",value:function getIndexPatternIds(){return[this._descriptor.indexPatternId]}},{key:"destroy",value:function destroy(){_kibana_services.inspectorAdapters.requests.resetRequest(this._descriptor.id)}},{key:"_getValidMetrics",value:function _getValidMetrics(){var metrics=_lodash2.default.get(this._descriptor,"metrics",[]).filter(function(_ref){var type=_ref.type,field=_ref.field;if(type==="count"){return true}if(field){return true}return false});if(metrics.length===0){metrics.push({type:"count"})}return metrics}},{key:"_formatMetricKey",value:function _formatMetricKey(){throw new Error("should implement")}},{key:"_formatMetricLabel",value:function _formatMetricLabel(){throw new Error("should implement")}},{key:"getMetricFields",value:function getMetricFields(){var _this2=this;return this._getValidMetrics().map(function(metric){var metricKey=_this2._formatMetricKey(metric);var metricLabel=_this2._formatMetricLabel(metric);return _extends({},metric,{propertyKey:metricKey,propertyLabel:metricLabel})})}},{key:"_runEsQuery",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(layerName,searchSource,requestDescription){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return(0,_kibana_services.fetchSearchSourceAndRecordWithInspector)({searchSource:searchSource,requestName:layerName,requestId:this._descriptor.id,requestDesc:requestDescription});case 3:return _context.abrupt("return",_context.sent);case 6:_context.prev=6;_context.t0=_context["catch"](0);throw new Error("xpack.maps.source.esSource.requestFailedErrorMessage",{defaultMessage:"Elasticsearch search request failed, error: {message}",values:{message:_context.t0.message}});case 9:case"end":return _context.stop()}}},_callee,this,[[0,6]])}));function _runEsQuery(_x,_x2,_x3){return _ref2.apply(this,arguments)}return _runEsQuery}()},{key:"_makeSearchSource",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(_ref3,limit){var _this3=this;var buffer=_ref3.buffer,query=_ref3.query,timeFilters=_ref3.timeFilters;var indexPattern,geoField,isTimeAware,searchSource;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this._getIndexPattern();case 2:indexPattern=_context2.sent;_context2.next=5;return this._getGeoField();case 5:geoField=_context2.sent;_context2.next=8;return this.isTimeAware();case 8:isTimeAware=_context2.sent;searchSource=new _kibana_services.SearchSource;searchSource.setField("index",indexPattern);searchSource.setField("size",limit);searchSource.setField("filter",function(){var filters=[];if(_this3.isFilterByMapBounds()&&buffer){filters.push((0,_elasticsearch_geo_utils.createExtentFilter)(buffer,geoField.name,geoField.type))}if(isTimeAware){filters.push(_timefilter.timefilter.createFilter(indexPattern,timeFilters))}return filters});searchSource.setField("query",query);return _context2.abrupt("return",searchSource);case 15:case"end":return _context2.stop()}}},_callee2,this)}));function _makeSearchSource(_x4,_x5){return _ref4.apply(this,arguments)}return _makeSearchSource}()},{key:"getBoundsForFilters",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(_ref5){var query=_ref5.query,timeFilters=_ref5.timeFilters;var searchSource,geoField,indexPattern,geoBoundsAgg,aggConfigs,esBounds,esResp;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this._makeSearchSource({query:query,timeFilters:timeFilters},0);case 2:searchSource=_context3.sent;_context3.next=5;return this._getGeoField();case 5:geoField=_context3.sent;_context3.next=8;return this._getIndexPattern();case 8:indexPattern=_context3.sent;geoBoundsAgg=[{type:"geo_bounds",enabled:true,params:{field:geoField},schema:"metric"}];aggConfigs=new _agg_configs.AggConfigs(indexPattern,geoBoundsAgg);searchSource.setField("aggs",aggConfigs.toDsl());esBounds=void 0;_context3.prev=13;_context3.next=16;return searchSource.fetch();case 16:esResp=_context3.sent;esBounds=_lodash2.default.get(esResp,"aggregations.1.bounds");_context3.next=23;break;case 20:_context3.prev=20;_context3.t0=_context3["catch"](13);esBounds={top_left:{lat:90,lon:-180},bottom_right:{lat:-90,lon:180}};case 23:return _context3.abrupt("return",{min_lon:esBounds.top_left.lon,max_lon:esBounds.bottom_right.lon,min_lat:esBounds.bottom_right.lat,max_lat:esBounds.top_left.lat});case 24:case"end":return _context3.stop()}}},_callee3,this,[[13,20]])}));function getBoundsForFilters(_x6){return _ref6.apply(this,arguments)}return getBoundsForFilters}()},{key:"isTimeAware",value:function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var indexPattern,timeField;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return this._getIndexPattern();case 3:indexPattern=_context4.sent;timeField=indexPattern.timeFieldName;return _context4.abrupt("return",!!timeField);case 8:_context4.prev=8;_context4.t0=_context4["catch"](0);return _context4.abrupt("return",false);case 11:case"end":return _context4.stop()}}},_callee4,this,[[0,8]])}));function isTimeAware(){return _ref7.apply(this,arguments)}return isTimeAware}()},{key:"_getIndexPattern",value:function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!this.indexPattern){_context5.next=2;break}return _context5.abrupt("return",this.indexPattern);case 2:_context5.prev=2;_context5.next=5;return _kibana_services.indexPatternService.get(this._descriptor.indexPatternId);case 5:this.indexPattern=_context5.sent;return _context5.abrupt("return",this.indexPattern);case 9:_context5.prev=9;_context5.t0=_context5["catch"](2);throw new Error(_i18n.i18n.translate("xpack.maps.source.esSource.noIndexPatternErrorMessage",{defaultMessage:"Unable to find Index pattern for id: {indexPatternId}",values:{indexPatternId:this._descriptor.indexPatternId}}));case 12:case"end":return _context5.stop()}}},_callee5,this,[[2,9]])}));function _getIndexPattern(){return _ref8.apply(this,arguments)}return _getIndexPattern}()},{key:"supportsFitToBounds",value:function(){var _ref9=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var geoField;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return this._getGeoField();case 3:geoField=_context6.sent;return _context6.abrupt("return",geoField.type!=="geo_shape");case 7:_context6.prev=7;_context6.t0=_context6["catch"](0);return _context6.abrupt("return",false);case 10:case"end":return _context6.stop()}}},_callee6,this,[[0,7]])}));function supportsFitToBounds(){return _ref9.apply(this,arguments)}return supportsFitToBounds}()},{key:"_getGeoField",value:function(){var _ref10=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(){var indexPattern,geoField;return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return this._getIndexPattern();case 2:indexPattern=_context7.sent;geoField=indexPattern.fields.byName[this._descriptor.geoField];if(geoField){_context7.next=6;break}throw new Error(_i18n.i18n.translate("xpack.maps.source.esSource.noGeoFieldErrorMessage",{defaultMessage:"Index pattern {indexPatternTitle} no longer contains the geo field {geoField}",values:{indexPatternTitle:indexPattern.title,geoField:this._descriptor.geoField}}));case 6:return _context7.abrupt("return",geoField);case 7:case"end":return _context7.stop()}}},_callee7,this)}));function _getGeoField(){return _ref10.apply(this,arguments)}return _getGeoField}()},{key:"getDisplayName",value:function(){var _ref11=_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){var indexPattern;return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;_context8.next=3;return this._getIndexPattern();case 3:indexPattern=_context8.sent;return _context8.abrupt("return",indexPattern.title);case 7:_context8.prev=7;_context8.t0=_context8["catch"](0);return _context8.abrupt("return",this._descriptor.indexPatternId);case 10:case"end":return _context8.stop()}}},_callee8,this,[[0,7]])}));function getDisplayName(){return _ref11.apply(this,arguments)}return getDisplayName}()},{key:"isBoundsAware",value:function isBoundsAware(){return true}}]);return AbstractESSource}(_vector_source.AbstractVectorSource);AbstractESSource.icon="logoElasticsearch"},764:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AbstractVectorSource=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _vector_layer=__webpack_require__(758);var _vector_style=__webpack_require__(332);var _source=__webpack_require__(1225);var _topojsonClient=__webpack_require__(1145);var topojson=_interopRequireWildcard(_topojsonClient);var _lodash=__webpack_require__(2);var _lodash2=_interopRequireDefault(_lodash);var _i18n=__webpack_require__(5);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)})}}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var AbstractVectorSource=exports.AbstractVectorSource=function(_AbstractSource){_inherits(AbstractVectorSource,_AbstractSource);function AbstractVectorSource(){_classCallCheck(this,AbstractVectorSource);return _possibleConstructorReturn(this,(AbstractVectorSource.__proto__||Object.getPrototypeOf(AbstractVectorSource)).apply(this,arguments))}_createClass(AbstractVectorSource,[{key:"_createDefaultLayerDescriptor",value:function _createDefaultLayerDescriptor(options){return _vector_layer.VectorLayer.createDescriptor(_extends({sourceDescriptor:this._descriptor},options))}},{key:"createDefaultLayer",value:function createDefaultLayer(options){var layerDescriptor=this._createDefaultLayerDescriptor(options);var style=new _vector_style.VectorStyle(layerDescriptor.style);return new _vector_layer.VectorLayer({layerDescriptor:layerDescriptor,source:this,style:style})}},{key:"isFilterByMapBounds",value:function isFilterByMapBounds(){return false}},{key:"isBoundsAware",value:function isBoundsAware(){return false}},{key:"getBoundsForFilters",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.warn("Should implement AbstractVectorSource#getBoundsForFilters");return _context.abrupt("return",null);case 2:case"end":return _context.stop()}}},_callee,this)}));function getBoundsForFilters(){return _ref.apply(this,arguments)}return getBoundsForFilters}()},{key:"getNumberFields",value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",[]);case 1:case"end":return _context2.stop()}}},_callee2,this)}));function getNumberFields(){return _ref2.apply(this,arguments)}return getNumberFields}()},{key:"getStringFields",value:function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",[]);case 1:case"end":return _context3.stop()}}},_callee3,this)}));function getStringFields(){return _ref3.apply(this,arguments)}return getStringFields}()},{key:"getGeoJsonWithMeta",value:function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:throw new Error("Should implement VectorSource#getGeoJson");case 1:case"end":return _context4.stop()}}},_callee4,this)}));function getGeoJsonWithMeta(){return _ref4.apply(this,arguments)}return getGeoJsonWithMeta}()},{key:"canFormatFeatureProperties",value:function canFormatFeatureProperties(){return false}},{key:"filterAndFormatProperties",value:function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(properties){var props,key;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:props={};_context5.t0=regeneratorRuntime.keys(properties);case 2:if((_context5.t1=_context5.t0()).done){_context5.next=9;break}key=_context5.t1.value;if(!key.startsWith("__kbn")){_context5.next=6;break}return _context5.abrupt("continue",2);case 6:props[key]=properties[key];_context5.next=2;break;case 9:return _context5.abrupt("return",props);case 10:case"end":return _context5.stop()}}},_callee5,this)}));function filterAndFormatProperties(_x){return _ref5.apply(this,arguments)}return filterAndFormatProperties}()},{key:"isTimeAware",value:function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt("return",false);case 1:case"end":return _context6.stop()}}},_callee6,this)}));function isTimeAware(){return _ref6.apply(this,arguments)}return isTimeAware}()},{key:"isJoinable",value:function isJoinable(){return true}}],[{key:"getGeoJson",value:function(){var _ref8=_asyncToGenerator(regeneratorRuntime.mark(function _callee7(_ref7){var format=_ref7.format,featureCollectionPath=_ref7.featureCollectionPath,fetchUrl=_ref7.fetchUrl;var fetchedJson,response,features;return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:fetchedJson=void 0;_context7.prev=1;_context7.next=4;return fetch(fetchUrl);case 4:response=_context7.sent;if(response.ok){_context7.next=7;break}throw new Error("Request failed");case 7:_context7.next=9;return response.json();case 9:fetchedJson=_context7.sent;_context7.next=15;break;case 12:_context7.prev=12;_context7.t0=_context7["catch"](1);throw new Error(_i18n.i18n.translate("xpack.maps.source.vetorSource.requestFailedErrorMessage",{defaultMessage:"Unable to fetch vector shapes from url: {fetchUrl}",values:{fetchUrl:fetchUrl}}));case 15:if(!(format==="geojson")){_context7.next=17;break}return _context7.abrupt("return",fetchedJson);case 17:if(!(format==="topojson")){_context7.next=20;break}features=_lodash2.default.get(fetchedJson,"objects."+featureCollectionPath);return _context7.abrupt("return",topojson.feature(fetchedJson,features));case 20:throw new Error(_i18n.i18n.translate("xpack.maps.source.vetorSource.formatErrorMessage",{defaultMessage:"Unable to fetch vector shapes from url: {format}",values:{format:format}}));case 21:case"end":return _context7.stop()}}},_callee7,this,[[1,12]])}));function getGeoJson(_x2){return _ref8.apply(this,arguments)}return getGeoJson}()}]);return AbstractVectorSource}(_source.AbstractSource)},765:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.copyPersistentState=copyPersistentState;var TRACKED_LAYER_DESCRIPTOR=exports.TRACKED_LAYER_DESCRIPTOR="__trackedLayerDescriptor";function copyPersistentState(input){if((typeof input==="undefined"?"undefined":_typeof(input))!=="object"||input===null){return input}var copyInput=Array.isArray(input)?[]:{};for(var key in input){if(!key.startsWith("__")){copyInput[key]=copyPersistentState(input[key])}}return copyInput}},766:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var GRID_RESOLUTION=exports.GRID_RESOLUTION={COARSE:"COARSE",FINE:"FINE",MOST_FINE:"MOST_FINE"}},767:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var RENDER_AS=exports.RENDER_AS={HEATMAP:"heatmap",POINT:"point",GRID:"grid"}}});